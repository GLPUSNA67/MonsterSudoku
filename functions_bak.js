console.log(
  "File path is C:\\Users\\Owner\\Documents\\Github\\GLPCCWeb\\statis\\matrix\\assets\\functions.js "
);
// payment_plan = 20;
// console.log("5 current payment_plan is ", payment_plan);
let s_0_dict = {
  id: "s_0_dict",
  formula: "",
  name: "",
  type: "",
  units: "grams",
  qty: 0.0,
  calc_qty: 0.0,
  M_qty: 1,
  valence: 0,
  moles_molarity: "moles",
  molarity_molality_units: "liters(l)",
  temp_display_units: "C",
  temp_calc_units: "K",
  temp_display_qty: 0,
  temp_calc_qty: 273.15,
  press_display_units: "atm",
  press_calc_units: "atm",
  press_display_qty: 1,
  press_calc_qty: 1,
  column: 0,
  electronegativity: 0,
  _group: "",
  mass: 0,
  Oxidation_State: 0,
  activity: 99,
  kl_qty: 0,
  kl_units: "",
  mm_qty: 0,
  mm_units: "",
  molarity_qty: 0,
  molality_qty: 0,
  cation_qty: 0,
  cation: "",
  cation_charge: 0,
  anion_qty: 0,
  anion: "",
  anion_charge: 0,
  specific_gravity: 0,
  heat: 0,
  heat_units: "",
  other_units: "",
  melt: "",
  boil: "",
  elements_list: [],
  ions_list: [],
  Energy_of_first_ionization: "",
  other: "",
};

let s_1_dict = {
  //...s_0_dict };
  id: "s_1_dict",
  formula: "",
  name: "",
  type: "",
  units: "grams",
  qty: 0.0,
  calc_qty: 0.0,
  M_qty: 1,
  valence: 0,
  moles_molarity: "moles",
  molarity_molality_units: "liters(l)",
  temp_display_units: "C",
  temp_calc_units: "K",
  temp_display_qty: 0,
  temp_calc_qty: 273.15,
  press_display_units: "atm",
  press_calc_units: "atm",
  press_display_qty: 1,
  press_calc_qty: 1,
  column: 0,
  electronegativity: 0,
  _group: "",
  mass: 0,
  Oxidation_State: 0,
  activity: 99,
  kl_qty: 0,
  kl_units: "",
  mm_qty: 0,
  mm_units: "",
  molarity_qty: 0,
  molality_qty: 0,
  cation_qty: 0,
  cation: "",
  cation_charge: 0,
  anion_qty: 0,
  anion: "",
  anion_charge: 0,
  specific_gravity: 0,
  heat: 0,
  heat_units: "",
  other_units: "",
  melt: "",
  boil: "",
  elements_list: [],
  ions_list: [],
  Energy_of_first_ionization: "",
  other: "",
};

let s_2_dict = {
  id: "s_2_dict",
  formula: "",
  name: "",
  type: "",
  units: "grams",
  qty: 0.0,
  calc_qty: 0.0,
  M_qty: 1,
  valence: 0,
  moles_molarity: "moles",
  molarity_molality_units: "liters(l)",
  temp_display_units: "C",
  temp_calc_units: "K",
  temp_display_qty: 0,
  temp_calc_qty: 273.15,
  press_display_units: "atm",
  press_calc_units: "atm",
  press_display_qty: 1,
  press_calc_qty: 1,
  column: 0,
  electronegativity: 0,
  _group: "",
  mass: 0,
  Oxidation_State: 0,
  activity: 99,
  kl_qty: 0,
  kl_units: "",
  mm_qty: 0,
  mm_units: "",
  molarity_qty: 0,
  molality_qty: 0,
  cation_qty: 0,
  cation: "",
  cation_charge: 0,
  anion_qty: 0,
  anion: "",
  anion_charge: 0,
  specific_gravity: 0,
  heat: 0,
  heat_units: "",
  other_units: "",
  melt: "",
  boil: "",
  elements_list: [],
  ions_list: [],
  Energy_of_first_ionization: "",
  other: "",
};

let s_3_dict = {
  id: "s_3_dict",
  formula: "",
  name: "",
  type: "",
  units: "grams",
  qty: 0.0,
  calc_qty: 0.0,
  M_qty: 1,
  valence: 0,
  moles_molarity: "moles",
  molarity_molality_units: "liters(l)",
  temp_display_units: "C",
  temp_calc_units: "K",
  temp_display_qty: 0,
  temp_calc_qty: 273.15,
  press_display_units: "atm",
  press_calc_units: "atm",
  press_display_qty: 1,
  press_calc_qty: 1,
  column: 0,
  electronegativity: 0,
  _group: "",
  mass: 0,
  Oxidation_State: 0,
  activity: 99,
  kl_qty: 0,
  kl_units: "",
  mm_qty: 0,
  mm_units: "",
  molarity_qty: 0,
  molality_qty: 0,
  cation_qty: 0,
  cation: "",
  cation_charge: 0,
  anion_qty: 0,
  anion: "",
  anion_charge: 0,
  specific_gravity: 0,
  heat: 0,
  heat_units: "",
  other_units: "",
  melt: "",
  boil: "",
  elements_list: [],
  ions_list: [],
  Energy_of_first_ionization: "",
  other: "",
};

let s_4_dict = {
  id: "s_4_dict",
  formula: "",
  name: "",
  type: "",
  units: "grams",
  qty: 0.0,
  calc_qty: 0.0,
  M_qty: 1,
  valence: 0,
  moles_molarity: "moles",
  molarity_molality_units: "liters(l)",
  temp_display_units: "C",
  temp_calc_units: "K",
  temp_display_qty: 0,
  temp_calc_qty: 273.15,
  press_display_units: "atm",
  press_calc_units: "atm",
  press_display_qty: 1,
  press_calc_qty: 1,
  column: 0,
  electronegativity: 0,
  _group: "",
  mass: 0,
  Oxidation_State: 0,
  activity: 99,
  kl_qty: 0,
  kl_units: "",
  mm_qty: 0,
  mm_units: "",
  molarity_qty: 0,
  molality_qty: 0,
  cation_qty: 0,
  cation: "",
  cation_charge: 0,
  anion_qty: 0,
  anion: "",
  anion_charge: 0,
  specific_gravity: 0,
  heat: 0,
  heat_units: "",
  other_units: "",
  melt: "",
  boil: "",
  elements_list: [],
  ions_list: [],
  Energy_of_first_ionization: "",
  other: "",
};

let s_5_dict = {
  id: "s_5_dict",
  formula: "",
  name: "",
  type: "",
  units: "grams",
  qty: 0.0,
  calc_qty: 0.0,
  M_qty: 1,
  valence: 0,
  moles_molarity: "moles",
  molarity_molality_units: "liters(l)",
  temp_display_units: "C",
  temp_calc_units: "K",
  temp_display_qty: 0,
  temp_calc_qty: 273.15,
  press_display_units: "atm",
  press_calc_units: "atm",
  press_display_qty: 1,
  press_calc_qty: 1,
  column: 0,
  electronegativity: 0,
  _group: "",
  mass: 0,
  Oxidation_State: 0,
  activity: 99,
  kl_qty: 0,
  kl_units: "",
  mm_qty: 0,
  mm_units: "",
  molarity_qty: 0,
  molality_qty: 0,
  cation_qty: 0,
  cation: "",
  cation_charge: 0,
  anion_qty: 0,
  anion: "",
  anion_charge: 0,
  specific_gravity: 0,
  heat: 0,
  heat_units: "",
  other_units: "",
  melt: "",
  boil: "",
  elements_list: [],
  ions_list: [],
  Energy_of_first_ionization: "",
  other: "",
};

let s_6_dict = {
  id: "s_6_dict",
  formula: "",
  name: "",
  type: "",
  units: "grams",
  qty: 0.0,
  calc_qty: 0.0,
  M_qty: 1,
  valence: 0,
  moles_molarity: "moles",
  molarity_molality_units: "liters(l)",
  temp_display_units: "C",
  temp_calc_units: "K",
  temp_display_qty: 0,
  temp_calc_qty: 273.15,
  press_display_units: "atm",
  press_calc_units: "atm",
  press_display_qty: 1,
  press_calc_qty: 1,
  column: 0,
  electronegativity: 0,
  _group: "",
  mass: 0,
  Oxidation_State: 0,
  activity: 99,
  kl_qty: 0,
  kl_units: "",
  mm_qty: 0,
  mm_units: "",
  molarity_qty: 0,
  molality_qty: 0,
  cation_qty: 0,
  cation: "",
  cation_charge: 0,
  anion_qty: 0,
  anion: "",
  anion_charge: 0,
  specific_gravity: 0,
  heat: 0,
  heat_units: "",
  other_units: "",
  melt: "",
  boil: "",
  elements_list: [],
  ions_list: [],
  Energy_of_first_ionization: "",
  other: "",
};

//const s_7_dict = Object.assign(s_1_dict);

let gen_dict = {
  record_id: "",
  environment: "",
  major_process: "",
  minor_process: "",
  process_yield: "",
  equipment: [],
  energy_type: "",
  energy_amount: 0,
  catalyst: "",
  side_effects: "",
  by_products: "",
  variable_list: [],
  values: 0,
  notes: "",
};

const kl_mm_units_dict = {
  s_1_kl_units: "s_1_mm_units",
  s_2_kl_units: "s_2_mm_units",
  s_3_kl_units: "s_3_mm_units",
  s_4_kl_units: "s_4_mm_units",
  s_5_kl_units: "s_5_mm_units",
  s_6_kl_units: "s_6_mm_units",
};
const mm_kl_units_dict = {
  s_1_mm_units: "s_1_kl_units",
  s_2_mm_units: "s_2_kl_units",
  s_3_mm_units: "s_3_kl_units",
  s_4_mm_units: "s_4_kl_units",
  s_5_mm_units: "s_5_kl_units",
  s_6_mm_units: "s_6_kl_units",
};

const amu = 1.6605402e-27;
const an = 6.0221367e23;
const bc = 1.380658e-23;
const cmr_e = 1.75881962e11;
const ec = 1.60217733e-19;
const erm = 9.1093897e-31;
const fc = 9.6485309e4;
const r = 8.205784e-2;
const r1 = 8.31451e-2;
const mvg_stp = 22.41409;
const nrm = 1.6749274e-27;
const pc = 6.6260755 - 34; // Planc's constant
const prm = 1.6726231e-27; // Proton mass
const rydberg = 1.0973731534e7;
const c = 2.99792458e8;
let current_item_info = [];
let s_num_dict = "";
let s_dict = "";
let substance_mass = "";
let substance_valence = "";
let substance_vars = [];
const types_list = ["element", "compound", "diatomic", "ion"];
const major_process_types = ["Balance Equation", "Combustion", "Synthesis"];
let major_process = "";
const minor_process_types = [
  "molarity or moles to liters",
  "molarity or liters to moles",
  "molality or moles to kilograms",
  "molality or kilograms to moles",
  "volume to pressure",
  "volume to temperature",
  "pressure to temperature",
  "temperature to pressure",
  "calc specific heat",
  //"calc heat/work/energy",
  "calc formula mass",
  "Parse Compound to Ions",
  "Parse Compound to Elements",
];
let minor_process = "";
let volume_to_pressure = false;
let volume_to_temperature = false;
let pressure_to_temperature = false;
let b_temperature_to_pressure = false;
// "Parse_Reactant", "Parse_Product", "calc heat/work/energy change",
// "Parse Compound to Ions and Diatomic" , "Parse Compound to Elements and Diatomic"
let process_yield = 1.0;
gen_dict["process_yield"] = process_yield;

const dict_list = [
  "s_1_dict",
  "s_2_dict",
  "s_3_dict",
  "s_4_dict",
  "s_5_dict",
  "s_6_dict",
];
const type_list = [
  "s_1_type",
  "s_2_type",
  "s_3_type",
  "s_4_type",
  "s_5_type",
  "s_6_type",
];
const qty_list = [
  "s_1_qty",
  "s_2_qty",
  "s_3_qty",
  "s_4_qty",
  "s_5_qty",
  "s_6_qty",
];
const m_qty_list = [
  "s_1_m_qty",
  "s_2_m_qty",
  "s_3_m_qty",
  "s_4_m_qty",
  "s_5_m_qty",
  "s_6_m_qty",
];

const temp_qty_list = [
  "s_1_temp_qty",
  "s_1_temp_qty",
  "s_1_temp_qty",
  "s_1_temp_qty",
  "s_5_temp_qty",
  "s_6_temp_qty",
];

const temp_unit_list = [
  "s_1_temp_units",
  "s_2_temp_units",
  "s_3_temp_units",
  "s_4_temp_units",
  "s_5_temp_units",
  "s_6_temp_units",
];
const press_qty_list = [
  "s_1_press_qty",
  "s_2_press_qty",
  "s_3_press_qty",
  "s_4_press_qty",
  "s_5_press_qty",
  "s_6_press_qty",
];
const press_unit_list = [
  "s_1_press_units",
  "s_2_press_units",
  "s_3_press_units",
  "s_4_press_units",
  "s_5_press_units",
  "s_6_press_units",
];
const kl_unit_list = [
  "s_1_kl_units",
  "s_2_kl_units",
  "s_3_kl_units",
  "s_4_kl_units",
  "s_5_kl_units",
  "s_6_kl_units",
];
const mm_unit_list = [
  "s_1_mm_units",
  "s_2_mm_units",
  "s_3_mm_units",
  "s_4_mm_units",
  "s_5_mm_units",
  "s_6_mm_units",
];
let list_of_lists = [type_list]; //, types_list, units_list, moles_list, valence_list, temp_units_list, pres_units_list];
//var unit_list = ['substance_1_units', 'substance_2_units', 'substance_3_units', 'substance_4_units', 'substance_5_units', 'substance_6_units'];
const units_list = ["grams", "liters(g)"]; // "kilograms", liters(l)"
const moles_list = ["moles"]; // , "molarity", "molality";
const liters_kilogram_list = ["liters(l)", "kilograms"];
const molarity_list = ["molarity", "molality"];
const valence_list = [7, 6, 5, 4, 3, 2, 1, 0, -1, -2, -3, -4, -5]; //valences = "7 6 5 4 3 2 1 0 -1 -2 -3 -4"
const temp_units_list = ["C", "K", "F"];
const pres_units_list = ["atm", "torr", "kPa", "Pa", "psi", "mmHg"];
const heat_units_list = [
  "α",
  "ρ",
  "∝",
  "c",
  "q",
  "cal",
  "kcal",
  "J",
  "kJ",
  "J/g °C",
  "T_init",
  "T_final",
  "ΔT",
  "electronegativity",
];
const reserved_list = ["tbd"];
const numeric_list = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
let equipment_list = ["boiler", "distillery"];
let energy_types = ["heat", "electricity"];
let catalysts = [
  "phosphoric acid",
  "aluminum chloride",
  "tellurium oxide",
  "bromide ion",
];
let side_effects = [
  "air polution",
  "flamability",
  "combustability",
  "explosive",
  "narcotic effects",
  "anesthetic",
  "coolant",
  "antifreeze",
  "toxic",
];
let by_products = ["green house gases", "water polution", "hazardous waste"];
let variable_list = [];
let variables_list = [
  "A",
  "B",
  "D",
  "E",
  "G",
  "H",
  "I",
  "J",
  "L",
  "M",
  "N",
  "O",
  "P",
  "Q",
  "R",
  "S",
  "T",
  "U",
  "V",
  "W",
  "X",
  "Y",
  "Z",
  "a",
  "b",
  "c",
  "d",
  "e",
  "f",
  "g",
  "h",
  "i",
  "j",
  "k",
  "l",
  "m",
  "n",
  "o",
  "p",
  "q",
  "r",
  "s",
  "t",
  "u",
  "v",
  "w",
  "x",
  "y",
  "z",
];
const element_to_diatomic_list = ["H", "N", "O", "F", "Cl", "Br", "I"];
const element_alpha_list = [
  "A",
  "B",
  "C",
  "D",
  "E",
  "F",
  "G",
  "H",
  "I",
  "K",
  "L",
  "M",
  "N",
  "O",
  "P",
  "R",
  "S",
  "T",
  "U",
  "V",
  "W",
  "X",
  "Y",
  "Z",
];
const diatomic_formula_list = ["H2", "N2", "O2", "F2", "Cl2", "Br2", "I2"];
const element_to_diatomic_dict = {
  H: "H2",
  N: "N2",
  O: "O2",
  F: "F2",
  Cl: "Cl2",
  Br: "Br2",
  I: "I2",
};
const p_dict = { s_1_dict, s_2_dict, s_3_dict, s_4_dict, s_5_dict, s_6_dict };
let EquationIsBalanced = "False";
let reactant_count = 0;
let product_count = 0;
let be = "";
let cie = "";
let current_formula = "";
let current_ion = "";
let current_ion_subscript = 1;
let current_ion_id = "";
let current_compound = [];
let be_list = [];
let be_list_to_be_processsed = [];
const index_dict = {
  0: "react_1",
  1: "react_2",
  2: "react_3",
  3: "prod_1",
  4: "prod_2",
  5: "prod_3",
};
// Var works, let does not work!
var E_text = "";
var E_spaces = "";
var current_kl_mm_s_dict = "";
var parsed_compound_list = [];
var elements_list = [];
var ions_list = [];
var substance_1 = "";
var substance_2 = "";
var substance_3 = "";
var substance_4 = "";
var substance_5 = "";
var substance_6 = "";
var _substances = {};
var _compound_conversion_dict = {};
var _compound_names_dict = {};
var _ion_names_dict = {};
var _compound_list = [];
var elements = {};
var records = [];
var selected_record = null;
var temp_units = "";
var press_units = "";
var index0 = 0;
var max = 0;

function load_form() {
  console.log("705 Entering load_form()");
  index0 = 0;

  _substances = substances;
  _compound_conversion_dict = compound_conversion_dict;
  _compound_names_dict = compound_names_dict;
  _ion_names_dict = _ion_names_dict;
  _compound_list = compound_list;
  elements = substances;
  // fill_selects('s_1_type', [...compound_list, ...elements_list])
  fill_selects("Select_process_type", major_process_types);
  fill_selects("select_major_process", major_process_types);
  fill_selects("select_minor_process", minor_process_types);
  fill_selects("s_1_valence", valence_list);
  fill_selects("s_2_valence", valence_list);
  fill_selects("s_3_valence", valence_list);
  fill_selects("s_4_valence", valence_list);
  fill_selects("s_5_valence", valence_list);
  fill_selects("s_6_valence", valence_list);
  fill_selects("s_1_units", units_list);
  fill_selects("s_2_units", units_list);
  fill_selects("s_3_units", units_list);
  fill_selects("s_4_units", units_list);
  fill_selects("s_5_units", units_list);
  fill_selects("s_6_units", units_list);
  fill_selects("s_1_mole_units", moles_list);
  fill_selects("s_2_mole_units", moles_list);
  fill_selects("s_3_mole_units", moles_list);
  fill_selects("s_4_mole_units", moles_list);
  fill_selects("s_5_mole_units", moles_list);
  fill_selects("s_6_mole_units", moles_list);
  fill_selects("s_1_kl_units", liters_kilogram_list);
  fill_selects("s_2_kl_units", liters_kilogram_list);
  fill_selects("s_3_kl_units", liters_kilogram_list);
  fill_selects("s_4_kl_units", liters_kilogram_list);
  fill_selects("s_5_kl_units", liters_kilogram_list);
  fill_selects("s_6_kl_units", liters_kilogram_list);
  fill_selects("s_1_mm_units", molarity_list);
  fill_selects("s_2_mm_units", molarity_list);
  fill_selects("s_3_mm_units", molarity_list);
  fill_selects("s_4_mm_units", molarity_list);
  fill_selects("s_5_mm_units", molarity_list);
  fill_selects("s_6_mm_units", molarity_list);
  fill_selects("s_1_temp_units", temp_units_list);
  fill_selects("s_2_temp_units", temp_units_list);
  fill_selects("s_3_temp_units", temp_units_list);
  fill_selects("s_4_temp_units", temp_units_list);
  fill_selects("s_5_temp_units", temp_units_list);
  fill_selects("s_6_temp_units", temp_units_list);
  fill_selects("s_1_press_units", pres_units_list);
  fill_selects("s_2_press_units", pres_units_list);
  fill_selects("s_3_press_units", pres_units_list);
  fill_selects("s_4_press_units", pres_units_list);
  fill_selects("s_5_press_units", pres_units_list);
  fill_selects("s_6_press_units", pres_units_list);
  fill_selects("s_1_heat_units", heat_units_list);
  fill_selects("s_2_heat_units", heat_units_list);
  fill_selects("s_3_heat_units", heat_units_list);
  fill_selects("s_4_heat_units", heat_units_list);
  fill_selects("s_5_heat_units", heat_units_list);
  fill_selects("s_6_heat_units", heat_units_list);
  fill_selects("s_1_other_units", heat_units_list);
  fill_selects("s_2_other_units", heat_units_list);
  fill_selects("s_3_other_units", heat_units_list);
  fill_selects("s_4_other_units", heat_units_list);
  fill_selects("s_5_other_units", heat_units_list);
  fill_selects("s_6_other_units", heat_units_list);
  fill_selects("equipment", equipment_list);
  fill_selects("energy_type", energy_types);
  fill_selects("variables", variables_list);
  fill_selects("catalyst_type", catalysts);
  fill_selects("side_effects", side_effects);
  fill_selects("by_products", by_products);

  //fill_selects(substance_ID, select_list[index0])
  index0 = 0;
  while (index0 < type_list.length) {
    fill_substance_selects(type_list[index0]);
    index0++;
  }
  console.log("705 Exiting load_form");
}

function removeAll(selectBox) {
  console.log("794 Entering removeAll(selectBox)");
  while (selectBox.options.length > 0) {
    selectBox.remove(0);
  }
}

function removeAllButOne(selectBox) {
  console.log("801 Entering removeAllButOne(selectBox)");
  //Actually removes all except the first blank option
  console.log("803 selectBox", selectBox);
  while (selectBox.options.length > 1) {
    //console.log("92 selectBox.options.length", selectBox.options.length);
    selectBox.remove(1);
  }
}

function fill_selects(s_ID, select_list) {
  //console.log("811 Entering fill_selects(s_ID, select_list)");
  // For each type, variable, etc. list passed, (except substance lists), add select options
  //console.log("256 fill_selects(substance_ID, select_list)", s_ID, select_list);
  var min = 0;
  max = select_list.length - 1;
  // Set a timeout for filling selects
  //setTimeout(() => {
  //    var select = document.getElementById(s_ID);
  //}, 100);

  var select = document.getElementById(s_ID);

  for (var i = min; i <= max; i++) {
    var opt = document.createElement("option");
    opt.value = select_list[i];
    opt.innerHTML = select_list[i];
    select?.appendChild(opt);
  }
}

function fill_substance_selects(s_num) {
  // Fill the Select substance type options
  //console.log("276 fill_substance_selects", s_num);
  console.log("834 Entering fill_substance_selects(s_num)");
  var min = 0;
  max = types_list.length - 1;
  var select = document.getElementById(s_num);

  for (var i = min; i <= max; i++) {
    var opt = document.createElement("option");
    opt.value = types_list[i];
    opt.innerHTML = types_list[i];
    select?.appendChild(opt);
  }
}

function set_substance_type(s_type, s_dict) {
  console.log(
    "848 Entering set_substance_type(s_type, s_dict)",
    s_type,
    s_dict
  );
  var p_dict = s_0_dict;
  var p_num_dict = "";
  if (s_type == "s_1_type") {
    p_dict = s_1_dict;
    p_num_dict = "s_1_dict";
    E_text += "<br>User selected substance 1 type to be ";
  } else if (s_type == "s_2_type") {
    p_dict = s_2_dict;
    p_num_dict = "s_2_dict";
    E_text += "<br>User selected substance 2 type to be ";
  } else if (s_type == "s_3_type") {
    p_dict = s_3_dict;
    p_num_dict = "s_3_dict";
    E_text += "<br>User selected substance 3 type to be ";
  } else if (s_type == "s_4_type") {
    p_dict = s_4_dict;
    p_num_dict = "s_4_dict";
    E_text += "<br>User selected substance 4 type to be ";
  } else if (s_type == "s_5_type") {
    p_dict = s_5_dict;
    p_num_dict = "s_5_dict";
    E_text += "<br>User selected substance 5 type to be ";
  } else if (s_type == "s_6_type") {
    p_dict = s_6_dict;
    p_num_dict = "s_6_dict";
    E_text += "<br>User selected substance 6 type to be ";
  }
  current_item_info[0] = p_num_dict;
  //console.log("559 current_item_info[0] id ", current_item_info[0]);
  var select = document.getElementById(s_type);
  //console.log("561 s_type", s_type, select);
  var value = select.options[select.selectedIndex].value;
  //console.log("563 value", value);
  //console.log("875 p_dict and p_num_dict are ", p_dict, p_num_dict);
  reset_display(p_num_dict);
  E_text += value + " .";
  set_explanation_text(E_text);
  fill_substance_formulas(s_type, value, s_dict);
  set_initial_values(p_dict);
  p_dict["type"] = value;
  console.log("889 Exiting set_substance_type(s_type, s_dict)");
}

function set_initial_values(s_dict) {
  console.log("893 Entering set_initial_values(s_dict)", s_dict);
  Object.keys(s_dict).map((key) => {
    if (key != "id") s_dict[key] = s_0_dict[key];
  });

  refresh_display(s_dict.id);
  console.log("899 Exiting set_initial_values");
}

function fill_substance_formulas(s_type, value, s_dict) {
  console.log(
    "903 Entering fill_substance_formulas(s_type, value, s_dict)",
    s_type,
    value,
    s_dict
  );
  var name, formula, substance_panel_id;
  if (s_type == "s_1_type") {
    name = "substance_1_name";
    formula = "substance_1";
    substance_panel_id = "s_1";
  } else if (s_type == "s_2_type") {
    //&& value == "element"
    name = "substance_2_name";
    formula = "substance_2";
    substance_panel_id = "s_2";
  } else if (s_type == "s_3_type") {
    name = "substance_3_name";
    formula = "substance_3";
    substance_panel_id = "s_3";
  } else if (s_type == "s_4_type") {
    name = "substance_4_name";
    formula = "substance_4";
    substance_panel_id = "s_4";
  } else if (s_type == "s_5_type") {
    name = "substance_5_name";
    formula = "substance_5";
    substance_panel_id = "s_5";
  } else if (s_type == "s_6_type") {
    name = "substance_6_name";
    formula = "substance_6";
    substance_panel_id = "s_6";
  }
  let substance_panel = document.getElementById(substance_panel_id);
  let autocomplete_elements = substance_panel.getElementsByClassName(
    "xdsoft_autocomplete"
  );
  for (let i = 0; i < autocomplete_elements.length; i++) {
    let element = autocomplete_elements[i];
    element.classList.add("d-none");
  }
  document.getElementById(formula).classList.add("d-none");
  document.getElementById(formula + "_element").classList.add("d-none");
  document.getElementById(formula + "_compound").classList.add("d-none");
  document.getElementById(formula + "_ion").classList.add("d-none");
  document.getElementById(formula + "_diatomic").classList.add("d-none");
  document.getElementById(name).classList.add("d-none");
  document.getElementById(name + "_element").classList.add("d-none");
  document.getElementById(name + "_compound").classList.add("d-none");
  document.getElementById(name + "_ion").classList.add("d-none");
  document.getElementById(name + "_diatomic").classList.add("d-none");
  _substances = substances;
  if (value == "element") {
    document.getElementById(formula + "_element").classList.remove("d-none");
    document.getElementById(name + "_element").classList.remove("d-none");
    document
      .getElementById(formula + "_element")
      .parentElement.classList.remove("d-none");
    document.getElementById(formula + "_element").parentElement.style.display =
      "block";
    document
      .getElementById(name + "_element")
      .parentElement.classList.remove("d-none");
    document.getElementById(name + "_element").parentElement.style.display =
      "block";
    setAutoComplete(
      formula + "_element",
      value,
      "formula",
      s_type,
      name + "_element",
      formula + "_element"
    );
    setAutoComplete(
      name + "_element",
      value,
      "name",
      s_type,
      name + "_element",
      formula + "_element"
    );
    var eleF = document.getElementById(formula + "_element");
    eleF.value = "";
    var eleN = document.getElementById(name + "_element");
    eleN.value = "";
  } else if (value == "compound") {
    document.getElementById(formula + "_compound").classList.remove("d-none");
    document.getElementById(name + "_compound").classList.remove("d-none");
    document
      .getElementById(formula + "_compound")
      .parentElement.classList.remove("d-none");
    document.getElementById(formula + "_compound").parentElement.style.display =
      "block";
    document
      .getElementById(name + "_compound")
      .parentElement.classList.remove("d-none");
    document.getElementById(name + "_compound").parentElement.style.display =
      "block";
    console.log("400 >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
    console.log(
      formula + "_compound",
      value,
      "formula",
      s_type,
      name + "_compound",
      formula + "_compound"
    );
    setAutoComplete(
      formula + "_compound",
      value,
      "formula",
      s_type,
      name + "_compound",
      formula + "_compound"
    );
    setAutoComplete(
      name + "_compound",
      value,
      "name",
      s_type,
      name + "_compound",
      formula + "_compound"
    );
    var comF = document.getElementById(formula + "_compound");
    comF.value = "";
    var comN = document.getElementById(name + "_compound");
    comN.value = "";
  } else if (value == "ion") {
    document.getElementById(formula + "_ion").classList.remove("d-none");
    document.getElementById(name + "_ion").classList.remove("d-none");
    document
      .getElementById(formula + "_ion")
      .parentElement.classList.remove("d-none");
    document.getElementById(formula + "_ion").parentElement.style.display =
      "block";
    document
      .getElementById(name + "_ion")
      .parentElement.classList.remove("d-none");
    document.getElementById(name + "_ion").parentElement.style.display =
      "block";
    setAutoComplete(
      formula + "_ion",
      value,
      "formula",
      s_type,
      name + "_ion",
      formula + "_ion"
    );
    setAutoComplete(
      name + "_ion",
      value,
      "name",
      s_type,
      name + "_ion",
      formula + "_ion"
    );
    var ionF = document.getElementById(formula + "_ion");
    ionF.value = "";
    var ionN = document.getElementById(name + "_ion");
    ionN.value = "";
  } else if (value == "diatomic") {
    document.getElementById(formula + "_diatomic").classList.remove("d-none");
    document.getElementById(name + "_diatomic").classList.remove("d-none");
    document
      .getElementById(formula + "_diatomic")
      .parentElement.classList.remove("d-none");
    document.getElementById(formula + "_diatomic").parentElement.style.display =
      "block";
    document
      .getElementById(name + "_diatomic")
      .parentElement.classList.remove("d-none");
    document.getElementById(name + "_diatomic").parentElement.style.display =
      "block";
    setAutoComplete(
      formula + "_diatomic",
      value,
      "formula",
      s_type,
      name + "_diatomic",
      formula + "_diatomic",
      diatomic_list
    );
    setAutoComplete(
      name + "_diatomic",
      value,
      "name",
      s_type,
      name + "_diatomic",
      formula + "_diatomic",
      diatomic_name_list
    );
    var ionF = document.getElementById(formula + "_diatomic");
    ionF.value = "";
    var ionN = document.getElementById(name + "_diatomic");
    ionN.value = "";
  } else {
    document.getElementById(formula).classList.remove("d-none");
    document.getElementById(name).classList.remove("d-none");
    for (let i = 0; i < autocomplete_elements.length; i++) {
      let element = autocomplete_elements[i];
      element.classList.add("d-none");
    }
  }
  console.log("1100 Exiting fill_substance_formulas");
}

function setAutoComplete(
  id,
  type,
  d_type,
  s_type,
  s_name,
  s_formula,
  source = []
) {
  console.log(
    "113 Entering Set autpcomplete: ",
    id,
    type,
    d_type,
    s_type,
    s_name,
    s_formula,
    source
  );
  $("#" + id)
    .autocomplete({
      appendMethod: "replace",
      openOnFocus: true,
      limit: 1000,
      visibleLimit: 20,
      source: [
        type == "diatomic"
          ? source
          : async function (q, add) {
              await handleSearchAjax(d_type, type, q, add);
            },
      ],
      render: function (item) {
        if (d_type == "name") {
          return `<div>${item.replace(/\_/gi, " ")}</div>`;
        } else {
          if (type == "ion") return formattedIon(item);
          return formattedFormula(item);
        }
      },
      getValue: function (item) {
        if (d_type == "name") {
          return item.replace(/\_/gi, " ");
        } else return item;
      },
    })
    .on("selected.xdsoft", function (e, value) {
      if (d_type == "name") {
        setSelectedItemFormula(s_type, s_formula, s_name, value);
      } else {
        console.log(">>>>>>>>>>>");
        console.log(s_type, s_name, s_formula, value);
        setSelectedItemName(s_type, s_name, s_formula, value);
      }
    });
}

function formattedFormula(text) {
  let formattedName = "";
  for (let i = 0; i < text.length; i++) {
    const letter = text.substring(i, i + 1);
    if (isNaN(letter) == false) {
      formattedName += `<sub>${letter}</sub>`;
    } else {
      formattedName += letter;
    }
  }
  return `<div>${formattedName}</div>`;
}

function formattedIon(text) {
  let formattedName = "";
  let ion_sign = text.slice(-1);
  let ionic_value = text.substring(text.length - 3, text.length - 1);
  if (isNaN(ionic_value) == false) {
    ionic_value = text.substring(text.length - 2, text.length - 1);
    text = text.slice(0, -2);
  } else {
    ionic_value = "";
    text = text.slice(0, -1);
  }
  for (let i = 0; i < text.length; i++) {
    const letter = text.substring(i, i + 1);
    if (isNaN(letter) == false) {
      formattedName += `<sub>${letter}</sub>`;
    } else {
      formattedName += letter;
    }
  }
  return `<div>${formattedName}<sup>${ionic_value + ion_sign}</sup></div>`;
}

async function handleSearchAjax(endpoint, value, q, add) {
  var url = "";
  if (endpoint == "formula") {
    url = "/searchSubstanceFormula/?type=" + value + "&query=" + q;
  } else {
    url = "/searchSubstanceName/?type=" + value + "&query=" + q;
  }
  await $.ajax({
    type: "GET",
    url: url,
    timeout: 20000,
    success: function (response) {
      if (response.status === true) {
        handleSearchResponse(response.data, add, value, endpoint);
      } else {
      }
    },
    error: function (response) {
      // alert the error if any error occured
      alert("Something went wrong");
    },
  });
}

function handleSearchResponse(data, add, type, endpoint) {
  var _temp = {};
  var _temp_name_dict = {};
  var _temp_ion_dict = {};
  var _flist = [];
  for (let i = 0; i < data.length; i++) {
    const el = data[i];
    if (type == "element") {
      _temp[el.symbol] = el;
      if (endpoint == "formula") {
        _flist.push(el.symbol);
      } else {
        _flist.push(el.name);
      }
    } else if (type == "compound") {
      _temp[el.formula] = el;
      _temp_name_dict[el.name] = el.formula;
      if (endpoint == "formula") {
        _flist.push(el.formula);
      } else {
        _flist.push(el.name);
      }
    } else if (type == "ion") {
      _temp[el.formula] = el;
      _temp_ion_dict[el.name] = el.formula;
      if (endpoint == "formula") {
        _flist.push(el.formula);
      } else {
        _flist.push(el.name);
      }
    } else if (type == "ion") {
    }
  }
  _substances = _temp;
  _compound_names_dict = _temp_name_dict;
  _ion_names_dict = _temp_ion_dict;
  add(_flist);
}

function set_s_types(s_type) {
  console.log("923 entered set_s_types(s_type)", s_type);
  if (s_type == "s_1_type") {
    s_num_dict = s_1_dict;
    s_dict = "s_1_dict";
  } else if (s_type == "s_2_type") {
    s_num_dict = s_2_dict;
    s_dict = "s_2_dict";
  } else if (s_type == "s_3_type") {
    s_num_dict = s_3_dict;
    s_dict = "s_3_dict";
  } else if (s_type == "s_4_type") {
    s_num_dict = s_4_dict;
    s_dict = "s_4_dict";
  } else if (s_type == "s_5_type") {
    s_num_dict = s_5_dict;
    s_dict = "s_5_dict";
  } else if (s_type == "s_6_type") {
    s_num_dict = s_6_dict;
    s_dict = "s_6_dict";
  }
  current_item_info[0] = s_dict;
  current_item_info[1] = "";
  current_item_info[2] = "";
  current_item_info[3] = "";
  console.log("944 s_dict is ", current_item_info);
}

function setSelectedItemName(s_type, s_id, s_id_formula, substance) {
  console.log(
    "1296 Entered setSelectedItemName and arguments s_type, s_id, s_id_formula, substance",
    arguments
  );
  // Use the substance type to get the appropriate substance formula list
  // use that list to load the name selection

  console.log("954 current_item_info is ", current_item_info);
  console.log(
    "956 current_item_info is ",
    s_type,
    s_id,
    s_id_formula,
    substance
  );

  let substances_type = document.getElementById(s_type);
  let substance_type = substances_type.value;
  //current_item_info = [s_type, s_id, s_id_formula, substance]
  //console.log("355 current_item_info s_type, s_id, s_id_formula, substance is", s_type, s_id, s_id_formula, substance);
  // Identify and set the correct dictiona argury
  set_s_types(s_type);
  console.log("969 ", s_dict, s_type, s_id, s_id_formula, substance_type); // substance is not yet defined
  reset_display(s_dict);
  select = document.getElementById(s_id);
  console.log("972 ", select);
  let value = select.value;
  console.log("974 value", value);
  // *** get the current value of the formula
  let current_select = document.getElementById(s_id_formula);
  console.log("977 current_select", current_select);
  let substance_formula = substance;
  //current_item_info = [s_type, s_id, s_id_formula, substance_formula];
  console.log(
    "981 current_item_info s_type, s_id, s_id_formula, substance is",
    s_type,
    s_id,
    s_id_formula,
    substance_formula
  );
  var _substance = _substances[substance_formula]
    ? _substances[substance_formula]
    : _substances[substance_formula.replace("(", "_").replace(")", "_")];
  var substance_name = _substance["name"];
  var substance_mass = _substance["mass"];
  var substance_ions = _substance["ions"];
  var substance_elements = _substance["elements"];
  console.log("1237 substance_mass", substance_mass);
  /// Now use the appropriate type dictionary to find the substance name associated with the formula
  if (value != substance_formula) {
    console.log("1237 value & formula", value, " & ", substance_formula);
    console.log("1238 s_num_dict['type']", s_num_dict["type"]);
    // *** Always initialize units to grams ***
    s_num_dict["units"] = "grams";
    if (s_num_dict["type"] === "element") {
      console.log("1240 s_num_dict['type']", s_num_dict["type"]);
      var substance_valence = _substance["valence"];
      var substance_electronegativity = _substance["electronegativity"];
      s_num_dict["formula"] = substance_formula;
      s_num_dict["name"] = substance_name;
      s_num_dict["mass"] = substance_mass;
      console.log("1246 substance_mass", s_num_dict["mass"]);
      s_num_dict["qty"] = substance_mass;
      s_num_dict["valence"] = substance_valence;
      s_num_dict["units"] = "grams";
      // console.log("948 substance_valence", s_num_dict["valence"]);
      console.log(
        "1251 electronegativity and valence",
        substance_electronegativity,
        s_num_dict["electronegativity"],
        s_num_dict["valence"]
      );
      s_num_dict["M_qty"] = 1; //
    } else if (s_num_dict["type"] === "compound") {
      if (substance_name) {
        s_num_dict["formula"] = substance_formula;
        s_num_dict["name"] = substance_name;
        s_num_dict["units"] = "grams";
        s_num_dict["mass"] = substance_mass;
        s_num_dict["qty"] = substance_mass;
        s_num_dict["M_qty"] = 1;
        s_num_dict["ions"] = substance_ions;
        s_num_dict["elements"] = substance_elements;
        //s_num_dict["Energy_of_first_ionization"] = Energy_of_first_ionization;
        current_item_info[0] = s_num_dict["id"];
        current_item_info[1] = s_num_dict["type"];
        current_item_info[2] = s_num_dict["name"];
        current_item_info[3] = s_num_dict["formula"];
        console.log("974 substance_ions", s_num_dict["ions"]);
        console.log(
          "975 s_num_dict['Energy_of_first_ionization']",
          s_num_dict["Energy_of_first_ionization"]
        );
      } else {
        s_num_dict["mass"] = 0;
        s_num_dict["qty"] = 0;
        s_num_dict["M_qty"] = 1;
        // Parse_Compound_to_Ions();
        // Parse_Compound_to_Elements();
      }
    } else if (s_num_dict["type"] == "ion") {
      if (substance_formula) {
        s_num_dict["formula"] = substance_formula;
        s_num_dict["name"] = substance_name;
        s_num_dict["mass"] = substance_mass;
        s_num_dict["qty"] = substance_mass;
        s_num_dict["M_qty"] = 1;
        s_num_dict["units"] = "grams";
      } else {
        s_num_dict["mass"] = 0;
        s_num_dict["qty"] = 0;
        s_num_dict["M_qty"] = 1;
      }
    } else if (s_num_dict["type"] == "diatomic") {
      if (substance_formula) {
        s_num_dict["formula"] = substance_formula;
        s_num_dict["name"] = substance_name;
        s_num_dict["mass"] = substance_mass;
        s_num_dict["qty"] = substance_mass;
        s_num_dict["M_qty"] = 1;
        s_num_dict["units"] = "grams";
      } else {
        s_num_dict["mass"] = 0;
        s_num_dict["qty"] = 0;
        s_num_dict["M_qty"] = 1;
      }
    }
    var select = document.getElementById(s_id);
    console.log("1302 --> ", substance_name);
    console.log("1303 ", s_id);
    console.log("1304 ", select.value);
    select.value = substance_name.replace(/\_/gi, " ");
    console.log("1306 ", select.value);
    // s_1_units.value = "grams"; // refresh_s_1_display();
    // refresh_s_1_display();

    E_text +=
      "<br>1423 " +
      t_ssf +
      substance_formula +
      ". " +
      t_ssn +
      substance_name +
      ", " +
      t_ssq +
      substance_mass +
      t_sug +
      t_ssv +
      t_ssi;
    set_explanation_text(E_text);
    console.log("1319 substance_mass is: ", s_num_dict["mass"]);
    console.log("1320 temp_display_qty", s_num_dict["temp_display_qty"]);
    console.log("1319 substance_mass is ", s_num_dict["mass"]);
    console.log("1320 substance dict is ", s_num_dict);
    console.log("1321 substance dict is ", s_num_dict["formula"]);
  }
  if (s_num_dict["type"] === "compound") {
    console.log(
      "1030 substance dict prior to Parse_Compound_to_Ions(); is ",
      s_num_dict
    );
    Parse_Compound_to_Ions();
    Parse_Compound_to_Elements();
  }
  refresh_display(s_dict);
  console.log("1036", s_1_dict);
}

function setSelectedItemFormula(s_type, s_id, s_id_name, substance) {
  console.log(
    "1462 Entered setSelectedItemFormula and arguments s_type, s_id, s_id_name, substance",
    arguments
  );
  // get the substance id, type and name of the substance selected e.g. element, 'hydrogen', substance_1
  // The s_id is used to get the value of the selected option -- substance "type". (element, compound, etc.)
  // The substance "type" is used to find the appropriate dictionary,
  // The "s_name" is the subatance name and is the key to the dictionary
  // The s_name is the id of the widget that will be updated with the substance formula
  //var select = document.getElementById('s_1_type');
  //var value = select.options[select.selectedIndex].value;
  var substances_type = document.getElementById(s_type);
  var substance_type =
    substances_type.options[substances_type.selectedIndex].value;
  // Identify and set the correct dictionary
  set_s_types(s_type);
  console.log(
    "722 ",
    s_num_dict,
    s_type,
    s_id,
    s_id_name,
    substance,
    substance_type
  );
  reset_display(s_dict);
  let select = document.getElementById(s_id);
  let value = select.type;
  let opt = document.createElement("option");
  console.log("727 ", value, opt, select);
  // *** get the current value of the formula
  let current_select = document.getElementById(s_id_name);
  let current_value = current_select.value;
  console.log("731 ", current_select, current_value);
  E_text += "<br>User selected substance " + substance + ". ";
  set_explanation_text(E_text);
  set_bottom_explanation_text(E_text);
  /// Now use the appropriate type dictionary to find the formula associated with the substance name
  if (value != current_value) {
    console.log("736 ", value, current_value);
    if (s_num_dict["type"] == "element") {
      //s_1_dict["type"]
      substance_formula = element_names_dict[substance]; //element_names_dict
      console.log("739 ", substance_formula);
      substance_mass = _substances[substance_formula]["mass"];
      substance_valence = _substances[substance_formula]["valence"];
      s_num_dict["mass"] = substance_mass;
      s_num_dict["qty"] = substance_mass;
      s_num_dict["M_qty"] = 1;
      s_num_dict["valence"] = substance_valence;
      current_item_info[0] = s_num_dict["id"];
      current_item_info[1] = s_num_dict["type"];
      current_item_info[2] = s_num_dict["name"];
      current_item_info[3] = s_num_dict["formula"];
    } else if (s_num_dict["type"] == "compound") {
      substance_formula = _compound_names_dict[substance];
      console.log("746 ", substance_formula, substance);
      s_num_dict["name"] = substance;
      s_num_dict["mass"] = substance_mass;
      s_num_dict["qty"] = substance_mass;
      s_num_dict["M_qty"] = 1;
      c_substance = _compound_conversion_dict[substance];
      console.log("751 ", substance);
      console.log("752 ", _substances[substance_formula]["mass"]);
      substance_mass = _substances[substance_formula]["mass"]; // substance_name
      current_item_info[0] = s_num_dict["id"];
      current_item_info[1] = s_num_dict["type"];
      current_item_info[2] = s_num_dict["name"];
      current_item_info[3] = s_num_dict["formula"];
    } else if (s_num_dict["type"] == "ion") {
      var substance_formula = _ion_names_dict[substance];
      console.log("756 ", substance_formula);
      s_num_dict["mass"] = substance_mass;
      s_num_dict["qty"] = substance_mass;
      s_num_dict["M_qty"] = 1;
    } else if (s_num_dict["type"] == "diatomic") {
      substance_formula = diatomic_names_dict[substance];
      console.log("762 ", substance_formula);
      s_num_dict["mass"] = substance_mass;
      s_num_dict["qty"] = substance_mass;
      s_num_dict["M_qty"] = 1;
    }
    s_num_dict["mass"] = substance_mass;
    s_num_dict["qty"] = substance_mass;
    console.log("769 s_num_dict['mass'] ", s_num_dict["mass"]);
    console.log("770 s_num_dict['qty'] ", s_num_dict["qty"]);
    select = document.getElementById(s_id);
    console.log("772 select ", select);
    opt.value = substance_formula;
    opt.innerHTML = substance_formula;
    e = document.getElementById(s_id);
    console.log("776 e  = document.getElementById(s_id) is ", e);
    var value_index = 3; //select.options[select.selectedIndex].value; // get selected option value
    console.log("778 value_index ", value_index);
    select.value = substance_formula;
    s_num_dict["formula"] = substance_formula;
    var saved_value = s_num_dict["formula"];
    console.log("782 s_num_dict['formula']", s_num_dict["formula"]);
    console.log("783 s_num_dict", s_num_dict);
    E_text +=
      "<br>Program set substance formula to " +
      substance_formula +
      " , units to 'grams', and quantity|molar mass to " +
      substance_mass +
      " .";
    set_explanation_text(E_text);
  }
  if (s_num_dict["type"] === "compound") {
    console.log("1139");
    current_item_info[2] = s_num_dict["formula"];
    console.log(
      "11-138 substance dict prior to Parse_Compound_to_Ions(); is ",
      s_num_dict["name"]
    );
    if (s_num_dict["ions " === ""]) {
      console.log("1145 ions is null.");
      Parse_Compound_to_Ions();
      Parse_Compound_to_Elements();
    }
  }
  refresh_display(s_dict);
  console.log("1147", s_1_dict);
}

function update_form_selects_logic(s_id, s_dict) {
  console.log(
    "1587 Entered update_form_selects_logic and arguments s_id, s_dict",
    arguments
  );
  let select = document.getElementById(s_id);
  let opt = document.createElement("option");
  s_units = select.options[select.selectedIndex].text;
  if (
    minor_process === "molarity or moles to liters" ||
    minor_process === "molality or moles to kilograms" ||
    (minor_process === "volume to temperature" && s_units === "literg(g)") ||
    (minor_process === "volume to pressure" && s_units === "literg(g)")
  ) {
    console.log("1599 minor_process is valid.");
  }
}

//set_initial_item_variables(s_num_dict, formula_value, name_valuinput_enere) *** Function is not used

function update_form_selects(s_id, s_dict) {
  console.log(
    "1610 Entered update_form_selects and arguments s_id, s_dict",
    arguments
  );
  let select = document.getElementById(s_id);
  let opt = document.createElement("option");
  console.log("1615 select getElementById(s_id)", select);
  console.log(
    "1617 document.getElementById('select_minor_process') is temperature_to_pressure)",
    document.getElementById("select_minor_process.value")
  );
  s_units = select.options[select.selectedIndex].text;
  select.value = s_units;
  p_dict[s_dict]["units"] = s_units;
  console.log("1623 select.value ", s_id, s_units, select.value); //, p_dict[s_dict]['units'], p_dict[s_dict]['kl_units']);
  get_substance_values(s_dict);
  console.log("1625 get_substance_values ", substance_vars);
  console.log(
    "1627 update_form_selects ",
    s_id,
    s_dict,
    p_dict[s_dict]["units"],
    p_dict[s_dict]["M_qty"],
    EquationIsBalanced
  );
  // get_substance_values(s_dict);
  // console.log("1571 get_substance_values ", substance_vars);
  if (b_temperature_to_pressure == true) {
    openGuidanceModal(
      "The input you made is in conflict with the current minor process." +
        "Values are being reset."
    );
    console.log("1610 minor process is not null", minor_process);
    //console.log("1611 p_dict[s_dict]['qty'] is ", p_dict[s_dict]["qty"]);
    inputValue = p_dict[s_dict]["M_qty"];
    console.log("1644 inputValue ", inputValue);
    mole_mass_change(inputValue, s_id, s_dict);
    //p_dict[s_dict]["qty"] = substance_vars[5];
    refresh_display(s_dict);
    return "";

    // This process differentiates between regular units 'units',
    // and units associated with molarity and molality, 'kl_units' and 'mm_units'
    // in order to store the right value in the right units dictionary key.
    console.log("1252 update_form_selects", s_id, s_dict); // , p_dict[s_dict]['units']
  } else {
    if (s_units == "grams") {
      //(p_dict[s_dict]['units']} && (s_units == "atm" || s_units == "torr" || s_units == "mmHg" || s_units == "psi")) {
      p_dict[s_dict]["units"] = s_units;
      console.log("1652 units", p_dict[s_dict]["units"], s_units);
      E_text +=
        "<br>Substance units were changed to grams. " +
        ". A mole to mass coversion was called. " +
        "<br>Also, any changes in quantity or units associated with gas law calculations " +
        "will be stored, but not calculated unless main units are changed to liters(g)";
      set_explanation_text(E_text);
      inputValue = p_dict[s_dict]["M_qty"];
      mole_mass_change(inputValue, s_id, s_dict);
    } else if (s_units == "liters(g)") {
      inputValue = p_dict[s_dict]["M_qty"];
      // When units change to "liters(g)" use M_qty to calculate volume
      console.log(
        "1289 select.value ",
        s_id,
        s_units,
        select.value,
        inputValue
      );
      p_dict[s_dict]["units"] = s_units;
      if (E_text.includes("Substance units were changed to liters(g).")) {
        E_text += "<br>A gas law calculation function was called.";
        set_explanation_text(E_text);
      }
      // inputValue = p_dict[s_dict]["M_qty"];
      console.log(
        "1626 select.value ",
        s_id,
        s_units,
        select.value,
        p_dict[s_dict]["units"]
      );
      gas_volume_change(inputValue, s_units, s_id, s_dict);
    } else if (s_units == "C" || s_units == "K" || s_units == "F") {
      // (p_dict[s_dict]['units'] == 'grams') &&
      p_dict[s_dict]["temp_display_units"] = s_units;
      console.log(
        "1312 temp_display_units",
        p_dict[s_dict]["temp_display_units"]
      );
      E_text +=
        "<br>Substance units were changed to " +
        s_units +
        ". No change function will be called at this time.";
      set_explanation_text(E_text);
      //let inputValue = 0;
      //gas_volume_change(inputValue, s_id, s_dict);
      if (p_dict[s_dict]["units"] == "liters(g)") {
        // || s_units == "kilograms"
        console.log(
          "1323 select.value ",
          s_id,
          s_units,
          select.value,
          p_dict[s_dict]["units"]
        );

        E_text +=
          "<br>Substance units were changed to " +
          s_units +
          ". Since main units are liters(g), the gas law calculation function was called.";
        set_explanation_text(E_text);
        let inputValue = 0;
        console.log(
          "1337 select.value ",
          s_id,
          s_units,
          select.value,
          p_dict[s_dict]["units"]
        );
        gas_volume_change(inputValue, s_units, s_id, s_dict);
      }
    } else if (
      s_units == "atm" ||
      s_units == "torr" ||
      s_units == "mmHg" ||
      s_units == "Pa" ||
      s_units == "kPa" ||
      s_units == "psi"
    ) {
      // (p_dict[s_dict]['units'] == 'grams') &&
      p_dict[s_dict]["press_display_units"] = s_units;
      //p_dict[s_dict]['press_calc_qty'] = s_units; // press_display_qty: 1, press_calc_qty
      console.log(
        "1357 press_display_units",
        p_dict[s_dict]["press_display_units"]
      );
      E_text +=
        "<br>Substance units were changed to " +
        s_units +
        ". No change function will be called at this time.";
      set_explanation_text(E_text);
      //let inputValue = 0;
      //gas_volume_change(inputValue, s_id, s_dict);
      if (p_dict[s_dict]["units"] == "liters(g)") {
        console.log(
          "1370 select.value ",
          s_id,
          s_units,
          select.value,
          p_dict[s_dict]["units"]
        );
        if (s_units == "atm") {
          console.log("1377 select.value ", s_id, s_units);
          press_qty = p_dict[s_dict]["press_display_qty"];
          p_dict[s_dict]["press_calc_qty"] = press_qty;
          let inputValue = 0;
          console.log(
            "1382 select.value ",
            s_id,
            s_units,
            p_dict[s_dict]["units"]
          );
          E_text +=
            "<br>Substance units were changed to " +
            s_units +
            ". No change function will be called at this time.";
          set_explanation_text(E_text);
          gas_volume_change(inputValue, s_units, s_id, s_dict);
        } else if (s_units == "torr" || s_units == "mmHg") {
          console.log("886 select.value ", s_id, s_units);
          press_qty = p_dict[s_dict]["press_display_qty"] / 760;
          p_dict[s_dict]["press_calc_qty"] = press_qty;
          inputValue = 0;
          console.log(
            "1399 select.value ",
            s_id,
            s_units,
            p_dict[s_dict]["units"]
          );
          E_text +=
            "<br>Substance units were changed to " +
            s_units +
            ". No change function will be called at this time.";
          set_explanation_text(E_text);
          gas_volume_change(inputValue, s_units, s_id, s_dict);
        } else if (s_units == "Pa") {
          console.log("1712 select.value ", s_id, s_units);
          press_qty = convert_Pa_to_atm(p_dict[s_dict]["press_display_qty"]);
          p_dict[s_dict]["press_calc_qty"] = press_qty;
          press_qty = p_dict[s_dict]["press_calc_qty"] / 101325;
          inputValue = 0;
          console.log(
            "1719 select.value ",
            s_id,
            s_units,
            p_dict[s_dict]["units"],
            press_qty,
            p_dict[s_dict]["press_calc_qty"]
          );
          E_text +=
            "<br>Substance units were changed to " +
            s_units +
            ". No change function will be called at this time.";
          set_explanation_text(E_text);
          gas_volume_change(inputValue, s_units, s_id, s_dict);
        } else if (s_units == "kPa") {
          console.log("1731 select.value ", s_id, s_units);
          press_qty = convert_kPa_to_atm(p_dict[s_dict]["press_display_qty"]);
          p_dict[s_dict]["press_calc_qty"] = press_qty;
          inputValue = 0;
          console.log(
            "1736 select.value ",
            s_id,
            s_units,
            p_dict[s_dict]["units"],
            press_qty
          );
          E_text +=
            "<br>Substance units were changed to " +
            s_units +
            ". No change function will be called at this time.";
          set_explanation_text(E_text);
          gas_volume_change(inputValue, s_units, s_id, s_dict);
        } else if (s_units == "psi") {
          console.log("1451 select.value ", s_id, s_units);
          press_qty = convert_psi_to_atm(p_dict[s_dict]["press_display_qty"]);
          //press_qty = p_dict[s_dict]["press_calc_qty"] / 14.6959488;
          p_dict[s_dict]["press_calc_qty"] = press_qty;
          let inputValue = 0;
          console.log(
            "1456 select.value ",
            s_id,
            s_units,
            p_dict[s_dict]["units"],
            press_qty
          );
          E_text +=
            "<br>Substance units were changed to " +
            s_units +
            ". No change function will be called at this time.";
          set_explanation_text(E_text);
          gas_volume_change(inputValue, s_units, s_id, s_dict);
        }
      }

      console.log(
        "1451 p_dict[s_dict]['kl_units'], s_id ",
        s_units,
        p_dict[s_dict]["kl_units"],
        s_id
      );
    } else if (
      s_id == "s_1_mm_units" ||
      s_id == "s_2_mm_units" ||
      s_id == "s_3_mm_units" ||
      s_id == "s_4_mm_units" ||
      s_id == "s_4_mm_units" ||
      s_id == "s_6_mm_units"
    ) {
      console.log("801 s_id ==  ", select.value);
      p_dict[s_dict]["mm_units"] = select.value;
      E_text +=
        "<br>Substance units were changed to " +
        p_dict[s_dict]["kl_units"] +
        ". If the associated quantity is set, either a quantity of liters(l) or kilograms will be calculated. ";
      set_explanation_text(E_text);
      console.log(
        "806 p_dict[s_dict]['mm_units'] = ",
        p_dict[s_dict]["mm_units"]
      );
      console.log(
        "940 liter_qty & mm_qty equals ",
        p_dict[s_dict]["units"],
        p_dict[s_dict]["moles_molarity"],
        p_dict[s_dict]["M_qty"],
        p_dict[s_dict]["kl_qty"]
      );
    } else if (
      s_units == "liters(l)" &&
      p_dict[s_dict]["moles_molarity"] == "moles" &&
      p_dict[s_dict]["M_qty"] != 0 &&
      p_dict[s_dict]["kl_qty"] != 0
    ) {
      // p_dict[s_dict]['units']
      console.log("1860 select.value ", s_id, s_units, select.value);
      p_dict[s_dict]["kl_units"] = "liters(l)";
      var liter_qty = p_dict[s_dict]["kl_qty"];
      var mol_qty = p_dict[s_dict]["M_qty"];
      var mm_qty = mol_qty / liter_qty;

      //p_dict[s_dict]["mm_qty"] = mm_qty;
      //p_dict[s_dict]["mm_units"] = "molarity";
      p_dict[s_dict]["mm_qty"] = mm_qty;
      //s_1_mm_qty.value = mm_qty;
      p_dict[s_dict]["mm_units"] = "molarity";
      //s_1_mm_units.value = "molarity";
      console.log(
        "1866 liter_qty ",
        liter_qty,
        mm_qty,
        p_dict[s_dict]["mm_units"]
      );
      //var mm_qty = kl_mm_qty_dict[s_id]; kl_mm_units_dict[s_1_kl_units]
      console.log(
        "1868 s_id liter_qty & mm_qty equals ",
        s_id,
        liter_qty,
        mol_qty,
        p_dict[s_dict]["mm_qty"],
        p_dict[s_dict]["mm_units"]
        //s_id
      ); //, kl_mm_units_dict[s_id]);
      if (s_id == "s_1_kl_units") {
        console.log("1878  at if (s_id == 's_1_kl_units')");
        s_1_mm_qty.value = mm_qty;
        p_dict[s_dict]["mm_units"] = "molarity";
        s_1_mm_units.value = p_dict[s_dict]["mm_units"];
        console.log(
          "1882 p_dict[s_dict]['mm_units']",
          p_dict[s_dict]["mm_units"]
        );
      } else if (s_id == "s_2_kl_units") {
        console.log("1887  at if (s_id == 's_2_kl_units')");
        s_2_mm_qty.value = mm_qty;
        s_2_mm_units.value = "molarity";
      } else if (s_id == "s_3_kl_units") {
        s_3_mm_qty.value = mm_qty;
        s_3_mm_units.value = "molarity";
      } else if (s_id == "s_4_kl_units") {
        s_4_mm_qty.value = mm_qty;
        s_4_mm_units.value = "molarity";
      } else if (s_id == "s_5_kl_units") {
        s_5_mm_qty.value = mm_qty;
        s_5_mm_units.value = "molarity";
      } else if (s_id == "s_6_kl_units") {
        s_6_mm_qty.value = mm_qty;
        s_6_mm_units.value = "molarity";
      }
      console.log("1914 mm_qty equals ", mm_qty);
      p_dict[s_dict]["mm_units"] = "molarity";
      mm_units = p_dict[s_dict]["mm_units"]; //kl_mm_units_dict[s_id];
      console.log("1917 mm_units equals ", mm_units);
      //s_1_mm_units.value = "molarity"; //p_dict[s_dict]['mm_units'];
      console.log(
        "1920 Molarity equals ",
        p_dict[s_dict]["mm_qty"],
        p_dict[s_dict]["mm_units"]
      );
      E_text +=
        "<br>Substance liter(l)/kilograms units are liters(l), so molarity/molality units " +
        "were set to molarity and the quantity was set to " +
        p_dict[s_dict]["molarity_qty"] +
        " .";
      set_explanation_text(E_text);
    } else if (
      s_units == "kilograms" &&
      p_dict[s_dict]["moles_molarity"] == "moles" &&
      p_dict[s_dict]["M_qty"] != 0 &&
      p_dict[s_dict]["kl_qty"] != 0
    ) {
      //console.log("983 kl and mm units ", p_dict[s_dict]['kl_units'], p_dict[s_dict]['mm_units']);
      p_dict[s_dict]["kl_units"] = "kilograms";
      console.log("985 kl  units ", p_dict[s_dict]["kl_units"]);
      kilogram_qty = p_dict[s_dict]["kl_qty"];
      mol_qty = p_dict[s_dict]["M_qty"];
      mm_qty = mol_qty / kilogram_qty;
      p_dict[s_dict]["mm_qty"] = mm_qty;
      if (s_id == "s_1_kl_units") {
        p_dict[s_dict]["mm_qty"] = mm_qty;
        p_dict[s_dict]["mm_units"] = "molality";
        s_1_mm_qty.value = mm_qty;
        s_1_mm_units.value = "molality";
      } else if (s_id == "s_2_kl_units") {
        p_dict[s_dict]["mm_qty"] = mm_qty;
        p_dict[s_dict]["mm_units"] = "molality";
        s_2_mm_qty.value = mm_qty;
        s_2_mm_units.value = "molality";
      } else if (s_id == "s_3_kl_units") {
        p_dict[s_dict]["mm_qty"] = mm_qty;
        p_dict[s_dict]["mm_units"] = "molality";
        s_3_mm_qty.value = mm_qty;
        s_3_mm_units.value = "molality";
      } else if (s_id == "s_4_kl_units") {
        p_dict[s_dict]["mm_qty"] = mm_qty;
        p_dict[s_dict]["mm_units"] = "molality";
        s_4_mm_qty.value = mm_qty;
        s_4_mm_units.value = "molality";
      } else if (s_id == "s_5_kl_units") {
        s_5_mm_qty.value = mm_qty;
        p_dict[s_dict]["mm_qty"] = mm_qty;
        p_dict[s_dict]["mm_units"] = "molality";
        s_5_mm_units.value = "molality";
      } else if (s_id == "s_6_kl_units") {
        p_dict[s_dict]["mm_qty"] = mm_qty;
        p_dict[s_dict]["mm_units"] = "molality";
        s_6_mm_qty.value = mm_qty;
        s_6_mm_units.value = "molality";
      }
      console.log(
        "2006 kilogram_qty & mm_qty equals ",
        kilogram_qty,
        mm_qty,
        mm_units
      );
      console.log("2010 mm_units equals ", p_dict[s_dict]["mm_units"]);
      //mm_units.value = p_dict[s_dict]['mm_units'];
      console.log("841 Molality equals ", p_dict[s_dict]["mm_qty"]);
      E_text +=
        "<br>Substance liter/kilograms units are kilograms, so molarity/molality units " +
        "were set to molality and the quantity was set to " +
        p_dict[s_dict]["molality_qty"] +
        " .";
      set_explanation_text(E_text);

      console.log(
        "911 p_dict[s_dict]['kl_units'], s_id ",
        s_units,
        p_dict[s_dict]["kl_units"],
        s_id
      );
    } else if (
      s_id == "s_1_mm_units" ||
      s_id == "s_2_mm_units" ||
      s_id == "s_3_mm_units" ||
      s_id == "s_4_mm_units" ||
      s_id == "s_4_mm_units" ||
      s_id == "s_6_mm_units"
    ) {
      console.log("801 s_id ==  ", select.value);
      p_dict[s_dict]["mm_units"] = select.value;
      E_text +=
        "<br>Substance units were changed to " +
        p_dict[s_dict]["kl_units"] +
        ". If the associated quantity is set, either a quantity of liters(l) or kilograms will be calculated. ";
      set_explanation_text(E_text);
      console.log(
        "806 p_dict[s_dict]['mm_units'] = ",
        p_dict[s_dict]["mm_units"]
      );
      console.log(
        "940 liter_qty & mm_qty equals ",
        p_dict[s_dict]["units"],
        p_dict[s_dict]["moles_molarity"],
        p_dict[s_dict]["M_qty"],
        p_dict[s_dict]["kl_qty"]
      );
    } else if (
      s_id == "s_1_valence" ||
      s_id == "s_2_valence" ||
      s_id == "s_3_valence" ||
      s_id == "s_4_valence" ||
      s_id == "s_5_valence" ||
      s_id == "s_6_valence"
    ) {
      console.log("849 s_id ==  ", s_units);
      p_dict[s_dict]["valence"] = s_units;
      console.log("851 p_dict[s_dict]['valence'] = ", s_units);
      E_text +=
        "<br>Substance Valence/Charge quantity was changed to " +
        s_units +
        " .";
      // In this case, s_units is actually a selected quantity.
      set_explanation_text(E_text);
    } else if (major_process != "") {
      //  || minor_process != ''
      console.log("977 Major process  ", major_process, " was selected.");
    } else if (minor_process != "") {
      console.log("979 Minor process  ", minor_process, " was selected.");
    }
    console.log("2038 p_dict[s_dict]['mm_units']", p_dict[s_dict]["mm_units"]);
    refresh_display(s_dict);
  }
}

function substance_quantity_input(substance_ID) {
  //console.log("1109 ", substance_ID);
}

function update_form_temp_units(s_id, s_dict) {
  console.log(
    "2065 Entered update_form_temp_units and arguments s_id, s_dict",
    arguments
  );
  s_units = p_dict[s_dict]["units"];
  console.log("2129 s_units are ", s_units);
  // p_dict[s_dict]["temp_display_units"] = t_units;
  if (s_units == "liters(g)") {
    temp_units = document.getElementById(s_id).value;
    p_dict[s_dict]["temp_display_units"] = temp_units;
    console.log("2134 temp_units are ", temp_units);
    console.log(
      "2136 p_dict[s_dict]['temp_display_units'] are ",
      p_dict[s_dict]["temp_display_units"]
    );
    refresh_display(s_dict);
    console.log(
      "2141 s_id, s_units, t_units ",
      s_id,
      s_units,
      temp_units,
      p_dict[s_dict]["temp_display_qty"],
      p_dict[s_dict]["temp_display_units"]
    );
    gas_volume_change(inputValue, s_units, s_id, s_dict);
  }
}

function update_form_press_units(s_id, s_dict) {
  console.log(
    "2094 Entered update_form_press_units and arguments s_id, s_dict",
    arguments
  );
  s_units = p_dict[s_dict]["units"];
  console.log("2217 s_units are ", s_units);
  // p_dict[s_dict]["temp_display_units"] = t_units;
  if (s_units == "liters(g)") {
    press_units = document.getElementById(s_id).value;
    p_dict[s_dict]["press_display_units"] = press_units;
    console.log("2222 press_units are ", press_units);
    console.log(
      "2136 p_dict[s_dict]['press_display_units'] are ",
      p_dict[s_dict]["press_display_units"]
    );
    refresh_display(s_dict);
    console.log(
      "2229 s_id, s_units, press_units ",
      s_id,
      s_units,
      press_units,
      p_dict[s_dict]["press_display_qty"],
      p_dict[s_dict]["press_display_units"]
    );
    gas_volume_change(inputValue, s_units, s_id, s_dict);
  }
}

function setSelectedHeatUnits(substance_ID) {
  //console.log("1031 setSelectedHeatUnits", substance_ID);
}
function get_substance_values(s_dict) {
  console.log("2093 get_substance_values ", s_dict);
  substance_vars[0] = EquationIsBalanced;
  substance_vars[1] = minor_process;
  substance_vars[2] = p_dict[s_dict]["id"];
  substance_vars[3] = p_dict[s_dict]["type"];
  substance_vars[4] = p_dict[s_dict]["formula"];
  substance_vars[5] = p_dict[s_dict]["qty"];
  substance_vars[6] = p_dict[s_dict]["units"];
  substance_vars[7] = p_dict[s_dict]["M_qty"];
  substance_vars[8] = p_dict[s_dict]["kl_qty"];
  substance_vars[9] = p_dict[s_dict]["kl_units"];
  substance_vars[10] = p_dict[s_dict]["mm_qty"];
  substance_vars[11] = p_dict[s_dict]["mm_units"];
  substance_vars[12] = p_dict[s_dict]["temp_display_qty"];
  substance_vars[13] = p_dict[s_dict]["temp_display_units"];
  substance_vars[14] = p_dict[s_dict]["press_display_qty"];
  substance_vars[15] = p_dict[s_dict]["press_display_units"];
  substance_vars[16] = p_dict[s_dict]["press_calc_qty"];
  substance_vars[17] = p_dict[s_dict]["press_calc_units"];
  // console.log("2118 substance_vars ", substance_vars);
}

function input_temp_qty_change(e, s_id, s_dict) {
  // input_temp_qty_change(event, 's_1_temp_qty', 's_1_dict')"
  // Temp change will either change vol_qty or
  // if minor process is temp to press, it will change press qty
  console.log("2200 entered input_temp_qty_change ", e, s_1_temp_qty, s_dict);
  console.log("2201 b_temperature_to_pressure is ", b_temperature_to_pressure);
  temp_qty = p_dict[s_dict]["temp_display_qty"] =
    document.getElementById(s_id).value;
  console.log("2163 temp_display_qty is ", temp_qty);
  console.log("2164 s_id.value is ", document.getElementById(s_id).value);
  get_substance_values(s_dict);
  console.log("2254 get_substance_values ", substance_vars);
  if (
    p_dict[s_dict]["units"] === "liters(g)" &&
    b_temperature_to_pressure === false &&
    (s_id == "s_1_temp_qty" ||
      s_id == "s_2_temp_qty" ||
      s_id == "s_3_temp_qty" ||
      s_id == "s_4_temp_qty" ||
      s_id == "s_5_temp_qty" ||
      s_id == "s_6_temp_qty")
  ) {
    console.log(
      "2132 units are liters(g) and either a temp quantity was changed."
    );
    console.log("2134 temp_qty, s_id, s_dict ", temp_qty, s_id, s_dict);
    temp_qty = calc_temp_qty(s_id, s_dict); // returns calc_temp_qty
    press_qty = calc_press_qty(s_id, s_dict);
    //press_qty = p_dict[s_dict]["press_calc_qty"];
    console.log(
      "2184 temp_qty and press_qty are ",
      temp_qty,
      p_dict[s_dict]["temp_calc_qty"],
      press_qty,
      p_dict[s_dict]["press_calc_qty"]
    );
    mol_qty = p_dict[s_dict]["M_qty"];
    // vol_qty = p_dict[s_dict]["qty"];
    vol_qty = (mol_qty * 0.08206 * temp_qty) / press_qty;
    console.log("2194 vol_qty ", vol_qty, p_dict[s_dict]["units"]);
    p_dict[s_dict]["qty"] = vol_qty;
    console.log("2196 vol_qty ", vol_qty, p_dict[s_dict]["qty"]);

    //gas_volume_change(temp_qty, s_id, s_dict);
    console.log("2199 Temperature was changed to ", temp_qty, " ", temp_units);

    if (E_text.includes("2146 Since main substance units are liters(g),")) {
      E_text +=
        "<br>2203 Temperature was changed to " +
        temp_qty +
        " " +
        temp_units +
        ".";
      set_explanation_text(E_text);
    } else
      E_text +=
        "<br>2211 Temperature was changed to " +
        temp_qty +
        " " +
        "K" +
        "." +
        "<br>Since main substance units are liters(g), a gas law calculation function was called.";
    set_explanation_text(E_text);
    refresh_display(s_dict);
  } else if (
    p_dict[s_dict]["units"] === "liters(g)" &&
    b_temperature_to_pressure == true &&
    //(temp_unit_list.includes(s_id))
    (s_id == "s_1_temp_qty" ||
      s_id == "s_2_temp_qty" ||
      s_id == "s_3_temp_qty" ||
      s_id == "s_4_temp_qty" ||
      s_id == "s_5_temp_qty" ||
      s_id == "s_6_temp_qty")
  ) {
    console.log("2271 in input_temp_qty_change at minor process.");
    console.log("2272 temp_qty, s_id, s_dict ", temp_qty, s_id, s_dict);
    temp_qty = calc_temp_qty(s_id, s_dict);
    console.log("2274 temp_qty is ", temp_qty);
    press_qty = p_dict[s_dict]["press_calc_qty"];
    mol_qty = p_dict[s_dict]["M_qty"];
    press_qty = (mol_qty * 0.08206 * temp_qty) / vol_qty;
    // PV = nRT P = nrt/V
    console.log("2279 press_calc_qty ", press_qty);
    p_dict[s_dict]["press_calc_qty"] = press_qty;
    p_dict[s_dict]["press_display_qty"] =
      convert_calc_press_to_display_press(s_dict);
    b_temperature_to_pressure = false;
    console.log(
      "2285 press_display_qty ",
      press_qty,
      p_dict[s_dict]["press_display_qty"]
    );
    b_temperature_to_pressure = false;
    document.getElementById("select_minor_process").selectedIndex = 0;
    //document.getElementById("minor_process").selectedIndex = 0;
    console.log("2240 temperature_to_pressure is ", b_temperature_to_pressure);
    console.log(
      "2242 document.getElementById('select_minor_process is ', temperature_to_pressure)",
      document.getElementById("select_minor_process.value")
    );

    console.log(
      "2311 press_display_qty ",
      press_qty,
      p_dict[s_dict]["press_display_qty"]
    );
    console.log("2315 substance qty is ", p_dict[s_dict]["qty"]);
    refresh_display(s_dict);
    console.log("2317 substance qty is ", p_dict[s_dict]["qty"]);
  }
}

function input_press_qty_change(e, s_id, s_dict) {
  console.log("2361 entered input_press_qty_change ", e, s_id, s_dict);
  press_qty = document.getElementById(s_id).value;
  p_dict[s_dict]["press_display_qty"] = press_qty;
  console.log("2364", document.getElementById(s_id).value, press_qty);
  get_substance_values(s_dict);
  console.log("2366 get_substance_values ", substance_vars);
  if (
    p_dict[s_dict]["units"] == "liters(g)" &&
    pressure_to_temperature == false && // press_qty_list
    press_qty_list.includes(s_id)
  ) {
    console.log(
      "2373 units are liters(g) and either a temp or press quantity was changed."
    );
    console.log("2375 press_qty, s_id, s_dict ", press_qty, s_id, s_dict);
    press_qty = calc_press_qty(s_id, s_dict);
    p_dict[s_dict]["press_calc_qty"] = press_qty;
    console.log("2273 calc_press_qty is ", press_qty);
    temp_qty = p_dict[s_dict]["temp_calc_qty"];
    mol_qty = p_dict[s_dict]["M_qty"];
    vol_qty = (mol_qty * 0.08206 * temp_qty) / press_qty;
    console.log("2139 vol_qty ", vol_qty, p_dict[s_dict]["units"]);
    p_dict[s_dict]["qty"] = vol_qty;
    console.log("2141 vol_qty ", vol_qty, p_dict[s_dict]["qty"]);

    //gas_volume_change(temp_qty, s_id, s_dict);
    console.log("2256 Pressure was changed to ", press_qty, " ", press_units);

    if (E_text.includes("2258 Since main substance units are liters(g),")) {
      E_text +=
        "<br>2260 Pressure was changed to " +
        press_qty +
        " " +
        press_units +
        ".";
      set_explanation_text(E_text);
    } else
      E_text +=
        "<br>2268 Pressure was changed to " +
        press_qty +
        " " +
        "K" +
        "." +
        "<br>Since main substance units are liters(g), a gas law calculation function was called.";
    set_explanation_text(E_text);
    refresh_display(s_dict);
  } else if (
    p_dict[s_dict]["units"] === "liters(g)" &&
    b_temperature_to_pressure &&
    press_qty_list.includes(s_id)
  ) {
    console.log("2286 in input_press_qty_change at minor process.");
    console.log("2287 temp_qty, s_id, s_dict ", temp_qty, s_id, s_dict);
    temp_qty = calc_temp_qty(s_dict);
    console.log("2289 temp_qty is ", temp_qty);
    temp_qty = p_dict[s_dict]["temp_calc_qty"];
    mol_qty = p_dict[s_dict]["M_qty"];
    temp_qty = (press_qty * vol_qty) / (mol_qty * 0.08206);
    // PV = nRT P = nrt/V T = PV/nr
    console.log("2192 temp_qty ", temp_qty);
    p_dict[s_dict]["temp_calc_qty"] = temp_qty;
    p_dict[s_dict]["temp_display_qty"] =
      convert_calc_temp_to_display_temp(s_dict);
    console.log(
      "2190 temp_display_qty ",
      temp_qty,
      p_dict[s_dict]["temp_display_qty"]
    );
    refresh_display(s_dict);
  }
  substance_vars = [];
}

function input_qty_change(e, s_id, s_dict) {
  get_substance_values(s_dict);
  console.log("2455 get_substance_values ", substance_vars);
  console.log(
    "2457 input_qty_change ",
    s_id,
    s_dict,
    p_dict[s_dict]["units"],
    EquationIsBalanced
  );
  get_substance_values(s_dict);
  console.log("2465 get_substance_values ", substance_vars);

  try {
    var inputValue = document.getElementById(e.target.id).value;
    console.log(
      "2470 input_qty_change",
      inputValue,
      s_id,
      s_dict,
      p_dict[s_dict]["units"]
    );
  } catch (err) {
    console.log("2477 error finding event e in input_qty_change");
    var inputValue = e.value;
  }
  if (EquationIsBalanced == "True") {
    console.log("2369 be_list is ", be_list);
    if (be_list[0] == 0) {
      be_list[0] = p_dict[s_dict]["M_qty"];
      console.log("2372 be_list is ", be_list);
    }
  }
  //  *** the main quantity was changed; s_id is the id of the form widget; s_dict is the substance dict to use
  // *** If the s_id refers to the substance quantity,
  // e.g., 's_1_qty', the s_id will be in the qty_list,
  // so, use the mass_mole_ change or the gas_volume_change formula
  // *** If the s_id refers to the mole quantity,
  // e.g., 's_1_m_qty', use the mole_to_mass or the
  // gas_volume_change formula
  if (qty_list.includes(s_id)) {
    // like s_1_qty
    //  *** the units will determine whether to use solid (grams) or gas (liters(g) formulas.)
    if (p_dict[s_dict]["units"] == "grams") {
      //  && minor_process[0] == ''  && minor_process[0] == []
      console.log("2386 p_dict[s_dict]['units'] ", p_dict[s_dict]["units"]);
      // s_id is ~ s_1_qty and units are grams, so use -->
      mass_mole_change(inputValue, s_id, s_dict);
      //E_text += "<br>User input quantity " + inputValue + " ."
      //+ "<br>Since main substance units are grams, a new mole quantity was calculated.";
      //set_explanation_text(E_text)
    } else if (p_dict[s_dict]["units"] == "liters(g)") {
      console.log("1852 p_dict[s_dict]['units'] ", p_dict[s_dict]["units"]);
      // s_id is ~ s_1_qty and units are liters(g), so use -->
      gas_volume_change(inputValue, s_units, s_id, s_dict);
    } else {
      //if (p_dict[s_dict]['units'] != 'grams' || p_dict[s_dict]['units'] == 'liters(g)') --> invalid units
      console.log("2398 Not a valid input quantity change.");
    }
  } else if (m_qty_list.includes(s_id)) {
    // like s_1_m_qty
    p_dict[s_dict]["M_qty"] = inputValue;
    console.log(
      "2447 ",
      inputValue,
      p_dict[s_dict]["M_qty"],
      p_dict[s_dict]["molarity_qty"],
      p_dict[s_dict]["mm_qty"]
    ); //
    console.log("2428 ", inputValue, s_id, s_dict, p_dict[s_dict]["M_qty"]); // s_dict['M_qty'] and p_dict[s_dict]['M_qty'], don't work
    console.log("1082 minor_process =", minor_process);
    if (minor_process == "molarity or moles to liters") {
      molarity_moles_to_liters(s_id, s_dict);
    } else if (minor_process == "molality or moles to kilograms") {
      molality_moles_to_kilograms(p_dict, s_dict);
    } else {
      mole_mass_change(inputValue, s_id, s_dict);
      console.log("1089 inputValue, s_id, s_dict ", inputValue, s_id, s_dict); // s_dict['M_qty'] and p_dict[s_dict]['M_qty'], don't work
    }
    //  *** the liter/kilogram quantity was changed
  } else if (
    s_id == "s_1_kl_qty" ||
    s_id == "s_2_kl_qty" ||
    s_id == "s_3_kl_qty" ||
    s_id == "s_4_kl_qty" ||
    s_id == "s_5_kl_qty" ||
    s_id == "s_6_kl_qty"
  ) {
    console.log("1094 ", inputValue, s_id, s_dict);
    p_dict[s_dict]["kl_qty"] = inputValue;
    console.log("1096 p_dict[s_dict]['kl_qty'] ", p_dict[s_dict]["kl_qty"]);
    //  *** the molarity/molality quantity was changed
  } else if (
    s_id == "s_1_mm_qty" ||
    s_id == "s_2_mm_qty" ||
    s_id == "s_3_mm_qty" ||
    s_id == "s_4_mm_qty" ||
    s_id == "s_5_mm_qty" ||
    s_id == "s_6_mm_qty"
  ) {
    console.log("2069 ", inputValue, s_id, s_dict);
    p_dict[s_dict]["mm_qty"] = inputValue;
    console.log("1102 p_dict[s_dict]['mm_qty'] ", p_dict[s_dict]["mm_qty"]);
    if (minor_process == "molarity or moles to liters") {
      console.log("1219 minor_process == 'molarity or moles to liters'");
      molarity_moles_to_liters(s_id, s_dict);
    } else if (minor_process == "molarity moles to kilograms") {
      console.log("1221 minor_process == 'molarity and moles to kilograms'");
      molality_moles_to_kilograms(p_dict, s_dict);
    } else if (minor_process == "molarity or liters to moles") {
      console.log("2079 minor_process == 'molarity or liters to moles'");
      molarity_liters_to_moles(s_id, s_dict);
    } else if (minor_process == "volume to temperature") {
      console.log("2079 minor_process == 'volume to temperature'");
      volume_to_temperature = true;
    } else if (minor_process == "volume to pressure") {
      console.log("2079 minor_process == 'volume to pressure'");
      volume_to_pressure = true;
    } else if (minor_process == "pressure to temperature") {
      console.log("2079 minor_process == 'pressure to temperature'");
      pressure_to_temperature = true;
    } else if (minor_process == "temperature to pressure") {
      console.log("2079 minor_process == 'temperature to pressure'");
      b_temperature_to_pressure = true;
    } else {
      mole_mass_change(inputValue, s_id, s_dict);
      console.log("1109 ", inputValue, s_id, s_dict); // s_dict['M_qty'] and p_dict[s_dict]['M_qty'], don't work
    }
    //  *** the pressure quantity was changed while the main units are liters(g) s_1_press_qty
  }
  //qty_values[s_id] = inputValue;
  //console.log("1165 QTY Values", qty_values[s_id]);
}

function mass_mole_change(inputValue, s_id, s_dict) {
  console.log(
    "2708 mass_mole_change ",
    inputValue,
    s_id,
    s_dict,
    p_dict[s_dict]["units"],
    EquationIsBalanced
  );
  if (p_dict[s_dict]["units"] == "grams") {
    // s_dict['units'] does not work
    console.log("1158 s_1_dict['units'] = ", s_1_dict["units"]);
    console.log("1159 p_dict[s_dict]['units'] = ", p_dict[s_dict]["units"]);
    var display_qty = inputValue;
    p_dict[s_dict]["qty"] = display_qty; // s_dict.value['qty'] does not work
    console.log("1162 s_dict['qty'] ", p_dict[s_dict]["qty"]);
    var saved_qty = p_dict[s_dict]["qty"];
    console.log("1164 s_dict['qty'] ", saved_qty);
    var saved_mass = p_dict[s_dict]["mass"];
    console.log("1166 s_dict['mass'] ", saved_mass);
    var new_mol_qty = saved_qty / saved_mass;
    console.log("1168 new_mol_qty] ", new_mol_qty);
    p_dict[s_dict]["M_qty"] = new_mol_qty;
    if (EquationIsBalanced == "True") {
      /*If EquationIsBalanced == "True", and the mass was changed,
            set the be_list mole quantity to the new mole quantity 
            */
      console.log(
        "2163 be_list and EquationIsBalanced are ",
        be_list,
        EquationIsBalanced
      );
      if (be_list[7] == "0") {
        be_list[7] = p_dict[s_dict]["M_qty"];
        adjust_balanced_equation(s_dict, p_dict[s_dict]["M_qty"]);
        console.log("1178 be_list is ", be_list);
      }
    }
    if (E_text.includes("Formula used is  moles = quantity / molar mass.")) {
      E_text +=
        "<br>User input quantity of " +
        inputValue +
        " " +
        p_dict[s_dict]["units"] +
        " ." +
        "<br>Since units are grams, program divided the input quantity by the substance mass of " +
        p_dict[s_dict]["mass"] +
        " to get a new mole quantity of " +
        new_mol_qty;
      set_explanation_text(E_text);
    } else
      E_text +=
        "<br>User input quantity of " +
        inputValue +
        " " +
        p_dict[s_dict]["units"] +
        " ." +
        "<br>Since units are grams, program divided the input quantity by the substance mass of " +
        p_dict[s_dict]["mass"] +
        " to get a new mole quantity of " +
        new_mol_qty +
        "<br>Formula used is moles = quantity / molar mass.";
    set_explanation_text(E_text);
    console.log("1195 s_dict['M_qty'] ", p_dict[s_dict]["M_qty"]);
  } else if (p_dict[s_dict]["units"] == "kilograms") {
    console.log("1198 s_dict['units'] = 'kilograms'");
    console.log("1199 kilograms units code has not been implemented.");
  } else if (p_dict[s_dict]["units"] == "liters(l)") {
    console.log("1201 s_dict['units'] = 'liters(l)'");
    console.log("1202 liters(l) units code has not been implemented.");
  } else if (p_dict[s_dict]["units"] == "liters(g)") {
    console.log("1204 s_dict['units'] ", p_dict[s_dict]["units"]);
    gas_volume_change(inputValue, s_units, s_id, s_dict);
  }
  refresh_display(s_dict);
}

function mole_mass_change(inputValue, s_id, s_dict) {
  console.log(
    "2628 in mole_mass_change ",
    inputValue,
    s_id,
    s_dict,
    p_dict[s_dict]["units"],
    EquationIsBalanced
  );
  // ** if (EquationIsBalanced == "True") is processed later
  if (p_dict[s_dict]["units"] == "grams") {
    // s_dict['units'] does not work p_dict[s_dict]['units']
    console.log("1215 s_dict['units'] = ", p_dict[s_dict]["units"]);
    var display_qty = inputValue;
    if (
      (inputValue != 0 && s_id == "s_1_qty") ||
      s_id == "s_2_qty" ||
      s_id == "s_3_qty" ||
      s_id == "s_4_qty" ||
      s_id == "s_5_qty" ||
      s_id == "s_6_qty"
    ) {
      p_dict[s_dict]["M_qty"] = inputValue;
    }

    console.log("1218 p_dict[s_dict]['M_qty'] ", p_dict[s_dict]["M_qty"]);
    var current_mass = p_dict[s_dict]["mass"];
    console.log("1220 current_mass ", current_mass);
    var new_qty = inputValue * current_mass;
    E_text +=
      "<br>User input new mole quantity of " +
      inputValue +
      " ." +
      "<br>Since substance units are grams, program multiplied the input mole quantity " +
      inputValue +
      " times the substance mass of " +
      p_dict[s_dict]["mass"] +
      " to get a new substance quantity of " +
      new_qty +
      " " +
      p_dict[s_dict]["units"] +
      " ." +
      "<br> Formula used is quantity = moles * molar mass.";
    set_explanation_text(E_text);
    p_dict[s_dict]["qty"] = new_qty;
  } else if (p_dict[s_dict]["kl_units"] == "kilograms") {
    console.log("1230 s_dict['kl_units'] = 'kilograms'");
  } else if (
    p_dict[s_dict]["kl_units"] &&
    p_dict[s_dict]["moles_molarity"] == "moles"
  ) {
    console.log("1232 s_dict['kl_units'] = 'liters(l)'");
    //p_dict[s_dict]['mm_units'] == 'molarity';
    //p_dict[s_dict]['kl_qty'] == 'molarity';
    //kl_qty
  } else if (p_dict[s_dict]["units"] == "liters(g)") {
    console.log("2839 p_dict[s_dict]['units'] is'", p_dict[s_dict]["units"]);
    var display_qty = inputValue;
    p_dict[s_dict]["M_qty"] = display_qty;
    console.log("2842 p_dict[s_dict]", s_dict, p_dict[s_dict]["M_qty"]);
    gas_volume_change(inputValue, s_units, s_id, s_dict);
  }

  refresh_display(s_dict); //

  // console.log("2848 be_list is ", be_list, be_list[0], be_list[1], be_list[7]);

  if (EquationIsBalanced == "True") {
    console.log("2851 be_list is ", be_list);
    if (be_list[7] == "0") {
      be_list[7] = p_dict[s_dict]["M_qty"];
      adjust_balanced_equation(s_dict, p_dict[s_dict]["M_qty"]);
      console.log("2855 be_list is ", be_list);
    }
  }
}

function adjust_balanced_equation(s_dict, M_qty) {
  console.log(
    "1359 entered adjust_balanced_equation(s_dict, M_qty) are ",
    s_dict,
    M_qty,
    EquationIsBalanced
  );
  //process_yield = document.getElementById('process_yield');
  console.log("1361 Check change_Process_Yield");
  if (process_yield == "null") {
    process_yield = 0.75;
    gen_dict["process_yield"] = process_yield;
    console.log("1365 ", process_yield);
  }
  //gen_dict['process_yield'] = process_yield;
  console.log("1368 ", process_yield, gen_dict["process_yield"]);
  //be_list[0] = p_dict[s_dict]['M_qty'];
  //be_list[8] = p_dict[s_dict]['M_qty'];
  console.log("1371 be_list is ", be_list);
  E_text += "<br> EquationIsBalanced = True" + "<br>" + be_list;
  set_explanation_text(E_text);
  // For each substance from 1 thru 6, calculate the mole to mole ratio, be_list[0] to be_list[1], etc
  // apply the mole to mole ratio to the mole qty in the first substance changed be_list[7]
  // and change the mole quantity of the substance.
  for (let i = 1; i < 7; i++) {
    m_m_ratio = be_list[i] / be_list[0];
    console.log("1280 i and m_m_ratio are ", i, " ", m_m_ratio);
    new_mol_qty = m_m_ratio * be_list[7];
    console.log("1282 m_m_ratio and new_mol_qty are ", i, " ", new_mol_qty);
    if (i == 1) {
      console.log("1284 new_mol_qty is ", m_m_ratio, new_mol_qty);
      p_dict["s_1_dict"]["M_qty"] = new_mol_qty;
      s_1_m_qty.value = new_mol_qty;
      mole_mass_change(new_mol_qty, "s_1_dict", "s_1_dict");
      // s_1_qty.value = p_dict['s_1_dict']['qty'];
      console.log("1289 new_mol_qty is ", m_m_ratio, new_mol_qty);
    } else if (i == 2) {
      console.log("1291 new_mol_qty is ", m_m_ratio, new_mol_qty);
      p_dict["s_2_dict"]["M_qty"] = new_mol_qty;
      s_2_m_qty.value = new_mol_qty;
      mole_mass_change(new_mol_qty, "s_2_dict", "s_2_dict");
      s_2_qty.value = p_dict["s_2_dict"]["qty"];

      console.log("1296 new_mol_qty is ", m_m_ratio, new_mol_qty);
    } else if (i == 3) {
      p_dict["s_3_dict"]["M_qty"] = new_mol_qty;
      s_3_m_qty.value = new_mol_qty;
      mole_mass_change(new_mol_qty, "s_3_dict", "s_3_dict");
      s_3_qty.value = p_dict["s_3_dict"]["qty"];
      console.log("2822 new_mol_qty is ", m_m_ratio, new_mol_qty);
    } else if (i == 4) {
      p_dict["s_4_dict"]["M_qty"] = new_mol_qty * gen_dict["process_yield"];
      s_4_m_qty.value = new_mol_qty * gen_dict["process_yield"];
      mole_mass_change(p_dict["s_4_dict"]["M_qty"], "s_4_dict", "s_4_dict");
      s_4_qty.value = p_dict["s_4_dict"]["qty"];
      console.log("1308 new_mol_qty is ", m_m_ratio, new_mol_qty);
    } else if (i == 5) {
      p_dict["s_5_dict"]["M_qty"] = new_mol_qty * gen_dict["process_yield"];
      s_5_m_qty.value = new_mol_qty * gen_dict["process_yield"];
      mole_mass_change(p_dict["s_5_dict"]["M_qty"], "s_5_dict", "s_5_dict");
      s_5_qty.value = p_dict["s_5_dict"]["qty"];
      console.log("1314 new_mol_qty is ", new_mol_qty);
    } else if (i == 6) {
      p_dict["s_6_dict"]["M_qty"] = new_mol_qty * gen_dict["process_yield"];
      s_6_m_qty.value = new_mol_qty * gen_dict["process_yield"];
      mole_mass_change(p_dict["s_6_dict"]["M_qty"], "s_6_dict", "s_6_dict");
      s_6_qty.value = p_dict["s_6_dict"]["qty"];
      console.log("1320 new_mol_qty is ", m_m_ratio, new_mol_qty);
    }
    //console.log("1240 ", m_m_ratio, new_mol_qty);
    // E_text += "<br> m_m_ratio is " + m_m_ratio + " : " + new_mol_qty;
    // set_explanation_text(E_text);
  }
  EquationIsBalanced = "False";
}

function gas_volume_change(inputValue, s_units, s_id, s_dict) {
  // debugger;
  console.log(
    "2725 gas_volume_change values ",
    inputValue,
    s_units,
    s_id,
    s_dict
  );
  mol_qty = p_dict[s_dict]["M_qty"];
  console.log("2733 mol_qty ", inputValue, mol_qty);
  temp_qty = calc_temp_qty(s_id, s_dict);
  press_qty = calc_press_qty(s_id, s_dict);
  //vol_qty = p_dict[s_dict]["qty"];
  if (s_units == "liters(g)" && qty_list.includes(s_id)) {
    console.log("2735 s_id ", s_id);
    // vol_qty = inputValue;
    mol_qty = (inputValue * press_qty) / (0.08206 * temp_qty);
    // vol_qty = (mol_qty * 0.08206 * temp_qty) / press_qty;
    p_dict[s_dict]["M_qty"] = mol_qty;
    p_dict[s_dict]["qty"] = inputValue;
    // p_dict[s_dict]["M_qty"] = mol_qty;
    console.log("2743 mol_qty etc. ", mol_qty, p_dict[s_dict]["qty"]);
  } else if (s_units == "liters(g)" && m_qty_list.includes(s_id)) {
    //
    // if (s_units == "liters(g)" && s_id == "s_1_m_qty")
    console.log("2746 s_id ", s_id);
    vol_qty = (mol_qty * 0.08206 * temp_qty) / press_qty;
    console.log("2747 vol_qty ", vol_qty);
    p_dict[s_dict]["qty"] = vol_qty;
    console.log("2749 vol_qty ", p_dict[s_dict]["qty"]);
    // mol_qty = (inputValue * press_qty) / (0.08206 * temp_qty);
  } else if (s_units == "liters(g)") {
    //
    // if (s_units == "liters(g)" && s_id == "s_1_m_qty")
    console.log("2755 s_id ", s_id);
    vol_qty = (mol_qty * 0.08206 * temp_qty) / press_qty;
    console.log("2757 vol_qty ", vol_qty);
    p_dict[s_dict]["qty"] = vol_qty;
    console.log("2759 vol_qty ", p_dict[s_dict]["qty"]);
  } else {
    console.log("2754 not liters or in qty_list or m_qty_list ");
  }
  // p_dict[s_dict]["qty"] = vol_qty;
  // console.log(
  //   "2923 ",
  //   inputValue,
  //   mol_qty,
  //   temp_qty,
  //   press_qty,
  //   vol_qty,
  //   p_dict[s_dict]["qty"]
  // );
  refresh_display(s_dict);
}

function calc_temp_qty(s_id, s_dict) {
  console.log(
    "3148 entered calc_temp_qty, temp_display_units",
    s_id,
    s_dict,
    p_dict[s_dict]["temp_display_units"]
  );
  temp_units = p_dict[s_dict]["temp_display_units"];
  console.log("3145 temp_units are ", temp_units);
  if (temp_units == "C") {
    let C = p_dict[s_dict]["temp_display_qty"];
    temp_qty = convert_C_to_K(C);
    p_dict[s_dict]["temp_calc_qty"] = temp_qty;
    console.log("3151 C to K ", C, temp_qty);
    E_text += t_sstc;
    set_explanation_text(E_text);
    return temp_qty;
  } else if (temp_units == "K") {
    temp_qty = p_dict[s_dict]["temp_display_qty"];
    E_text +=
      "<br>Temperature units were changed to K. Program uses degrees K " +
      "to make gas law calculations.";
    set_explanation_text(E_text);
    return temp_qty;
  } else if (temp_units == "F") {
    F = p_dict[s_dict]["temp_display_qty"];
    temp_qty = convert_F_to_K(F); // //
    p_dict[s_dict]["temp_calc_qty"] = temp_qty;
    E_text += t_sstf;
    set_explanation_text(E_text);
    return temp_qty;
  }
}

function calc_press_qty(s_id, s_dict) {
  console.log(
    "3216 entered calc_press_qty, press_display_units",
    s_id,
    s_dict,
    p_dict[s_dict]["press_display_units"]
  );
  press_units = p_dict[s_dict]["press_display_units"];
  console.log("3222 press_display_units are ", press_units);
  if (press_units == "atm") {
    press_qty = p_dict[s_dict]["press_display_qty"];
    //  no conversion is needed, press_qty is already in atm
    p_dict[s_dict]["press_calc_qty"] = press_qty;
    console.log("3228 press_qty is", press_qty);
    E_text +=
      "<br>Pressure units were changed to atm. No conversion is needed " +
      "and make gas law calculations.";
    set_explanation_text(E_text);
    return press_qty;
  } else if (press_units == "torr" || press_units == "mmHg") {
    console.log("3235 gas_volume_change at press_units == torr or mmHg");
    press_qty = p_dict[s_dict]["press_display_qty"];
    press_qty = press_qty / 760;
    console.log("2238 torr or mmHg to atm ", press_qty, press_qty);
    E_text +=
      "<br>Pressure units were changed to torr or mmHg. Program will convert pressure into atmospheres and make gas law calculations.";
    set_explanation_text(E_text);
    return press_qty;
  } else if (press_units == "kPa") {
    press_qty = p_dict[s_dict]["press_display_qty"];
    press_qty = press_qty / 101.325;
    console.log("2366 press_qty is ", press_qty);
    E_text +=
      "<br>Pressure units were changed to psi. Program will convert pressure in psi into atmospheres " +
      "and make gas law calculations.";
    set_explanation_text(E_text);
    return press_qty;
  } else if (press_units == "Pa") {
    press_qty = p_dict[s_dict]["press_display_qty"];
    press_qty = press_qty / 101325;
    E_text +=
      "<br>Pressure units were changed to psi. Program will convert pressure in psi into atmospheres " +
      "and make gas law calculations.";
    set_explanation_text(E_text);
    return press_qty;
  } else if (press_units == "psi") {
    press_qty = p_dict[s_dict]["press_display_qty"];
    press_qty = press_qty / 14.696;
    E_text +=
      "<br>Pressure units were changed to psi. Program will convert pressure in psi into atmospheres " +
      "and make gas law calculations.";
    set_explanation_text(E_text);
    return press_qty;
  }
  // return press_qty;
}

function convert_calc_press_to_display_press(s_dict) {
  press_qty = p_dict[s_dict]["press_calc_qty"];
  press_units = p_dict[s_dict]["press_display_units"];
  console.log("3040 press_qty, press_units ", press_qty, press_units);
  if (press_units == "atm") {
    p_dict[s_dict]["press_display_qty"] = press_qty;
    console.log("2995 atm is ", press_qty, p_dict[s_dict]["press_display_qty"]);
    return press_qty;
  } else if (press_units == "torr" || press_units == "mmHg") {
    p_dict[s_dict]["press_display_qty"] = press_qty * 760;
    console.log(
      "3004 torr to atm ",
      p_dict[s_dict]["press_display_qty"],
      press_qty
    );
    return press_qty * 760;
  } else if (press_units == "kPa") {
    p_dict[s_dict]["press_display_qty"] = press_qty * 101.325;
    console.log("3007 kPa to atm ", press_qty, press_qty);
    return press_qty * 101.325;
  } else if (press_units == "Pa") {
    p_dict[s_dict]["press_display_qty"] = press_qty * 101325;
    console.log("3010 Pa to atm ", press_qty, press_qty);
    return press_qty * 101325;
  } else if (press_units == "psi") {
    p_dict[s_dict]["press_display_qty"] = press_qty * 14.696;
    console.log("3013 psi to atm ", press_qty, press_qty);
    return press_qty * 14.696;
  }
}

function convert_calc_temp_to_display_temp(s_dict) {
  temp_qty = p_dict[s_dict]["temp_calc_qty"];
  temp_units = p_dict[s_dict]["temp_display_units"];
  if (temp_units == "C") {
    p_dict[s_dict]["temp_display_qty"] = temp_qty - 273.15;
    console.log("2995 K to C ", press_qty, p_dict[s_dict]["press_display_qty"]);
    return press_qty;
  } else if (temp_units == "F") {
    p_dict[s_dict]["temp_display_qty"] = K_to_F(temp_qty);
    console.log("3004 K to F ", temp_qty);
    return press_qty / 760;
  } else if (temp_units == "K") {
    p_dict[s_dict]["temp_display_qty"] = temp_qty;
    console.log("3007 K to K ", temp_qty);
    return press_qty / 101.325;
  }
}

// function volume_to_temperature(s_id, s_dict) {
//   console.log("2657 Entered volume_to_temperature");
//   console.log("2657 Exiting volume_to_temperature");
// }

// function volume_to_pressure(s_id, s_dict) {
//   console.log("2657 Entered volume_to_pressure");
//   console.log("2657 Exiting volume_to_pressure");
// }

// function pressure_to_temperature(s_id, s_dict) {
//   console.log("3000 Entered pressure_to_temperature");
//   console.log("3001 Exiting pressure_to_temperature");
// }

// function temperature_to_pressure(s_id, s_dict) {
//   console.log("3005 Entered temperature_to_pressure");
//   console.log("3006 Exiting temperature_to_pressure");
// }

function change_Process_Yield(e, process_yield) {
  // Get and change process yield and store in gen_dict
  console.log("1635 Entered change_Process_Yield");
  console.log("1636 process_yield is ", process_yield);
  process_yield = document.getElementById(e.target.id).value;
  console.log("1486 change_Process_Yield", process_yield);
  gen_dict["process_yield"] = process_yield;
  console.log(
    "1488 gen_dict['process_yield']",
    gen_dict["process_yield"],
    process_yield
  );
}

function Continue() {
  console.log("2648 Continue button was clicked");
  console.log("2649 current_item_info is ", current_item_info);
  //   current_item_info[0] = current_item_info[4]["id"];
  //   current_item_info[1] = current_item_info[4]["type"];
  //   current_item_info[2] = current_item_info[4]["name"];
  //   current_item_info[3] = current_item_info[4]["formula"];

  //   let s_type = current_item_info[1];
  //   let s_id = current_item_info[0];
  //   let s_id_formula = current_item_info[3];
  //   let substance_formula = current_item_info[3];
  console.log("2654 current_item_info is ", current_item_info);
  major_process = gen_dict["major_process"];
  minor_process = gen_dict["minor_process"];
  console.log("2660 major_process is ", gen_dict["major_process"]);
  console.log("2661 minor_process is ", gen_dict["minor_process"]);
  if (payment_plan >= 5 && minor_process == "calc specific heat") {
    openGuidanceModal(
      "Major and minor processes are only available in basic and above subscription level." +
        "To calculate specific heat, select a substance, set the main units to 'grams'," +
        " the heat units to 'J/g °C', and 'other units' to c'. Enter quantities and press the Continue button."
    );
    //} else if (payment_plan >= 5) {
    //    E_text += "<brMajor and minor processes are only available in basic and above subscription level.";
    //    set_explanation_text(E_text);
  } else if (payment_plan >= 5) {
    if (major_process != "") {
      console.log("2670 User selected major_process ", major_process);
    } else if (minor_process != "") {
      E_text += "<br>User selected minor process " + minor_process;
      set_explanation_text(E_text);
      console.log("2674 User selected minor_process ", minor_process);
    }
    if (major_process == "Synthesis") {
      E_text += "<br>2677 User selected the major process Synthesis";
      set_explanation_text(E_text);
      Synthesis_Continue();
    } else if (major_process == "Combustion") {
      E_text += "<br>2681 User selected the major process Combustion";
      set_explanation_text(E_text);
      Combustion();
    } else if (major_process == "Balance Equation") {
      E_text += "<br>2685 User selected the major process Balance Equation";
      set_explanation_text(E_text);
      Balance_Equation();
    } else if (major_process != []) {
      E_text += "<br>2689 User selected other major process ";
      set_explanation_text(E_text);
    } else if (minor_process != "") {
      (E_text += "<br>2592 User selected minor process "), minor_process;
      set_explanation_text(E_text);
    }
    // if (Balance_Equation()) {
    //   Balance_Equation();
    // }
    if (minor_process === "molarity or liters to moles") {
      console.log("2689 molarity or liters to moles ");
      molarity_liters_to_moles(s_id, s_dict);
    } else if (minor_process === "molarity or moles to liters") {
      console.log("2692 molarity or moles to liters ");
      openGuidanceModal(
        "molarity or moles to liters currently only works in the substance 1 container."
      );
      molarity_moles_to_liters(s_id, s_dict);
    } else if (minor_process === "molality or kilograms to moles") {
      console.log("2698 molality or kilograms to moles ");
      molality_kilograms_to_moles(s_id, s_dict);
    } else if (minor_process === "molality or moles to kilograms") {
      console.log("2701 molality or moles to kilograms ");
      molality_moles_to_kilograms(s_id, s_dict);
    } else if (minor_process === "temperature to pressure") {
      console.log("3064 temperature to pressure was activated.");
      temperature_to_pressure();
    } else if (minor_process === "calc specific heat") {
      console.log("2707 calc specific heat change");
      calc_specific_heat();
    } else if (minor_process === "calc heat/work/energy") {
      console.log("2710 calc heat/work/energy");
      calc_heat_work_energy();
    } else if (minor_process === "calc formula mass") {
      //calc_formula_mass
      E_text += "<br>2714 User selected minor process " + minor_process;
      set_explanation_text(E_text);
      calc_formula_mass(); // "molality or moles to kilograms",
    } else if (minor_process === "Parse_Product") {
      E_text += "<br>2718 User selected major process " + minor_process;
      set_explanation_text(E_text);
      Parse_Compound();
    } else if (minor_process === "Parse Compound to Ions") {
      console.log("2722 User selected Parse Compound to Ions ");
      E_text += "<br>2723 User selected minor process " + minor_process;
      set_explanation_text(E_text);
      //parsed_compound_list = [];
      Parse_Compound_to_Ions();
    } else if (minor_process === "Parse Compound to Ions and Diatomic") {
      E_text += "<br>2728 User selected minor process " + minor_process;
      set_explanation_text(E_text);
      Parse_Compound(); //Parse_Compound_to_Ions_and_Diatomic();
    } else if (minor_process === "Parse Compound to Elements") {
      console.log("2742 User selected Parse Compound to Elements ");
      E_text += "<br>2742 User selected minor process " + minor_process;
      set_explanation_text(E_text);
      //parsed_compound_list = [];
      Parse_Compound_to_Elements();
    } else if (minor_process == "Parse Compound to Elements and Diatomic") {
      E_text += "<br>User selected minor process " + minor_process;
      set_explanation_text(E_text);
      Parse_Compound(); //Parse_Compound_to_Elements_and_Diatomic();
    }
  }
}

function molarity_liters_to_moles(s_id, s_dict) {
  console.log("1729 Entered molarity_liters_to_moles");
  console.log(
    "1730 s_dict is ",
    p_dict[s_dict]["moles_molarity"],
    p_dict[s_dict]["kl_units"],
    p_dict[s_dict]["mm_units"]
  );
  if (
    p_dict[s_dict]["moles_molarity"] == "moles" &&
    p_dict[s_dict]["kl_units"] == "liters(l)" &&
    p_dict[s_dict]["mm_units"] == "molarity"
  ) {
    console.log("1732 molarity_liters_to_moles units verified");
    let mol_qty = p_dict[s_dict]["kl_qty"] * p_dict[s_dict]["mm_qty"]; //p_dict['s_1_dict']['kl_qty'] * p_dict['s_1_dict']['molarity_qty'];
    console.log("1733 new mol_qty is", mol_qty);
    p_dict[s_dict]["M_qty"] = mol_qty; //
    console.log("1736 new p_dict[s_dict]['M_qty'] is", p_dict[s_dict]["M_qty"]);
    refresh_display(s_dict);
  }
}

function molarity_moles_to_liters(s_id, s_dict) {
  console.log("1742 Entered molarity_moles_to_liters", current_item_info);
  console.log(
    "1743 s_dict is ",
    p_dict[s_dict]["moles_molarity"],
    p_dict[s_dict]["kl_units"],
    p_dict[s_dict]["mm_units"]
  );
  //p_dict[s_dict]['mm_qty'] = s_1_mm_qty.value;
  //console.log("1745 s_1_dict is ", s_1_mm_qty.value); //s_1_mm_qty.value);p_dict[s_dict]['mm_qty'],
  console.log(
    "1756 p_dict[s_dict]['moles_molarity'] etc is ",
    p_dict[s_dict]["moles_molarity"],
    p_dict[s_dict]["kl_units"],
    p_dict[s_dict]["mm_units"]
  );
  //console.log("1263 p_dict[s_dict]['moles_molarity'] etc is ", p_dict[s_dict]['kl_units']);
  //console.log("1264 p_dict[s_dict]['moles_molarity'] etc is ", p_dict[s_dict]['mm_units']);
  if (
    p_dict[s_dict]["moles_molarity"] == "moles" &&
    p_dict[s_dict]["kl_units"] == "liters(l)" &&
    p_dict[s_dict]["mm_units"] == "molarity"
  ) {
    //
    console.log(
      "1750 molarity_liters_to_moles units verified",
      p_dict[s_dict]["M_qty"],
      s_1_mm_qty.value,
      p_dict[s_dict]["mm_qty"]
    ); // &&  p_dict['s_1_dict']['kl_units'] == 'liters(l)'
    let liter_qty = p_dict[s_dict]["M_qty"] / p_dict[s_dict]["mm_qty"]; //s_1_mm_qty.value;
    console.log("1752 new liter_qty is", liter_qty);
    p_dict[s_dict]["kl_qty"] = liter_qty;
    console.log(
      "1754 new p_dict[s_dict]['kl_qty'] is",
      p_dict[s_dict]["kl_qty"],
      s_1_mm_qty.value
    );
    refresh_display(s_dict);
  }
}

function molality_kilograms_to_moles(s_id, s_dict) {
  console.log("1760 Entered molality_kilograms_to_moles");
  console.log(
    "1761 ",
    p_dict[s_dict]["moles_molarity"],
    p_dict[s_dict]["kl_units"],
    p_dict[s_dict]["mm_units"]
  );
  if (
    p_dict[s_dict]["moles_molarity"] == "moles" &&
    p_dict[s_dict]["kl_units"] == "kilograms"
  ) {
    //  && p_dict[s_dict]['mm_units'] == 'molality'
    //if (p_dict['s_1_dict']['moles_molality'] == 'moles' && p_dict['s_1_dict']['kl_units'] == 'kilograms' && p_dict['s_1_dict']['mm_units'] == 'molality') {
    console.log("1764 molality_kilograms_to_moles units verified");
    let mol_qty = p_dict[s_dict]["mm_qty"] * p_dict[s_dict]["kl_qty"]; //p_dict['s_1_dict']['kl_qty'] * p_dict['s_1_dict']['molarity_qty'];
    console.log("1766 new mol_qty is", mol_qty);
    p_dict[s_dict]["M_qty"] = mol_qty;
    console.log("1768 new p_dict[s_dict]['M_qty'] is", p_dict[s_dict]["M_qty"]);
    refresh_display(s_dict);
  }
}

function molality_moles_to_kilograms(s_id, s_dict) {
  console.log("1774 Entered molality_moles_to_kilograms");
  console.log(
    "1775 ",
    p_dict[s_dict]["moles_molarity"],
    p_dict[s_dict]["kl_units"],
    p_dict[s_dict]["mm_units"]
  );
  if (
    p_dict[s_dict]["moles_molarity"] == "moles" &&
    p_dict[s_dict]["kl_units"] == "kilograms"
  ) {
    //  && p_dict[s_dict]['mm_units'] == 'molality'
    console.log("1777 molality_moles_to_kilograms units verified");
    let kilograms_qty = p_dict[s_dict]["M_qty"] / p_dict[s_dict]["mm_qty"];
    console.log("1779 new kilograms_qty is", kilograms_qty);
    p_dict[s_dict]["kl_qty"] = kilograms_qty;
    //p_dict[s_dict]['M_qty'] = mol_qty;
    console.log(
      "1782 new p_dict[s_dict]['kl_qty'] is",
      p_dict[s_dict]["kl_qty"]
    );
    refresh_display(s_dict);
  }
}

function calc_specific_heat() {
  console.log("1788 Entering calc_specific_heat");
  openGuidanceModal(
    "To calculate specific heat, the main units are set to 'grams'," +
      " the heat units to 'J/g °C', and 'other units' to 'c'. Enter mass, heat and ," +
      " temperature difference quantities and press the Continue button."
  );
  let info = current_item_info;
  console.log("1793 current info is ", info, info[0], info[1]);
  //if (info[0] === 's_1_type') {
  s_dict = current_item_info[0];
  console.log("1642 info is ", info);
  /* The following units are set when the minor process is first selected.
    p_dict[s_dict]['units'] = 'grams'
    p_dict[s_dict]['other_units'] = 'c'
    p_dict[s_dict]['heat_units'] = 'J/g °C'
    s_1_heat_units.value = 'J/g °C'
    */
  let mass = p_dict[s_dict]["mass"]; //s_1_qty.value;
  //p_dict[s_dict]['mass'] = mass;
  let q_value = p_dict[s_dict]["mass"]; //s_1_heat_qty.value;
  let delta_temp = p_dict[s_dict]["temp_display_qty"]; //s_1_temp_qty.value;
  console.log("1653 delta_temp and q_value are ", delta_temp, q_value);
  p_dict[s_dict]["heat"] = q_value; // specific_gravity
  let specific_gravity = q_value / (mass * delta_temp);
  p_dict[s_dict]["specific_gravity"] = specific_gravity;
  other_qty_1.value = specific_gravity;
  console.log("1658 Exiting calc_specific_heat");
}

function calc_heat_work_energy() {
  console.log("1662 Entering calc_heat_work_energy");
  openGuidanceModal(
    "To calculate heat_work_energy, select a substance, set the main units to 'grams'," +
      " the heat units to 'J/g °C', and 'Other units' to 'c''. Enter mass, spcific heat and temperature difference," +
      " quantities and press the Continue button."
  );
  let info = current_item_info;
  console.log("1667 current info is ", info, info[0], info[1]);
  //if (info[0] === 's_1_type') {
  s_dict = "s_1_dict";

  console.log("1671 current info is ", info[0], info[1]);
  if (info[0] === "s_1_type") {
    console.log("1673 info[0] is ", info[0]);
    let mass = s_1_qty.value;
    p_dict[s_dict]["mass"] = mass;
    let specific_gravity = other_qty_1.value;
    let delta_temp = s_1_temp_qty.value;
    console.log(
      "1678 delta_temp and specific_gravity are ",
      delta_temp,
      specific_gravity
    );
    let q_value = specific_gravity * mass * delta_temp;
    p_dict[s_dict]["heat"] = q_value;
    s_1_heat_qty.value = p_dict[s_dict]["heat"];
    //let other_units_label = document.getElementById('other_units_1_lbl')
    //other_units_label.innerHTML = 'Specific heat'
    //other_qty_1_lbl.innerHTML = 'Specific heat qty'
    //let other_units_label = document.getElementById('other_units_1_lbl')
    //reserved_units_label = 'Specific heat units'
    //reserved_units_1_lbl.innerHTML = reserved_units_label
    //console.log("1688 other_units_label is ", other_units_label);
  }
  console.log("1661 Exiting calc_heat_work_energy");
}

function Clear_Explanations() {
  console.log("1694 Clear_Explanations");
  E_text = ""; // E_text + "<br> User selected Show_Instructions function -- not yet functional.";
  set_explanation_text(E_text);
  set_bottom_explanation_text(E_text);
}
function Balance_Equation() {
  console.log("2932 Entering Balance_Equation function");
  E_text += "<br>2933 User selected Balance Equation function.";
  set_explanation_text(E_text);
  var dictList = [
    "s_1_dict",
    "s_2_dict",
    "s_3_dict",
    "s_4_dict",
    "s_5_dict",
    "s_6_dict",
  ];
  var reactantList = [];
  var reactantListCopy = [];
  var productList = [];
  var productListCopy = [];
  var compoundToParse = "";
  var type = p_dict["s_1_dict"]["type"];
  console.log("2936 Substance 1 is " + type);
  //   for (i = 0; i < dictList.length; i++) {
  //     // console.log("2971 dictionary  is " + dictList[i]);
  //     console.log(
  //       "2972 parsed list is " + p_dict[dictList[i]]["parsed_compound_list"]
  //     );
  //   }
  console.log(
    "2977 parsed list is " + p_dict[dictList[0]]["parsed_compound_list"]
  );
  console.log(
    "2980 parsed list is " + p_dict[dictList[1]]["parsed_compound_list"]
  );
  console.log(
    "2983 parsed list is " + p_dict[dictList[2]]["parsed_compound_list"]
  );
  if (
    p_dict["s_1_dict"]["type"] === "element" ||
    p_dict["s_1_dict"]["type"] === "diatomic"
  ) {
    reactantList.push(p_dict["s_1_dict"]["formula"]);
    reactantListCopy.push(p_dict["s_1_dict"]["formula"]);
    console.log(
      "2951 reactantLists are " + reactantList + " " + reactantListCopy
    );
  } else if (p_dict["s_1_dict"]["type"] == "compound") {
    current_item_info[0] = p_dict["s_1_dict"]["type"];
    current_item_info[1] = p_dict["s_1_dict"]["id"];
    current_item_info[2] = p_dict["s_1_dict"]["formula"];
    current_item_info[3] = p_dict["s_1_dict"]["formula"];
    console.log("2959 ", current_item_info[3]); //, compoundToParse);
    reactantListCopy.push(current_item_info[3]);
    console.log("2961 ", reactantListCopy);
    reactantListCopy.push(parsed_compound_list);
    //compoundToParse = Parse_Compound_to_Elements(); // compoundToParse =
    console.log("2963 ", reactantListCopy, parsed_compound_list);
    // console.log(
    //   "2961 compoundToParse " + compoundToParseParse_Compound_to_Elements()
    // );
    //console.log("2962 compoundToParse " + Parse_Compound_to_Elements());
    //reactantList.push(compoundToParse);
    //reactantListCopy.push(compoundToParse);
    //, );current_item_info[3]
    //reactantListCopy
    // "  rl is " +
    // reactantList +
    // " pcl is " +
    // parsed_compound_list
  }

  type = p_dict["s_2_dict"]["type"];
  console.log("2973 Substance 2 is " + type);
  if (
    p_dict["s_2_dict"]["type"] === "element" ||
    p_dict["s_2_dict"]["type"] === "diatomic"
  ) {
    reactantList.push(p_dict["s_2_dict"]["formula"]);
    reactantListCopy.push(p_dict["s_2_dict"]["formula"]);
    // console.log(
    //   "2981 reactantLists are " + reactantList + " " + reactantListCopy
    //);
  } else if (p_dict["s_2_dict"]["type"] === "compound") {
    console.log("2985 substance 2 is a compound.");
    console.log("2986 substance 2 is ", p_dict["s_2_dict"]["formula"]);
    //current_item_info[2] = p_dict["s_2_dict"]["formula"];
    current_item_info[3] = p_dict["s_2_dict"]["formula"];
    console.log(current_item_info[3] + p_dict["s_2_dict"]["formula"]);
    // console.log(
    //   "2988 ",
    //   p_dict["s_2_dict"]["formula"],
    //   p_dict["s_2_dict"]["formula"]
    // );
    compoundToParse = Parse_Compound_to_Elements();
    console.log("2990 compoundToParse " + Parse_Compound_to_Elements());
    reactantList.push(compoundToParse);
    reactantListCopy.push("AlCl3 to be parsed");
    //reactantListCopy.push(parsed_compound_list);
    console.log(
      "2992 reactantLists are " + reactantListCopy
      //" " +
      //reactantListCopy +
      //" " +
      //parsed_compound_list
    );
  }
  type = p_dict["s_3_dict"]["type"];
  console.log("3000 Substance 3 is " + type);
  if (
    p_dict["s_3_dict"]["type"] == "element" ||
    p_dict["s_3_dict"]["type"] == "diatomic"
  ) {
    reactantList.push(p_dict["s_3_dict"]["formula"]);
    reactantListCopy.push(p_dict["s_3_dict"]["formula"]);
    console.log(
      "3008 reactantLists are " + reactantList + " " + reactantListCopy
    );
  } else if (p_dict["s_3_dict"]["type"] === "compound") {
    current_item_info[2] = p_dict["s_3_dict"]["formula"];
    current_item_info[3] = p_dict["s_3_dict"]["formula"];
    console.log("3013 ", current_item_info[2], current_item_info[3]);
    compoundToParse = Parse_Compound_to_Elements();
    reactantList.push(compoundToParse);
    reactantListCopy.push(list(compoundToParse));
    //reactantListCopy.push(parsed_compound_list);

    //" " +
    //reactantListCopy +
    //" " +
    //parsed_compound_list
  }
  console.log("3024 reactantListCopy is " + reactantListCopy);
}

function Equation_Is_Balanced() {
  console.log("1706 Equation_Is_Balanced");
  EquationIsBalanced = "True";
  be_list = [0];
  E_text += "<br> EquationIsBalanced = True";
  set_explanation_text(E_text);
  //console.log("1711 EquationIsBalanced = True");
  if (p_dict["s_1_dict"]["qty"] != "") {
    be_list.push(p_dict["s_1_dict"]["M_qty"]);
  } else be_list.push("0");
  if (p_dict["s_2_dict"]["qty"] != "") {
    be_list.push(p_dict["s_2_dict"]["M_qty"]);
  } else be_list.push("0");
  if (p_dict["s_3_dict"]["qty"] != "") {
    be_list.push(p_dict["s_3_dict"]["M_qty"]);
  } else be_list.push("0");
  if (p_dict["s_4_dict"]["qty"] != "") {
    be_list.push(p_dict["s_4_dict"]["M_qty"]);
  } else be_list.push("0");
  if (p_dict["s_5_dict"]["qty"] != "") {
    be_list.push(p_dict["s_5_dict"]["M_qty"]);
  } else be_list.push("0");
  if (p_dict["s_6_dict"]["qty"] != "") {
    be_list.push(p_dict["s_6_dict"]["M_qty"]);
  } else be_list.push("0");
  be_list.push("0");
  E_text += "<br> " + be_list;
  set_explanation_text(E_text);
  //console.log("1035 be_list is ", be_list);
}

// function select_major_process(e) {
//   console.log("2970 select_major_process entered", e);
//   if (payment_plan > 5) {
//     openGuidanceModal(
//       "Major processes are only available in Standard and above subscription levels. If you selected Balance Equation, also select minor process Parse Compound to Elements. Then input the desired substances and Click on the blue Continue button."
//     );
//     console.log("2975 major process selected.");
//   } else openGuidanceModal("A major process was selected.");
// }

// can be wrapped for making simple and readable
function isNumeric(num) {
  console.log("1752 num is a number ", numeric_list.includes(num));
  if (numeric_list.includes(num)) {
    let d_value = numeric_list[num];
    console.log("1755 num is a number ", d_value);
    return d_value;
  }
  //console.log("993 num returned without change ", numeric_list.includes(num));
  else return num;
}

function isNumber(num_arg) {
  console.log("1763 isNumber(num_arg) ", num_arg);
  if (num_arg >= 0) {
    var num = num_arg;
    //console.log("1093 num_arg is a number", num_arg, num);
    //return num_arg
  } else {
    //console.log("1095 num_arg is a not a number number", num_arg);
  }
}

function isLowerCase(str) {
  console.log("1774 isLowerCase(str) ");
  return str.toUpperCase() != str;
}

function calc_q() {
  console.log("1686 Entered function Parse_Compound.");
}

function keyPressed(e) {
  if (e.key === "Escape") {
    console.log("Escape key pressed");
  }
}

function Parse_Compound() {
  console.log("1784 Entered function Parse_Compound.");
  let compound = current_item_info[3];
  console.log(
    "1786 Compound is",
    current_item_info[0],
    current_item_info[1],
    current_item_info[2],
    current_item_info[3]
  );
  let compound_length = compound.length;
  parsed_compound_list = [];
  E_text +=
    "<br>1789 Entered function Parse_Compound" +
    compound +
    " " +
    compound_length;
  set_explanation_text(E_text);

  if (compound.includes("(")) {
    parsed_compound_list = Parse_Compound_with_Parens(compound);
  } else if (minor_process == "Parse Compound to Ions") {
    parsed_compound_list = Parse_Compound_without_Parens(compound); //
  } else if (minor_process == "Parse Compound to Elements") {
    parsed_compound_list = Parse_Compound_to_Elements(); // Parse_Compound_without_Parens
  }
}

function Parse_Compound_to_Ions() {
  //debugger;
  console.log("2962 Entering Parse_Compound_to_Ions.");
  E_text += "<br>In function Parse_Compound_to_Ions";
  set_explanation_text(E_text);
  ions_list = [];
  //current_item_info[2] = s_num_dict["formula"];
  compound = current_item_info[3];
  console.log("2967 current_item_info ", current_item_info);
  //let compound_length = compound.length;
  //console.log("1973 current_item_info[0]", current_item_info[0], current_item_info[1], current_item_info[2], current_item_info[3]);
  //console.log("1974 compound, current_item_info[3]", compound, current_item_info[3]);
  //console.log("1975 compound slice", compound, compound.slice(2, 5), compound.slice(1, 4));
  if (compound.includes("(")) {
    Parse_Compound_with_Parens(compound); // parsed_compound_list =
    /* ion_list_woCharge is a list of ions without their charges, it is used to identify and parse ions will need a dictionary to go between the above list and the actual ion_list with charges to do calculations.
     */
  } else if (compound.length > 3) {
    console.log("1982 compound.length > 3");
    console.log("1983 ion_list_woCharge", ion_list_woCharge);
    // ** Parse 0 to 3
    if (ion_list_woCharge.includes(compound.slice(0, 3))) {
      console.log(
        "1822 ion_list_woCharge.includes",
        ion_list_woCharge.includes(compound.slice(0, 3))
      );
      //console.log("1773 element_to_diatomic_list.includes(compound.slice(0, 3)) ", ion_list_woCharge.includes(compound.slice(2, 5))); // && compound[2] != isNaN(compound[2])
      console.log("1824 compound.slice(0, 3) is ", compound.slice(0, 3));
      let d_value = compound.slice(0, 3);
      console.log("1826 compound.slice(0, 3) is ", d_value);
      ions_list.push(1);
      ions_list.push(d_value);
      ions_list.push(1);
      ions_list.push(compound.slice(3, compound.length));
      E_text += "<br>ions_list is " + ions_list;
      set_explanation_text(E_text);
      compound = ""; //compound.slice(3, compound.length);
      // ** Parse 1 to 4
    } else if (ion_list_woCharge.includes(compound.slice(1, 4))) {
      console.log("1836 ion_list_woCharge.includes");
      console.log(
        "1837 element_to_diatomic_list.includes(compound.slice(2, 5)) ",
        ion_list_woCharge.includes(compound.slice(2, 5))
      ); // && compound[2] != isNaN(compound[2])
      //console.log("1345 compound.slice(0, 3) is ", compound.slice(0, 3));
      let d_value = compound.slice(1, compound.length);
      console.log("1840 d_value is ", d_value);
      ions_list.push(1);
      ions_list.push(compound.slice(0, 1));
      ions_list.push(1);
      ions_list.push(d_value);
      E_text += "<br> ions_list is " + ions_list;
      set_explanation_text(E_text);
      compound = ""; //compound.slice(3, compound.length);
      // ** Parse 2 to 5
    } else if (ion_list_woCharge.includes(compound.slice(2, 5))) {
      console.log("1850 ion_list_woCharge.includes");
      console.log(
        "1851 element_to_diatomic_list.includes(compound.slice(2, 5)) ",
        ion_list_woCharge.includes(compound.slice(2, 5))
      ); // && compound[2] != isNaN(compound[2])
      //console.log("1345 compound.slice(0, 3) is ", compound.slice(0, 3));
      let d_value = compound.slice(2, compound.length);
      console.log("1854 d_value is ", d_value);
      ions_list.push(1);
      ions_list.push(compound.slice(0, 2));
      ions_list.push(1);
      ions_list.push(d_value);
      E_text += "<br>1859 ions_list is " + ions_list;
      set_explanation_text(E_text);
      compound = ""; //compound.slice(3, compound.length);
    } else {
      console.log("2026 in Parse_Compound_to_Ions else clause.");
      Parse_Compound_without_Parens(compound); // parsed_compound_list =
      E_text += "<br>ions_list is " + ions_list;
      set_explanation_text(E_text);
      //set_Cation_and_Anion(s_num_dict)
    }
  } else if (compound.length <= 3) {
    Parse_Compound_without_Parens(compound);
    //UlU
    // if (ion_list_woCharge.includes(compound.slice(0, 2))) {
    //     //console.log("1872 ion_list_woCharge.includes");
    //     //console.log("1873 element_to_diatomic_list.includes(compound.slice(0, 3)) ", ion_list_woCharge.includes(compound.slice(2, 5))); // && compound[2] != isNaN(compound[2])
    //     //console.log("1874 compound.slice(0, 3) is ", compound.slice(1, 3));
    //     let d_value = compound.slice(0, 2);
    //     console.log("1876 d_value is ", d_value);
    //     parsed_compound_list.push(1);
    //     parsed_compound_list.push(d_value);
    //     parsed_compound_list.push(1);
    //     parsed_compound_list.push(d_value);
    //     E_text += "<br>1881 parsed_compound_list is " + parsed_compound_list;
    //     set_explanation_text(E_text);
    //     compound = "";
    // }
  }
  console.log("3057 about to enter set_Cation_and_Anion");
  console.log("3058 ion_list is ", ions_list);
  set_Cation_and_Anion(current_item_info[0]); // current_item_info[3]
  console.log("3244 Exiting Parse_Compound_to_Ions.");

  /** Update Compound ions here */
  const postData = {
    formula: compound,
    ions: ions_list,
  };
  update_compound(postData);
  console.log("3131 ion_list is ", ions_list);
  console.log("3132 elements_list is ", elements_list);
}

function set_Cation_and_Anion(s_num_dict) {
  console.log("3064 current_item_info", current_item_info);
  console.log("3065 ", s_num_dict, ions_list);
  console.log("3068 =======> ", s_num_dict);
  p_dict[s_num_dict]["cation_qty"] = ions_list[0];
  p_dict[s_num_dict]["cation"] = ions_list[1];
  p_dict[s_num_dict]["anion_qty"] = ions_list[2];
  p_dict[s_num_dict]["anion"] = ions_list[3];
  // p_dict[s_num_dict]["parsed_compound_list"] = parsed_compound_list;

  console.log(
    "3289 Entering set_Cation_and_Anion ",
    s_num_dict,
    ions_list,
    ions_list[0],
    ions_list[1],
    ions_list[2],
    ions_list[3],
    p_dict[s_num_dict]["cation_qty"],
    p_dict[s_num_dict]["cation"],
    p_dict[s_num_dict]["anion_qty"],
    p_dict[s_num_dict]["anion"]
    // p_dict[s_num_dict]["parsed_compound_list"]
  );
  // s_num_dict["parsed_compound_list"] = parsed_compound_list;
  //   console.log(
  //     "3259 ",
  //     p_dict[s_num_dict]["cation_qty"],
  //     p_dict[s_num_dict]["cation"],
  //     p_dict[s_num_dict]["anion_qty"],
  //     p_dict[s_num_dict]["anion"],
  //     p_dict[s_num_dict]["parsed_compound_list"]
  //   );
  // s_1_cc_qty.value = parsed_compound_list[0];
  // s_1_cation.value = parsed_compound_list[1];
  // s_1_ac_qty.value = parsed_compound_list[2];
  // s_1_anion.value = parsed_compound_list[3];
  if (current_item_info[0] == "s_1_dict") {
    console.log("3054 in set_Cation_and_Anion");
    // p_dict[s_num_dict]["cation_qty"] == parsed_compound_list[0] &&
    // p_dict[s_num_dict]["cation"] == parsed_compound_list[1] &&
    // p_dict[s_num_dict]["anion_qty"] == parsed_compound_list[2] &&
    // p_dict[s_num_dict]["anion"] == parsed_compound_list[3]
    //s_id = 's_1_dict';
    s_1_cc_qty.value = ions_list[0];
    s_1_cation.value = ions_list[1];
    s_1_ac_qty.value = ions_list[2];
    s_1_anion.value = ions_list[3];
  } else if (current_item_info[0] == "s_2_dict") {
    s_2_cc_qty.value = ions_list[0];
    s_2_cation.value = ions_list[1];
    s_2_ac_qty.value = ions_list[2];
    s_2_anion.value = ions_list[3];
  } else if (current_item_info[0] == "s_3_dict") {
    s_3_cc_qty.value = ions_list[0];
    s_3_cation.value = ions_list[1];
    s_3_ac_qty.value = ions_list[2];
    s_3_anion.value = ions_list[3];
  } else if (current_item_info[0] == "s_4_dict") {
    s_4_cc_qty.value = ions_list[0];
    s_4_cation.value = ions_list[1];
    s_4_ac_qty.value = ions_list[2];
    s_4_anion.value = ions_list[3];
  } else if (current_item_info[0] == "s_5_dict") {
    s_5_cc_qty.value = ions_list[0];
    s_5_cation.value = ions_list[1];
    s_5_ac_qty.value = ions_list[2];
    s_5_anion.value = ions_list[3];
  } else if (current_item_info[0] == "s_6_dict") {
    s_6_cc_qty.value = ions_list[0];
    s_6_cation.value = ions_list[1];
    s_6_ac_qty.value = ions_list[2];
    s_6_anion.value = ions_list[3];
  }
  console.log("3312 Exiting set_Cation_and_Anion ", s_num_dict);
}

function Parse_Compound_Cation() {
  // pass
}

function Parse_Compound_to_Ions_and_Diatomic() {
  // pass
}

function Parse_Compound_to_Elements() {
  console.log("3325 In function Parse_Compound_to_Elements");
  E_text += "<br>3326 In function Parse_Compound_to_Elements";
  set_explanation_text(E_text);
  console.log("3328 current_item_info", current_item_info);
  let compound = current_item_info[3];
  elements_list = [];
  //let s_num_dict = compound.length;
  let formula_mass = 0;
  console.log(
    "3332 current_item_info",
    current_item_info[0],
    current_item_info[1],
    current_item_info[2],
    current_item_info[3]
  );
  console.log(
    "3337 compound, current_item_info[3]",
    compound,
    current_item_info
  );
  if (compound.includes("(")) {
    //openGuidanceModal('<br>Parse compounds to elements with parenthesis is under development.');
    console.log("3343 In function Parse_Compound_to_Elements -- includes '(' ");
    let start_paren = compound.includes("(");
    let end_paren = compound.includes(")");
    let paren_start_index = compound.indexOf("(");
    let paren_end_index = compound.indexOf(")");
    let subscript = compound.charAt(paren_end_index + 1);
    if (paren_start_index == 0) {
      // Parse the compound within the parenthesis and pass the subscript as a multiplier
      console.log(
        "3218 ",
        subscript,
        compound.slice(paren_start_index + 1, paren_end_index)
      );
      console.log("3222 ", 1, compound.slice(paren_end_index + 2));
      Parse_Compound_to_Elements_Sub(
        subscript,
        compound.slice(paren_start_index + 1, paren_end_index)
      ); // parsed_compound_list[0] =
      Parse_Compound_to_Elements_Sub(1, compound.slice(paren_end_index + 2)); // parsed_compound_list[1] =  split.
      console.log("3712 parsed_compound_list is ", elements_list);
      (E_text += "<br>2229 element_list is "), elements_list;
      set_explanation_text(E_text);
    } else {
      console.log("3232 ", 1, compound.slice(0, paren_start_index));
      console.log(
        "3234 ",
        subscript,
        compound.slice(paren_start_index + 1, paren_end_index)
      );
      Parse_Compound_to_Elements_Sub(1, compound.slice(0, paren_start_index));
      Parse_Compound_to_Elements_Sub(
        subscript,
        compound.slice(paren_start_index + 1, paren_end_index)
      );
      console.log("3243 elements_list is ", elements_list);
      E_text += "<br>3244 elements_list is " + elements_list;
      set_explanation_text(E_text);
    }
  } else {
    console.log(
      "3386 compound without parens -- slice ",
      compound
      //   compound.slice(2, 5),
      //   compound.slice(1, 4)
    );
    Parse_Compound_to_Elements_Sub(1, compound); // subscript parsed_compound_list[2] =
    // ion_list_woCharge is a list of ions without their charges, it is used to identify and parse ions
    // will need a dictionary to go between the above list and the actual ion_list with charges to do calculations.
    // parsed_compound_list = [];
  }

  /** Update Compound elements here */
  const elements = {
    formula: compound,
    elements: elements_list,
  };
  update_compound(elements);
  //set_Cation_and_Anion(s_num_dict);
  //console.log("1983 parsed_compound_list is ", parsed_compound_list)
}

function Parse_Compound_to_Elements_Sub(subscript, compound) {
  console.log("3393 compound is", subscript, compound);
  //parsed_compound_list = [];
  s_num_dict = current_item_info[0];
  console.log("3416 ", current_item_info[0]);
  while (compound.length >= 3) {
    console.log("3398 compound.length >= 3");
    //UL##
    if (
      compound.length >= 3 &&
      compound[0] == compound[0].toUpperCase() &&
      compound[1] != compound[1].toUpperCase() &&
      compound[2] >= 0 &&
      compound[3] >= 0
    ) {
      console.log("3407 compound is UL## ", compound);
      let d_value = compound.slice(0, 2);
      console.log("3409 d_value is ", d_value);
      elements_list.push(subscript * compound.slice(2, 3));
      elements_list.push(d_value);
      compound = compound.slice(3, compound.length);
      console.log(
        "3414 elements_list and compound are ",
        elements_list,
        compound
      );
      // E_text += "<br>3418 UL## parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
      //UL#
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] != compound[1].toUpperCase() &&
      compound[2] >= 0
    ) {
      console.log("3426 compound is UL# ", compound);
      let d_value = compound.slice(0, 2);
      console.log("3428 d_value is ", d_value);
      elements_list.push(subscript * compound[2]);
      elements_list.push(d_value);
      compound = compound.slice(3, compound.length);
      console.log(
        "3433 elements_list and compound are ",
        elements_list,
        compound
      );
      // E_text += "<br>3437 UL# parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
      // U##
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] >= 0 &&
      compound[2] >= 0
    ) {
      console.log("3445 compound is U## ", compound);
      let d_value = compound.slice(0, 1);
      console.log("3447 d_value is ", d_value);
      elements_list.push(subscript * compound.slice(1, 3));
      elements_list.push(d_value);
      compound = compound.slice(3, compound.length);
      console.log(
        "3452 elements_list and compound are ",
        elements_list,
        compound
      );
      // E_text += "<br>3456 U## parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
      // U#U
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] >= 0 &&
      compound[2].toUpperCase()
    ) {
      console.log("3464 compound is U#U ", compound);
      let d_value = compound.slice(0, 1);
      console.log("3466 d_value is ", d_value);
      elements_list.push(subscript * compound[1]);
      elements_list.push(d_value);
      compound = compound.slice(2, compound.length);
      console.log(
        "3471 elements_list and compound are ",
        elements_list,
        compound
      );
      // E_text += "<br>3475 U#U parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
      // ULU
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] != compound[1].toUpperCase() &&
      compound[2] == compound[2].toUpperCase()
    ) {
      // ULU+
      console.log("3484 compound is ULU ", compound);
      let d_value = compound.slice(0, 2);
      console.log("3486 d_value is ", d_value);
      elements_list.push(subscript * 1);
      elements_list.push(d_value);
      compound = compound.slice(2, compound.length);
      console.log(
        "3491 elements_list and compound are ",
        elements_list,
        compound
      );
      // E_text += "<br>3495 ULU+ parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
      // UU
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] == compound[1].toUpperCase()
    ) {
      console.log("3502 compound is UU ", compound);
      let d_value = compound.slice(0, 1);
      console.log("3504 d_value is ", d_value);
      elements_list.push(subscript * 1);
      elements_list.push(d_value);
      compound = compound.slice(1, compound.length);
      console.log(
        "3509 elements_list and compound are ",
        elements_list,
        compound
      );
      // E_text += "<br>3513 UU parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
    }
  }
  if (compound.length >= 2) {
    console.log("3518 compound.length >= 2");
    //UL
    if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] != compound[1].toUpperCase()
    ) {
      // && compound[2] >= 0
      console.log("3525 compound is UL ", compound);
      let d_value = compound.slice(0, 2);
      console.log("3527 d_value is ", d_value);
      elements_list.push(subscript * 1);
      elements_list.push(d_value);
      compound = ""; //compound.slice(2, compound.length);
      console.log(
        "3532 elements_list and compound are ",
        elements_list,
        compound
      );
      // E_text += "<br>3534 UL parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
      // U#
    } else if (compound[0] == compound[0].toUpperCase() && compound[1] >= 0) {
      //  && compound[2].toUpperCase()
      console.log("3541 compound is U# ", compound);
      let d_value = compound.slice(0, 1);
      console.log("3543 d_value is ", d_value);
      elements_list.push(subscript * compound[1]);
      elements_list.push(d_value);
      compound = ""; //compound.slice(1, compound.length);
      console.log(
        "3548 U# pelements_list and compound are ",
        elements_list,
        compound
      );
      // E_text += "<br>3552 U# parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
      //UU
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] == compound[1].toUpperCase()
    ) {
      console.log("3559 compound is UU ", compound);
      let d_value = compound.slice(0, 1);
      console.log("3561 d_value is ", d_value);
      elements_list.push(subscript * 1);
      elements_list.push(d_value);
      elements_list.push(subscript * 1);
      elements_list.push(compound[1]);
      compound = ""; //compound.slice(1, compound.length);
      console.log("3567 elements_list is ", elements_list); //, parsed_compound_list1)
      // E_text += "<br>3568 UU parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
    }
  }
  if (compound.length == 1) {
    console.log("3573 compound.length == 1");
    //U
    if (compound[0] == compound[0].toUpperCase()) {
      console.log("3576 compound is U ", compound);
      let d_value = compound[0];
      console.log("3578 d_value is ", d_value);
      elements_list.push(subscript * 1);
      elements_list.push(d_value);
    } else {
      console.log("3582 compound is ", compound);
      // E_text += "<br>3583 U parsed_compound_list is " + parsed_compound_list;
      // set_explanation_text(E_text);
    }
    console.log(
      "3587 elements_list and compound are ",
      elements_list,
      compound
    );
    // E_text += "<br>3591 UU parsed_compound_list is " + parsed_compound_list;
    // set_explanation_text(E_text);
  } else if (compound != "") {
    console.log("3594 compound is ", compound);
    console.log("3595 compound is not UL#. U#U, ULU or UU ");
  }
  s_num_dict = current_item_info[0]; // "s_1_dict"; //
  console.log("3602 s_num_dict is ", s_num_dict, current_item_info[0]);
  p_dict[s_num_dict]["elements_list"] = elements_list;
  E_text += "<br>3423 elements_list is " + elements_list;
  set_explanation_text(E_text);
  console.log("3604  ", s_num_dict, p_dict[s_num_dict]["elements_list"]);
  set_Cation_and_Anion(s_num_dict);
  // console.log("3573 parsed_compound_list is ", parsed_compound_list);
  return elements_list;
}

function Parse_Compound_to_Elements_and_Diatomic(compound) {
  console.log("3464 compound is ", compound);
}

// function Parse_Compound_without_Parens(compound) {
//   console.log(
//     "3608 in Parse_Compound_Complete w/o parens ",
//     compound,
//     compound.length
//   );
//   E_text +=
//     "<br>3613 Started function Parse_Compound_Complete w/o parens " +
//     compound +
//     " " +
//     compound.length;
//   set_explanation_text(E_text);
//   if (compound.length > 3) {
//     //console.log("1324 Compound and length are ", compound, compound.length);
//     // Test: Check for diatomic elements and their single element equivalents that can start a compound
//     if (compound.slice(0, 3) == "NH4") {
//       // Compound is ammonium, parse it as ammonium -- no parenthesis so coefficient is 1.
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound.slice(0, 3));
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound.slice(3, compound.length));
//       compound = compound.slice(3, compound.length);
//       // UL#U+
//     } else if (
//       compound[0] == compound[0].toUpperCase() &&
//       compound[1] != compound[1].toUpperCase() &&
//       compound[2] >= 0
//     ) {
//       // UL# (typeof compound[2] === 'number')  && compound[2] != compound[2].toUpperCase()
//       //console.log("1335 compound is ", compound, compound[0], compound[1], compound[2]) // isNumber(num_arg)
//       if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
//         //console.log("1337 element_to_diatomic_list.includes(compound.slice(0, 2)) ", element_to_diatomic_list.includes(compound.slice(0, 2))); // && compound[2] != isNaN(compound[2])
//         let d_value = element_to_diatomic_dict[compound.slice(0, 2)];
//         //console.log("1339 d_value is ", d_value);
//         parsed_compound_list.push(compound[2] / 2);
//         parsed_compound_list.push(d_value);
//         compound = compound.slice(3, compound.length);
//       } else {
//         parsed_compound_list.push(compound[2]);
//         parsed_compound_list.push(compound.slice(0, 2));
//         compound = compound.slice(3, compound.length);
//       }
//       // Parse: ULU+
//     } else if (
//       compound[0] == compound[0].toUpperCase() &&
//       compound[1] != compound[1].toUpperCase() &&
//       element_alpha_list.includes(compound[2])
//     ) {
//       // ULU+
//       console.log(
//         "3519 compound is ",
//         compound,
//         compound[0],
//         compound[1],
//         compound[2]
//       ); // isNumber(num_arg)
//       if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
//         console.log(
//           "3527 element_to_diatomic_list.includes(compound.slice(0, 2) ",
//           element_to_diatomic_list.includes(compound.slice(0, 2))
//         ); // && compound[2] != isNaN(compound[2])
//         let d_value = element_to_diatomic_dict[compound.slice(0, 2)];
//         //console.log("1354 d_value is ", d_value);
//         parsed_compound_list.push(0.5);
//         parsed_compound_list.push(d_value);
//         compound = compound.slice(2, compound.length);
//       } else {
//         parsed_compound_list.push(1);
//         parsed_compound_list.push(compound.slice(0, 2));
//         compound = compound.slice(2, compound.length);
//       }
//       // Parse: U#U+
//     } else if (
//       compound[0] == compound[0].toUpperCase() &&
//       compound[1] >= 0 &&
//       compound[2] == compound[2].toUpperCase()
//     ) {
//       // U#U
//       console.log("3547 compound is ", compound);
//       if (element_to_diatomic_list.includes(compound[0])) {
//         console.log(
//           "3550 element_to_diatomic_list.includes(compound[0] ",
//           element_to_diatomic_list.includes(compound[0])
//         );
//         let d_value = element_to_diatomic_dict[compound[0]];
//         parsed_compound_list.push(compound[1] / 2);
//         parsed_compound_list.push(d_value);
//         compound = compound.slice(2, compound.length);
//       } else {
//         parsed_compound_list.push(compound[1]);
//         parsed_compound_list.push(compound[0]);
//         compound = compound.slice(2, compound.length);
//       }
//       // Parse: UU+
//     } else if (
//       compound[0] == compound[0].toUpperCase() &&
//       element_alpha_list.includes(compound[1])
//     ) {
//       // UU
//       console.log("3568 compound is ", compound);
//       if (element_to_diatomic_list.includes(compound[0])) {
//         //console.log("1096 element_to_diatomic_list.includes(compound[0] ", element_to_diatomic_list.includes(compound.slice(0, 2)));
//         let d_value = element_to_diatomic_dict[compound[0]];
//         parsed_compound_list.push(0.5);
//         parsed_compound_list.push(d_value);
//         compound = compound = compound.slice(1, compound.length);
//       } else {
//         parsed_compound_list.push(1);
//         parsed_compound_list.push(compound[0]);
//         compound = compound = compound.slice(1, compound.length);
//       }
//       E_text += "<br>3580 parsed_compound_list is: " + parsed_compound_list;
//       set_explanation_text(E_text);
//     }
//     console.log("3583 Compound and length are ", compound); // , compound.length
//   }
//   console.log("3585 Compound and length are ", compound);
//   // UL#
//   if (
//     compound.length == 3 &&
//     compound[0] == compound[0].toUpperCase() &&
//     compound[1] != compound[1].toUpperCase() &&
//     compound[2] >= 0
//   ) {
//     console.log("3593 compound is ", compound);
//     if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
//       //console.log("1401 element_to_diatomic_list.includes(compound[0]) ", element_to_diatomic_list.includes(compound.slice(0, 2)));
//       let d_value = element_to_diatomic_dict[compound.slice(0, 2)];
//       parsed_compound_list.push(compound[2] / 2);
//       parsed_compound_list.push(d_value);
//       compound = "";
//     } else {
//       parsed_compound_list.push(compound[2]);
//       parsed_compound_list.push(compound.slice(0, 2));
//       compound = "";
//     }
//     // UL#
//   } else if (
//     compound.length == 3 &&
//     compound[0] == compound[0].toUpperCase() &&
//     compound[1] != compound[1].toUpperCase() &&
//     compound[2] == compound[2].toUpperCase()
//   ) {
//     // UL#
//     //console.log("1413 compound is ", compound)
//     if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
//       //console.log("1415 element_to_diatomic_list.includes(compound[0]) ", element_to_diatomic_list.includes(compound.slice(0, 2)));
//       let d_value = element_to_diatomic_dict[compound.slice(0, 2)];
//       parsed_compound_list.push(0.5);
//       parsed_compound_list.push(d_value);
//       compound = compound[2];
//     } else {
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound.slice(0, 2));
//       compound = compound[2];
//     }
//     // U#U
//   } else if (
//     compound.length == 3 &&
//     compound[0] == compound[0].toUpperCase() &&
//     compound[1] >= 0 &&
//     compound[2] == compound[2].toUpperCase()
//   ) {
//     //console.log("1427 compound length is ", compound.length);
//     if (element_to_diatomic_list.includes(compound[0])) {
//       //console.log("1197 element_to_diatomic_list.includes(compound.slice(0, 2)) ", element_to_diatomic_list.includes(compound[0]));
//       let d_value = element_to_diatomic_dict[compound[0]];
//       parsed_compound_list.push(compound[1] / 2);
//       parsed_compound_list.push(d_value);
//       compound = compound[2];
//     } else {
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound[0]);
//       compound = compound[2];
//     }
//     // UU#
//   } else if (
//     compound.length == 3 &&
//     compound[0] == compound[0].toUpperCase() &&
//     compound[1] == compound[1].toUpperCase() &&
//     compound[2] >= 0
//   ) {
//     console.log("3651 compound is ", compound, compound.length);
//     if (element_to_diatomic_list.includes(compound[0])) {
//       //console.log("1443 element_to_diatomic_list.includes(compound[0]) ", element_to_diatomic_list.includes(compound[0]));
//       let d_value = element_to_diatomic_dict[compound[0]];
//       parsed_compound_list.push(0.5);
//       parsed_compound_list.push(d_value);
//       compound = compound.slice(1, compound.length);
//     } else {
//       parsed_compound_list.push(1);
//       6;
//       parsed_compound_list.push(compound[0]);
//       compound = compound.slice(1, compound.length);
//     }
//     // UUU
//   } else if (
//     compound.length == 3 &&
//     compound[0] == compound[0].toUpperCase() &&
//     compound[1] == compound[1].toUpperCase() &&
//     compound[2] == compound[2].toUpperCase()
//   ) {
//     // UUU
//     //console.log("1456 compound is ", compound, compound.length)
//     if (element_to_diatomic_list.includes(compound[0])) {
//       //console.log("1458 element_to_diatomic_list.includes(compound[0]) ", element_to_diatomic_list.includes(compound[0]));
//       let d_value = element_to_diatomic_dict[compound[0]];
//       parsed_compound_list.push(0.5);
//       parsed_compound_list.push(d_value);
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound.slice(1, compound.length));
//       compound = "";
//     } else {
//       parsed_compound_list.push(1);
//       6;
//       parsed_compound_list.push(compound[0]);
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound.slice(1, compound.length));
//       compound = "";
//     }
//     // UU
//   } else if (
//     compound.length == 3 &&
//     compound[0] == compound[0].toUpperCase() &&
//     compound[1] == compound[1].toUpperCase()
//   ) {
//     // UU
//     //console.log("1475 compound is ", compound, compound.length)
//     if (element_to_diatomic_list.includes(compound[0])) {
//       //console.log("1477 element_to_diatomic_list.includes(compound[0]) ", element_to_diatomic_list.includes(compound[0]));
//       let d_value = element_to_diatomic_dict[compound[0]];
//       parsed_compound_list.push(0.5);
//       parsed_compound_list.push(d_value);
//       compound = compound.slice(1, compound.length);
//     } else {
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound[0]);
//       compound = compound.slice(1, compound.length);
//     }
//   }
//   // U#
//   if (
//     compound.length == 2 &&
//     compound[0] == compound[0].toUpperCase() &&
//     compound[1] >= 0
//   ) {
//     //console.log("1490 compound length is 2");
//     if (element_to_diatomic_list.includes(compound[0])) {
//       //console.log("1492 element_to_diatomic_list.includes(compound.slice(0, 2)) ", element_to_diatomic_list.includes(compound[0]));
//       let d_value = element_to_diatomic_dict[compound[0]];
//       parsed_compound_list.push(compound[1] / 2);
//       parsed_compound_list.push(d_value);
//       compound = "";
//     } else {
//       parsed_compound_list.push(compound[1]);
//       parsed_compound_list.push(compound[0]);
//       compound = "";
//     }
//     // UU
//   } else if (
//     compound.length == 2 &&
//     compound[0] == compound[0].toUpperCase() &&
//     compound[1] == compound[1].toUpperCase()
//   ) {
//     console.log("3773 compound is ", compound, compound.length);
//     if (element_to_diatomic_list.includes(compound[0])) {
//       //console.log("1506 element_to_diatomic_list.includes(compound[0]) ", element_to_diatomic_list.includes(compound[0]));
//       let d_value = element_to_diatomic_dict[compound[0]];
//       parsed_compound_list.push(compound[1] / 2);
//       parsed_compound_list.push(d_value);
//       compound = compound[1];
//     } else {
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound[0]);
//       compound = compound[1];
//     }
//     // UL
//   } else if (
//     compound.length == 2 &&
//     compound[0] == compound[0].toUpperCase() &&
//     compound[1] != compound[1].toUpperCase()
//   ) {
//     //console.log("1518 compound is ", compound)
//     if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
//       //console.log("1253 element_to_diatomic_list.includes(compound[0]) ", element_to_diatomic_list.includes(compound.slice(0, 2)));
//       let d_value = element_to_diatomic_dict[compound.slice(0, 2)];
//       parsed_compound_list.push(0.5);
//       parsed_compound_list.push(d_value);
//       compound = "";
//     } else {
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound.slice(0, 2));
//       compound = "";
//     }
//   }
//   // U
//   if (compound.length == 1 && compound[0] == compound[0].toUpperCase()) {
//     // U
//     if (element_to_diatomic_list.includes(compound[0])) {
//       //console.log("1157 element_to_diatomic_list.includes(compound[0]) ", element_to_diatomic_list.includes(compound[0]));
//       let d_value = element_to_diatomic_dict[compound[0]];
//       parsed_compound_list.push(0.5);
//       parsed_compound_list.push(d_value);
//       compound = "";
//     } else {
//       parsed_compound_list.push(1);
//       parsed_compound_list.push(compound.slice(0, compound.length));
//       compound = "";
//     }
//   } else {
//     compound = "";
//   }
//   set_Cation_and_Anion(s_num_dict);
//   console.log("3782 Compound is ", compound);
//   return parsed_compound_list;
// }

function Parse_Compound_with_Parens(compound) {
  //debugger;
  console.log("3778 In function Parse_Compound_with_Parens.");
  E_text += "<br>3789 In Parse_Compound_with_Parens";
  set_explanation_text(E_text);
  let compound_length = compound.length;
  // let letter = compound.charAt(1);
  let start_paren = compound.includes("(");
  let end_paren = compound.includes(")");
  let paren_start_index = compound.indexOf("(");
  let paren_end_index = compound.indexOf(")");
  let start_paren_char = compound.charAt(paren_start_index);
  let end_paren_char = compound.charAt(paren_end_index);
  let prior_char = compound.charAt(paren_start_index - 1);
  let next_char = compound.charAt(paren_start_index);
  let subscript = compound.charAt(paren_end_index + 1);
  let cation = compound.slice(0, paren_start_index);
  let anion = compound.slice(paren_start_index + 1, paren_end_index);
  console.log(
    "2517 ",
    start_paren,
    end_paren,
    paren_start_index,
    paren_end_index,
    start_paren_char
  );
  if (paren_start_index == 0) {
    //parsed_compound_list = [];
    let cation = compound.slice(0, paren_start_index);
    let subscript = compound.charAt(paren_end_index + 1);
    let anion = compound.slice(paren_start_index + 1, paren_end_index);
    parsed_compound_list.push(subscript);
    parsed_compound_list.push(cation);
    parsed_compound_list.push(1);
    parsed_compound_list.push(anion);
    console.log("3821 ", cation, subscript, anion);
    //console.log("2086 cation, and subscript are ", subscript, cation, anion)
    E_text +=
      "<br>3824 Inside function Parse_Compound_with_Parens cation coefficient, cation and anion are: " +
      subscript +
      " " +
      cation +
      " " +
      anion;
    set_explanation_text(E_text);
    E_text += "<br>3831 parsed_compound_list is: " + parsed_compound_list;
    set_explanation_text(E_text);
    return parsed_compound_list;
  } else {
    let cation = compound.slice(0, paren_start_index);
    let subscript = compound.charAt(paren_end_index + 1);
    let anion = compound.slice(paren_start_index + 1, paren_end_index);
    parsed_compound_list = [];
    parsed_compound_list.push(1);
    parsed_compound_list.push(cation);
    parsed_compound_list.push(subscript);
    parsed_compound_list.push(anion);
    console.log("3843 ", cation, subscript, anion);
    //console.log("1040 check Parse_Compound_with_Parens ", cation, subscript, anion);
    E_text +=
      "<br>3846 Inside function Parse_Compound_with_Parens cation, anion coefficient and anion are: " +
      cation +
      " " +
      subscript +
      " " +
      anion;
    set_explanation_text(E_text);
    E_text += "<br>3853 ions_list is: " + ions_list;
    set_explanation_text(E_text);
    return ions_list;
  }
}

function Parse_Diatomic(diatomic) {
  //This function will only be needed if/when automatic CME to CIE are implemented
  pass;
}

function Parse_Compound_without_Parens(compound) {
  console.log("3862 In function Parse_Compound_without_Parens.");
  console.log("3825 ", compound);
  E_text += "<br>2552 In Parse_Compound_without_Parens";
  set_explanation_text(E_text);
  let compound_length = compound.length;
  ions_list = [];

  while (compound.length > 3) {
    //console.log("1412 Compound and length are ", compound, compound_length);
    // Test: Check for diatomic elements and their single element equivalents that can start a compound
    if (compound.slice(0, 3) == "NH4") {
      console.log("2561 Compound is ammonia ", compound); // Compound is ammonium, parse it as ammonium -- no parenthesis so coefficient is 1.
      ions_list.push(1);
      ions_list.push(compound.slice(0, 3));
      //parsed_compound_list.push(1);
      //parsed_compound_list.push(compound.slice(3, compound.length));
      E_text += "<br>2566 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      compound = compound.slice(3, compound.length);
      //console.log("1101 Compound and length are ", compound, compound.length);
      // UL#U+
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] != compound[1].toUpperCase() &&
      compound[2] >= 0
    ) {
      // UL# (typeof compound[2] === 'number')  && compound[2] != compound[2].toUpperCase()
      console.log(
        "2572 compound is ",
        compound,
        compound[0],
        compound[1],
        compound[2]
      ); // isNumber(num_arg)
      if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
        console.log(
          "1679 element_to_diatomic_list.includes(compound[0] ",
          element_to_diatomic_list.includes(compound.slice(0, 2))
        ); // && compound[2] != isNaN(compound[2])
        //let d_value = element_to_diatomic_dict[compound.slice(0, 2)];
        let d_value = compound[(0, 2)];
        //console.log("1108 d_value is ", d_value);
        ions_list.push(compound[2]);
        ions_list.push(d_value);
      } else {
        ions_list.push(compound[2]);
        ions_list.push(compound.slice(0, 2));
      }
      //parsed_compound_list.push(1);
      //parsed_compound_list.push(compound.slice(3, compound.length));
      //E_text += "<br>1153 parsed_compound_list is: " + parsed_compound_list;
      //set_explanation_text(E_text);
      compound = compound.slice(3, compound.length);
      //console.log("1134 Compound and length are ", compound, compound.length);
      // Parse: ULU+
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] != compound[1].toUpperCase() &&
      element_alpha_list.includes(compound[2])
    ) {
      // ULU (typeof compound[2] === 'number')  && compound[2] != compound[2].toUpperCase()
      console.log(
        "2592 compound is ",
        compound,
        compound[0],
        compound[1],
        compound[2]
      ); // isNumber(num_arg)
      if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
        console.log(
          "1698 element_to_diatomic_list.includes(compound[0] ",
          element_to_diatomic_list.includes(compound.slice(0, 2))
        ); // && compound[2] != isNaN(compound[2])
        //let d_value = element_to_diatomic_dict[compound.slice(0, 2)];
        let d_value = compound[(0, 2)];
        console.log("1700 d_value is ", d_value);
        ions_list.push(compound[2]);
        ions_list.push(d_value);
      } else {
        ions_list.push(1);
        ions_list.push(compound.slice(0, 2));
      }
      //parsed_compound_list.push(1);
      //parsed_compound_list.push(compound.slice(2, compound.length));
      E_text += "<br>1709 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      compound = compound.slice(2, compound.length);
      console.log("1712 Compound and length are ", compound); // , compound.length
      // Parse: U#U+
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] >= 0 &&
      compound[2] == compound[2].toUpperCase()
    ) {
      // U#U
      console.log("2612 compound is ", compound);
      if (element_to_diatomic_list.includes(compound[0])) {
        //console.log("1104 element_to_diatomic_list.includes(compound[0] ", element_to_diatomic_list.includes(compound[0]));
        let d_value = element_to_diatomic_dict[compound[0]];
        ions_list.push(compound[1] / 2);
        ions_list.push(d_value);
      } else {
        ions_list.push(compound[1]);
        ions_list.push(compound[0]);
      }
      //parsed_compound_list.push(1);
      //parsed_compound_list.push(compound.slice(2, compound.length));
      compound = compound.slice(2, compound.length);
      console.log("2625 Compound and length are ", compound); // , compound.length
      // Parse: UU+
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] == compound[1].toUpperCase()
    ) {
      // UU
      console.log("2628 compound is ", compound);
      if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
        ////console.log("1125 element_to_diatomic_list.includes(compound[0] ", element_to_diatomic_list.includes(compound.slice(0, 2)));
        let d_value = element_to_diatomic_dict[compound[0]];
        ions_list.push(1);
        ions_list.push(d_value);
      } else {
        ions_list.push(1);
        ions_list.push(compound[0]);
      }
      compound = compound.slice(1, compound.length);
      //parsed_compound_list.push(1);
      //parsed_compound_list.push(compound.slice(1, compound.length));
      // Parse: UU+
    }
  }
  //console.log("1495 Compound and length are ", compound, compound.length);
  if (compound.length == 3) {
    //  && compound.length  < 4
    console.log("4170 compound is ", compound);
    compound_length = compound.length;
    // //console.log("1178 Compound is ", compound, compound_length);
    // Parse: H and any subscript
    if (compound.slice(0, 3) == "NH3") {
      // Compound is ammonium, parse it as ammonium -- no parenthesis so coefficient is 1.
      ions_list.push(1);
      ions_list.push(compound.slice(0, 3));
      E_text += "<br>1506 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      compound = ""; // compound.slice(4, compound.length)
      if (compound != "") {
        E_text += "<br>1188 The remaing compound is: " + compound;
        set_explanation_text(E_text);
      }
      // UL#
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] != compound[1].toUpperCase() &&
      compound[2] >= 0
    ) {
      // UL#  && compound[2] != compound[2].toUpperCase()
      console.log(
        "2665 UL# compound is ",
        compound,
        compound[0],
        compound[1],
        compound[2]
      );
      if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
        //console.log("1309 element_to_diatomic_list.includes(compound.slice(0, 2)) ", element_to_diatomic_list.includes(compound.slice(0, 2)));
        let d_value = compound.slice(0, 2); //element_to_diatomic_dict[compound[0, 2]];
        console.log("4282 d_value is ", d_value);
        ions_list.push(compound[2]);
        ions_list.push(d_value);
      } else {
        ions_list.push(compound[2]);
        ions_list.push(compound.slice(0, 2));
      }
      E_text += "<br>4289 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      compound = compound.slice(2, compound.length);
      compound = ""; // compound.slice(4, compound.length)
      if (compound != "") {
        E_text += "<br>2308 The remaing compound is: " + compound;
        set_explanation_text(E_text);
      }
      //console.log("1326 Compound and length are ", compound, compound.length);
      // ULU
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] != compound[1].toUpperCase() &&
      compound[2] == compound[2].toUpperCase()
    ) {
      // ULU
      console.log(
        "2687 ULU compound is ",
        compound,
        compound[0],
        compound[1],
        compound[2]
      );
      if (element_to_diatomic_list.includes(compound.slice(0, 2))) {
        //console.log("1331 element_to_diatomic_list.includes(compound.slice(0, 2)) ", element_to_diatomic_list.includes(compound.slice(0, 2)));
        let d_value = element_to_diatomic_dict[compound.slice(0, 2)];
        ions_list.push(0.5);
        ions_list.push(d_value);
      } else {
        ions_list.push(1);
        ions_list.push(compound.slice(0, 2));
      }
      E_text += "<br>4040 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      compound = compound.slice(2, compound.length);

      //console.log("1124 Compound and length are ", compound, compound.length);
      // U#
    } else if (compound[0] == compound[0].toUpperCase() && compound[1] >= 0) {
      //
      console.log("4048 U# compound is ", compound);
      if (element_to_diatomic_list.includes(compound[0])) {
        //console.log("1556 element_to_diatomic_list.includes(compound[0] ", element_to_diatomic_list.includes(compound[0]));
        let d_value = element_to_diatomic_dict[compound[0]];
        ions_list.push(compound[1] / 2);
        pions_list.push(d_value);
      } else {
        ions_list.push(compound[1]);
        ions_list.push(compound[0]);
      }
      compound = compound.slice(2, compound.length);
      E_text += "<br>1565 remaining compound is: " + compound;
      set_explanation_text(E_text);
      // UU#
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] == compound[1].toUpperCase() &&
      compound[2] >= 0
    ) {
      // UU
      console.log("2719 UU# compound is ", compound);
      if (parsed_compound_list[0] != []) {
        // If there is a prior item in the list, parse the rest as a single ion
        //let d_value = compound[0];
        //console.log("1573 d_value is ", d_value);
        ions_list.push(1);
        ions_list.push(compound[0]);
        compound = compound.slice(1, compound.length);
        console.log("2726 compound is ", compound);
      } else {
        ions_list.push(1);
        ions_list.push(compound[0]);
        compound = compound.slice(1, compound.length);
        console.log("2731 compound is ", compound);
      }
      E_text += "<br>2734 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      E_text += "<br>2736 remaining compound is: " + compound;
      set_explanation_text(E_text);

      //console.log("1586 Compound and length are ", compound, compound.length);
      // UUL
    } else if (
      compound[0] == compound[0].toUpperCase() &&
      compound[1] == compound[1].toUpperCase() &&
      compound[1] != compound[2].toUpperCase()
    ) {
      // UU
      console.log("2741 UUL compound is ", compound);
      if (element_to_diatomic_list.includes(compound[0])) {
        //console.log("1571 element_to_diatomic_list.includes(compound[0] ", element_to_diatomic_list.includes(compound[0]));
        //let d_value = element_to_diatomic_dict[compound[0]];
        let d_value = compound[0];
        //console.log("1573 d_value is ", d_value);
        ions_list.push(1);
        ions_list.push(d_value);
        compound = compound.slice(1, compound.length);
        console.log("2748 compound is ", compound);
      } else {
        ions_list.push(1);
        ions_list.push(compound[0]);
        compound = compound.slice(1, compound.length);
        console.log("2753 compound is ", compound);
      }
      E_text += "<br>2753 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      E_text += "<br>2755 remaining compound is: " + compound;
      set_explanation_text(E_text);
      //console.log("1586 Compound and length are ", compound, compound.length);
    }
  }
  //console.log("2085 compound is ", compound, compound.length);
  if (compound.length == 2) {
    console.log("2762 compound is ", compound, compound.length);
    // Parse: UL
    if (
      compound.length == 2 &&
      compound[0] == compound[0].toUpperCase() &&
      compound[1] != compound[1].toUpperCase()
    ) {
      // UL
      //console.log("1394 compound is ", compound)
      //if (element_to_diatomic_list.includes(compound)) {
      //console.log("1334 element_to_diatomic_list.includes(compound[0] ", element_to_diatomic_list.includes(compound[0]));
      //let d_value = element_to_diatomic_dict[compound];
      //let d_value = compound[0]; //console.log("2371 d_value is ", d_value);
      //parsed_compound_list.push(1);
      //parsed_compound_list.push(d_value);
      //} else {
      ions_list.push(1);
      ions_list.push(compound);

      E_text += "<br>2778 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      compound = ""; //  compound.slice(2, compound.length)
      E_text += "<br>2781 remaining compound is: " + compound;
      set_explanation_text(E_text);

      //console.log("1220 Compound and length are ", compound, compound.length);
      // Parse: U#
    } else if (
      compound.length == 2 &&
      compound[0] == compound[0].toUpperCase() &&
      compound[1] >= 0
    ) {
      // )U#
      console.log("2787 compound is ", compound);
      //if (element_to_diatomic_list.includes(compound[0])) {
      //console.log("1359 element_to_diatomic_list.includes(compound[0] ", element_to_diatomic_list.includes(compound[0]));
      //let d_value = element_to_diatomic_dict[compound[0]];
      //let d_value = compound[0]; //console.log("1361 d_value is ", d_value);
      //parsed_compound_list.push(compound[1]);
      //parsed_compound_list.push(d_value);
      //} else {
      ions_list.push(compound[1]);
      ions_list.push(compound[0]);
      //}
      E_text += "<br>4165 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      compound = compound.slice(2, compound.length);
      E_text += "<br>1416 remaining compound is: " + compound;
      set_explanation_text(E_text);
      //console.log("1418 Compound and length are ", compound, compound.length);
      // Parse: UU
    } else if (
      compound.length == 2 &&
      compound[0] == compound[0].toUpperCase() &&
      compound[1] == compound[1].toUpperCase()
    ) {
      // UU
      console.log("2476 compound is ", compound);
      if (element_to_diatomic_list.includes(compound[0])) {
        //console.log("1359 element_to_diatomic_list.includes(compound[0] ", element_to_diatomic_list.includes(compound[0]));
        //let d_value = element_to_diatomic_dict[compound[0]];
        let d_value = compound[0]; //console.log("1361 d_value is ", d_value);
        ions_list.push(1);
        ions_list.push(d_value);
      } else {
        ions_list.push(1);
        ions_list.push(compound[0]);
      }
      // if (element_to_diatomic_list.includes(compound[1])) {
      //     console.log("1897 element_to_diatomic_list.includes(compound[1] ", element_to_diatomic_list.includes(compound[1]));
      //     //let d_value = element_to_diatomic_dict[compound[1]];
      //     let d_value = compound[0];
      //     //console.log("1373 d_value is ", d_value);
      //     parsed_compound_list.push(1);
      //     parsed_compound_list.push(d_value);
      // } else {
      //     parsed_compound_list.push(1);
      //     parsed_compound_list.push(compound[0]);
      // }
      E_text += "<br>2498 ions_list is: " + ions_list;
      set_explanation_text(E_text);
      compound = compound.slice(2, compound.length);
      E_text += "<br>2501 remaining compound is: " + compound;
      set_explanation_text(E_text);
      //console.log("1373 Compound and length are ", compound, compound.length);
    }
  }
  if (compound.length == 1) {
    console.log("1915 compound is ", compound);
    if (element_to_diatomic_list.includes(compound[0])) {
      //console.log("1378 element_to_diatomic_list.includes(compound[0] ", element_to_diatomic_list.includes(compound[0]));
      let d_value = compound[0]; //element_to_diatomic_dict[compound[0]];
      //console.log("1380 d_value is ", d_value);
      ions_list.push(1);
      ions_list.push(d_value);
    } else {
      ions_list.push(1);
      ions_list.push(compound[0]);
    }
    E_text += "<br>1387 ions_list is: " + ions_list;
    set_explanation_text(E_text);
    compound = "";
    E_text += "<br>1390 remaining compound is: " + compound;
    set_explanation_text(E_text);
    //console.log("1392 Compound and length are ", compound, compound.length);
    // See what remains
  } else if (compound.length == 0) {
    if (compound != "") {
      E_text += "<br>1409 The remaing compound is: " + compound;
      set_explanation_text(E_text);
    } else
      E_text += "<br>4240 The compound has been completely parsed." + compound;
    set_explanation_text(E_text);
  }
  // console.log("4243 about to call set_Cation...");
  // set_Cation_and_Anion('s_1_dict');
  // set_Cation_and_Anion(current_item_info[0]);
  return ions_list;
}

function Parse_Compound_Complete() {
  //console.log("1709 Parse_Compound_Complete ")
  let compound = current_item_info[3];
  let compound_length = compound.length;
  //let letter = compound.charAt(1);
  if (compound.includes("(")) {
    Parse_Compound_with_Parens(compound);
  } else {
    //console.log("1421 in Parse_Compound_Complete w/o parens ", compound, compound_length);
    //let part = compound.slice(0, 2);
    E_text +=
      "<br>1595 Started function Parse_Compound_Complete w/o parens " +
      compound +
      " " +
      compound_length;
    set_explanation_text(E_text);
    Parse_Compound_without_Parens(compound);
  }
}

// Conversions
function convert_C_to_K(C) {
  console.log("4886 convert_C_to_K ", 1 * C + 273.15);
  return 1 * C + 273.15;
}

function convert_F_to_K(F) {
  console.log("5052 convert_F_to_K ", (F - 32) * (5 / 9) + 273.15);
  return (F - 32) * (5 / 9) + 273.15;
}

function convert_K_to_F(K) {
  console.log("5057 convert_F_to_K ", (F - 32) * (5 / 9) + 273.15);
  return 1.8 * (K - 273) + 32;
}

function convert_atm_to_torr(atm) {
  return atm * 760;
}
function convert_torr_to_atm(torr) {
  return torr / 760;
}
function convert_kPa_to_atm(kPa) {
  return (atm = kPa / 101.325);
}
function convert_Pa_to_atm(Pa) {
  return (atm = Pa / 101325);
}

function convert_psi_to_atm(psi) {
  return (atm = psi / 14.6959488);
}
function convert_atm_to_kPa(atm) {
  return (kPa = atm * 101.325);
}
function convert_atm_to_Pa(atm) {
  return (Pa = atm * 101325);
}

function reset_display(s_dict) {
  console.log("4542 s_dict ", s_dict);
  if (s_dict == "s_1_dict") {
    console.log("4544 s_dict ", s_dict);
    reset_s_1_display();
  } else if (s_dict == "s_2_dict") {
    console.log("4547 s_dict ", s_dict);
    reset_s_2_display();
  } else if (s_dict == "s_3_dict") {
    console.log("4550 s_dict ", s_dict);
    reset_s_3_display();
  } else if (s_dict == "s_4_dict") {
    console.log("4553 s_dict ", s_dict);
    reset_s_4_display();
  } else if (s_dict == "s_5_dict") {
    console.log("4556 s_dict ", s_dict);
    reset_s_5_display();
  } else if (s_dict == "s_6_dict") {
    console.log("4557 s_dict ", s_dict);
    reset_s_6_display();
  }
}

function refresh_display(s_dict) {
  console.log("4580 s_dict ", s_dict);
  if (s_dict == "s_1_dict") {
    current_item_info[0] = s_dict;
    console.log("4589 s_dict ", current_item_info[0]);
    refresh_s_1_display();
  } else if (s_dict == "s_2_dict") {
    current_item_info[0] = s_dict;
    console.log("4593 s_dict ", s_dict);
    refresh_s_2_display();
  } else if (s_dict == "s_3_dict") {
    current_item_info[0] = s_dict;
    //console.log("1856 s_dict ", s_dict);
    refresh_s_3_display();
  } else if (s_dict == "s_4_dict") {
    current_item_info[0] = s_dict;
    //console.log("1859 s_dict ", s_dict);
    refresh_s_4_display();
  } else if (s_dict == "s_5_dict") {
    current_item_info[0] = s_dict;
    //console.log("1862 s_dict ", s_dict);
    refresh_s_5_display();
  } else if (s_dict == "s_6_dict") {
    current_item_info[0] = s_dict;
    //console.log("1865 s_dict ", s_dict);
    refresh_s_6_display();
  }
}

function reset_s_1_display() {
  console.log("4609 reset_s_1_display");
  s_1_dict["qty"] = 0;
  s_1_dict["units"] = "grams";
  s_1_dict["M_qty"] = 1;
  s_1_dict["valence"] = 0;
  s_1_dict["kl_qty"] = 0;
  s_1_dict["kl_units"] = "";
  s_1_dict["temp_display_qty"] = 0;
  s_1_dict["mm_qty"] = 0;
  s_1_dict["temp_calc_qty"] = 273.15;
  s_1_dict["temp_display_units"] = "C";
  s_1_dict["press_calc_qty"] = 1;
  s_1_dict["press_display_units"] = "atm";
  s_1_dict["mm_units"] = "";
  refresh_s_1_display();
}

function reset_s_2_display() {
  console.log("4629 reset_s_2_display");
  s_2_dict["qty"] = 0;
  s_2_dict["units"] = "grams";
  s_2_dict["M_qty"] = 1;
  s_2_dict["valence"] = 0;
  s_2_dict["kl_qty"] = 0;
  s_2_dict["kl_units"] = "";
  s_2_dict["temp_display_qty"] = 0;
  s_2_dict["mm_qty"] = 0;
  s_2_dict["temp_calc_qty"] = 273.15;
  s_2_dict["temp_display_units"] = "C";
  s_2_dict["press_calc_qty"] = 1;
  s_2_dict["press_display_units"] = "atm";
  s_2_dict["mm_units"] = "";
}

function reset_s_3_display() {
  console.log("4648 reset_s_3_display");
  s_3_dict["qty"] = 0;
  s_3_dict["units"] = "grams";
  s_3_dict["M_qty"] = 1;
  s_3_dict["valence"] = 0;
  s_3_dict["kl_qty"] = 0;
  s_3_dict["kl_units"] = "";
  s_3_dict["temp_display_qty"] = 0;
  s_3_dict["mm_qty"] = 0;
  s_3_dict["temp_calc_qty"] = 273.15;
  s_3_dict["temp_display_units"] = "C";
  s_3_dict["press_calc_qty"] = 1;
  s_3_dict["press_display_units"] = "atm";
  s_3_dict["mm_units"] = "";
}
function reset_s_4_display() {
  console.log("4666 reset_s_4_display");
  s_4_dict["qty"] = 0;
  s_4_dict["units"] = "grams";
  s_4_dict["M_qty"] = 1;
  s_4_dict["valence"] = 0;
  s_4_dict["kl_qty"] = 0;
  s_4_dict["kl_units"] = "";
  s_4_dict["temp_display_qty"] = 0;
  s_4_dict["mm_qty"] = 0;
  s_4_dict["temp_calc_qty"] = 273.15;
  s_4_dict["temp_display_units"] = "C";
  s_4_dict["press_calc_qty"] = 1;
  s_4_dict["press_display_units"] = "atm";
  s_4_dict["mm_units"] = "";
}
function reset_s_5_display() {
  console.log("4683 reset_s_5_display");
  s_5_dict["qty"] = 0;
  s_5_dict["units"] = "grams";
  s_5_dict["M_qty"] = 1;
  s_5_dict["valence"] = 0;
  s_5_dict["kl_qty"] = 0;
  s_5_dict["kl_units"] = "";
  s_5_dict["temp_display_qty"] = 0;
  s_5_dict["mm_qty"] = 0;
  s_5_dict["temp_calc_qty"] = 273.15;
  s_5_dict["temp_display_units"] = "C";
  s_5_dict["press_calc_qty"] = 1;
  s_5_dict["press_display_units"] = "atm";
  s_5_dict["mm_units"] = "";
}
function reset_s_6_display() {
  console.log("4700 reset_s_6_display");
  s_6_dict["qty"] = 0;
  s_6_dict["units"] = "grams";
  s_6_dict["M_qty"] = 1;
  s_6_dict["valence"] = 0;
  s_6_dict["kl_qty"] = 0;
  s_6_dict["kl_units"] = "";
  s_6_dict["temp_display_qty"] = 0;
  s_6_dict["mm_qty"] = 0;
  s_6_dict["temp_calc_qty"] = 273.15;
  s_6_dict["temp_display_units"] = "C";
  s_6_dict["press_calc_qty"] = 1;
  s_6_dict["press_display_units"] = "atm";
  s_6_dict["mm_units"] = "";
}

function refresh_s_1_display() {
  console.log("5228 refresh_s_1_display");
  current_item_info[0] = "s_1_dict";
  s_1_dict["id"] = "s_1_dict";
  s_1_qty.value = s_1_dict["qty"];
  s_1_units.value = s_1_dict["units"];
  s_1_m_qty.value = s_1_dict["M_qty"];
  s_1_valence.value = s_1_dict["valence"];
  s_1_temp_qty.value = s_1_dict["temp_display_qty"];
  s_1_press_qty.value = s_1_dict["press_display_qty"];
  s_1_kl_qty.value = s_1_dict["kl_qty"];
  s_1_kl_units.value = s_1_dict["kl_units"];
  s_1_mm_qty.value = s_1_dict["mm_qty"];
  s_1_mm_units.value = s_1_dict["mm_units"];
  other_qty_1.value = s_1_dict["electronegativity"];
}

function refresh_s_2_display() {
  console.log("4753 refresh_s_2_display");
  current_item_info[0] = "s_2_dict";
  s_2_dict["id"] = "s_2_dict";
  // console.log("4757 s_2_dict['id']", s_2_dict["id"]);
  s_2_qty.value = s_2_dict["qty"];
  s_2_units.value = s_2_dict["units"];
  s_2_m_qty.value = s_2_dict["M_qty"];
  s_2_valence.value = s_2_dict["valence"];
  s_2_temp_qty.value = s_2_dict["temp_display_qty"];
  s_2_press_qty.value = s_2_dict["press_display_qty"];
  s_2_kl_qty.value = s_2_dict["kl_qty"];
  s_2_kl_units.value = s_2_dict["kl_units"];
  s_2_mm_qty.value = s_2_dict["mm_qty"];
  s_2_mm_units.value = s_2_dict["mm_units"];
  other_qty_2.value = s_2_dict["electronegativity"];
  // console.log("4765 s_2_dict['units']", s_2_dict["units"]);
}
function refresh_s_3_display() {
  current_item_info[0] = "s_3_dict";
  s_3_dict["id"] = "s_3_dict";
  console.log("4770 s_3_dict['id']", s_3_dict["id"]);
  s_3_qty.value = s_3_dict["qty"];
  s_3_units.value = s_3_dict["units"];
  s_3_m_qty.value = s_3_dict["M_qty"];
  s_3_valence.value = s_3_dict["valence"];
  s_3_temp_qty.value = s_3_dict["temp_display_qty"];
  s_3_press_qty.value = s_3_dict["press_display_qty"];
  s_3_kl_qty.value = s_3_dict["kl_qty"];
  s_3_kl_units.value = s_3_dict["kl_units"];
  s_3_mm_qty.value = s_3_dict["mm_qty"];
  s_3_mm_units.value = s_3_dict["mm_units"];
  other_qty_3.value = s_3_dict["electronegativity"];
  //console.log("1815 s_3_dict['valence']", s_3_dict['valence']);
}
function refresh_s_4_display() {
  current_item_info[0] = "s_4_dict";
  s_4_dict["id"] = "s_4_dict";
  console.log("4783 s_4_dict['id']", s_4_dict["id"]);
  s_4_qty.value = s_4_dict["qty"];
  s_4_units.value = s_4_dict["units"];
  s_4_m_qty.value = s_4_dict["M_qty"];
  s_4_valence.value = s_4_dict["valence"];
  s_4_temp_qty.value = s_4_dict["temp_display_qty"];
  s_4_press_qty.value = s_4_dict["press_display_qty"];
  s_4_kl_qty.value = s_4_dict["kl_qty"];
  s_4_kl_units.value = s_4_dict["kl_units"];
  s_4_mm_qty.value = s_4_dict["mm_qty"];
  s_4_mm_units.value = s_4_dict["mm_units"];
  console.log("4790 s_4_dict['units']", s_4_dict["units"]);
}
function refresh_s_5_display() {
  current_item_info[0] = "s_5_dict";
  s_5_dict["id"] = "s_5_dict";
  console.log("4674 s_5_dict['id']", s_5_dict["id"]);
  s_5_qty.value = s_5_dict["qty"];
  s_5_units.value = s_5_dict["units"];
  s_5_m_qty.value = s_5_dict["M_qty"];
  s_5_valence.value = s_5_dict["valence"];
  s_5_temp_qty.value = s_5_dict["temp_display_qty"];
  s_5_press_qty.value = s_5_dict["press_display_qty"];
  s_5_kl_qty.value = s_5_dict["kl_qty"];
  s_5_kl_units.value = s_5_dict["kl_units"];
  s_5_mm_qty.value = s_5_dict["mm_qty"];
  s_5_mm_units.value = s_5_dict["mm_units"];
  //console.log("1833 s_5_dict['valence']", s_5_dict['valence']);
}
function refresh_s_6_display() {
  current_item_info[0] = "s_6_dict";
  s_6_dict["id"] = "s_6_dict";
  console.log("4685 s_6_dict['id']", s_6_dict["id"]);
  s_6_qty.value = s_6_dict["qty"];
  s_6_units.value = s_6_dict["units"];
  s_6_m_qty.value = s_6_dict["M_qty"];
  s_6_valence.value = s_6_dict["valence"];
  s_6_temp_qty.value = s_6_dict["temp_display_qty"];
  s_6_press_qty.value = s_6_dict["press_display_qty"];
  s_6_kl_qty.value = s_6_dict["kl_qty"];
  s_6_kl_units.value = s_6_dict["kl_units"];
  s_6_mm_qty.value = s_6_dict["mm_qty"];
  s_6_mm_units.value = s_6_dict["mm_units"];
  //console.log("1842 s_6_dict['valence']", s_6_dict['valence']);
}

function reset_substance_dictionary(s_dict) {
  console.log("2987 entered reset_substance_dictionary");
  var cleared_dict = { ...s_dict };
  Object.keys(s_0_dict).map((key) => {
    cleared_dict[key] = s_0_dict[key];
  });

  return cleared_dict;
}

function reset_substance_container(s_dict) {
  console.log("5381 entered reset_substance_container");
  reset_substance_dictionary(s_dict);
  refresh_display(s_dict);
}
function Parse_Reactant() {
  //I need to parse for number, uppercase, and lowercase. Leading number always applies to an element or formula,
  //later numbers are assumed to apply to the preceeding element.
  //console.log("1779 Parse_Reactant process entered");
  //openGuidanceModal('Parse Reactants was selected.');
  if (s_1_dict["type"] == "compound") {
    //console.log("2535 Parse_Reactant process entered");
    not_yet_functional();
  }
}

function Parse_Product() {
  //I need to parse for number, uppercase, and lowercase. Leading number always applies to an element or formula,
  //later numbers are assumed to apply to the preceeding element.
  //console.log("2681 Parse_Product process entered");
  //openGuidanceModal('Parse Reactants was selected.');
  if (s_1_dict["type"] == "compound") {
    //console.log("2550 Parse_Product process entered");
    not_yet_functional();
    //e//ci_1 = cb_1.get()
    //compound = cb_1.get()
    //print('Parse_Products compound is ', compound)
  }
  //openGuidanceModal('<br>1861 Parse Products was selected.');
}

function vol_to_molarity(s_id, s_dict) {
  console.log("3028 entered vol_to_molarity(s_id, s_dict)", s_id, s_dict);
  // Only works if regular units are grams
  if (p_dict[s_dict]["type"] == "element") {
    console.log("2488 p_dict[s_dict['type'] == 'element'");
    //e//ci_1 = cb_1.get()
    //compound = cb_1.get;()
    //print('Parse_Reactants compound is ', compound)
  } else if (p_dict[s_dict]["type"] == "compound") {
    console.log("2493 p_dict[s_dict]['type'] == 'compound'");
  } else if (p_dict[s_dict]["type"] == "diatomic") {
    //console.log("2024 p_dict[s_dict]['type'] == 'diatomic'");
  }
}

function select_major_process(event, s_id2339) {
  console.log("2996 major_process is", event, s_id);
  console.log("2968 payment_plan is ", payment_plan);
  let major_process = document.getElementById(s_id).value;
  gen_dict["major_process"] = major_process;
  console.log("2968 major_process is ", major_process);
  if (payment_plan >= 5) {
    console.log("2974 payment_plan is ", payment_plan);
    openGuidanceModal(
      "Major processes are only available in Standard and above subscription levels."
    );
  } else
    setTimeout(() => {
      var select = document.getElementById(s_id);
    }, 100);
  var opt = document.createElement("option");
  console.log("2980 select getElementById(s_id)", select);
  var s_units = select.options[select.selectedIndex].text;
  select.value = s_units;
  console.log("2041 select.value ", select.value);
  major_process = select.value;
  if (select.value == "Balance Equation" || select.value == "Combustion") {
    openGuidanceModal(
      "<br>The major process " +
        select.value +
        " was selected. " +
        "<br>This processes will be functional in the Standard account and above. "
    );
  } else if (select.value == "Synthesis") {
    openGuidanceModal(
      "<br>The major process " +
        select.value +
        " was selected. It is not completely functional " +
        ", but user can input _substances and quantities to start the process. Then click Continue."
    );
    Synthesis();
  }
}

function select_minor_process(event, s_id) {
  //select_minor_process(event,'select_minor_process') , s_id
  console.log("3159 minor_process is", event, s_id); // , s_id
  //console.log("3160 payment_plan is ", payment_plan);
  minor_process = document.getElementById(s_id).value;
  gen_dict["minor_process"] = minor_process;
  console.log("3163 gen_dict['minor_process'] is ", gen_dict["minor_process"]);
  if (payment_plan >= 5) {
    //debugger;  // *** This doesn't work
    openGuidanceModal(
      "Major and minor processes are only available in basic and above subscription level."
    );
    //console.log("2871 select_minor_proces process entered", event);
  }
  // setTimeout(() => {
  //     var select = document.getElementById(s_id);
  // }, 100);
  var select = document.getElementById(s_id);
  var opt = document.createElement("option");
  console.log("5474 select getElementById(s_id)", select, opt);
  var s_units = select.options[select.selectedIndex].text;
  select.value = s_units;
  console.log("5477 select.value is ", select.value);
  minor_process = select.value;
  console.log(
    "5479 s_units, select, minor_process are: ",
    s_units,
    select,
    minor_process
  );
  //console.log("3014 minor_process and s_units ", minor_process, s_units);
  if (s_units == "calc_molarity") {
    openGuidanceModal(
      'The minor process "calc_molarity" was selected. Select a compound and click on the Continue button.'
    );
    //console.log("1876 select.value ", select.value);
  } else if (s_units == "calc formula mass") {
    openGuidanceModal(
      'The minor process "calc formula mass" was selected. Select a compound and click on the Continue button.'
    );
    //console.log("1879 select.value ", select.value);
    calc_formula_mass();
  } else if (s_units == "molarity or moles to liters") {
    openGuidanceModal(
      'The minor process "molarity or moles to liters" was selected. ' +
        "Input a new molarity or mole quantity and click the Continue button."
    );
    //console.log("5494 select.value ", select.value);
  } else if (s_units == "molarity or liters to moles") {
    openGuidanceModal(
      'The minor process "molarity or liters to moles" was selected. ' +
        "Input a new molarity or liter quantity and click the Continue button."
    );
    //console.log("1885 select.value ", select.value);
  } else if (s_units == "volume to temperature") {
    openGuidanceModal(
      'The minor process "molarity or liters to moles" was selected. ' +
        "Input a new molarity or liter quantity and click the Continue button."
    );
    volume_to_temperature = true;
    //console.log("1885 select.value ", select.value);
  } else if (s_units == "temperature to pressure") {
    openGuidanceModal(
      'The minor process "temperature to pressure" was selected. ' +
        "Set units to liters(g) and input a new temperature."
    );
    b_temperature_to_pressure = true;
    //console.log("1885 select.value ", select.value);
  } else if (s_units == "calc specific heat") {
    console.log("5326 s_units ", s_units);
    openGuidanceModal(
      'The minor process "calc specific heat" was selected. ' +
        'To calculate specific heat, the main units are set to "grams",' +
        ' the heat units to "J/g °C", and "other units" to "c". Enter a mass, a heat quantity, ' +
        "a temperature difference quantity and press the Continue button."
    );
    p_dict[s_id]["units"] = "grams";
    p_dict[s_id]["s_1_other_units"] = "c";
    p_dict[s_id]["heat_units"] = "J/g °C";
    s_1_units.value = p_dict[s_id]["units"];
    s_1_heat_units.value = p_dict[s_id]["heat_units"];
    s_1_other_units.value = p_dict[s_id]["other_units"];
  } else if (s_units == "calc heat/work/energy") {
    // 2911
    console.log("2913 s_units ", s_units);
    openGuidanceModal(
      'To calculate heat work energy, select a substance, set the main units to "grams",' +
        ' the heat units to "J/g °C", and "other units" to "c". Enter mass, spcific heat and temperature difference,' +
        " quantities and press the Continue button."
    );
    p_dict["s_1_dict"]["units"] = "grams";
    p_dict["s_1_dict"]["other_units"] = "c";
    p_dict["s_1_dict"]["heat_units"] = "J/g °C";
    s_1_units.value = p_dict["s_1_dict"]["units"];
    s_1_heat_units.value = p_dict["s_1_dict"]["heat_units"];
    s_1_other_units.value = p_dict["s_1_dict"]["other_units"];
    other_units_1_lbl.innerHTML = "Specific Heat Units";
    other_qty_1_lbl.innerHTML = "Specific Heat Qty";
    //console.log("2304 select.value ", select.value);
  } else if (s_units == "Parse_Reactant") {
    openGuidanceModal(
      "The minor process Parse_Reactant was selected. Parse_Reactant, Parse_Product, " +
        " and some other Parse functions are useful individually and as building blocks for later functions such as " +
        "creating Complete Molecular Equations and Complete Ionic Equations." +
        "<br>These processes will become functional soon in the basic account and above. "
    );
    //console.log("1888 select.value ", select.value);
  } else if (s_units == "Parse_Product") {
    openGuidanceModal(
      "The minor process Parse_Product was selected. Parse_Reactant, Parse_Product, " +
        " and some other Parse functions are useful individually and as building blocks for later functions such as " +
        "creating Complete Molecular Equations and Complete Ionic Equations." +
        "<br>These processes will become functional soon in the basic account and above. "
    );
    //console.log("1892 select.value ", select.value);
  } else if (s_units == "Parse Compound to Ions") {
    openGuidanceModal(
      "The minor process Parse Compound to Ions was selected. <br>This process parses a compound to its ions and to regular, not diatomic, elements. <br>Select a compound and click on the Continue button."
    );
    //console.log("1895 select.value ", select.value);
  } else if (s_units == "Parse Compound to Ions and Diatomic") {
    openGuidanceModal(
      "The minor process Parse Compound to Ions and Diatomic was selected. <br>This process parses a compound to its ions and to diatomic, not regular, elements. <br>Select a compound and click on the Continue button."
    );
    //console.log("1898 select.value ", select.value);
  } else if (s_units == "Parse Compound to Elements") {
    console.log("3075 selected minor process is Parse Compound to Elements");
    openGuidanceModal(
      "The minor process Parse Compound to Elements was selected. <br>This process parses a compound to its elements and to regular, not diatomic, elements. <br>Select a compound and click on the Continue button."
    );
    //console.log("1897 select.value ", select.value);
  } else if (s_units == "Parse Compound to Elements and Diatomic") {
    openGuidanceModal(
      "The minor process Parse Compound to Elements and Diatomic was selected. <br>This process parses a compound to its elements and to diatomic, not regular, elements. <br>Select a compound and click on the Continue button."
    );
    //console.log("1904 select.value ", select.value);
  } else {
    volume_to_temperature = false;
  }
}

// Balance_Equation", "Combustion"
//function Balance_Equation1() {
// Balance a chemical equation

// for substances 1 through 3, parse the substances
// to an elements list, and add them to the reactantListCopy
// for substances 4 through 6, parse the substances
// to an elements list, and add them to the productListCopy
// iterate throught the reactant list to identify elements
// that only occur once in the reactant list and once in the
// product list.
// Balance the coefficients and remove the item from the
// working copy.
//  not_yet_functional();
//}

function Combustion() {
  //openGuidanceModal('The selected process in not yet functional.');
  not_yet_functional();
}

function Synthesis() {
  openGuidanceModal(
    "Enter two or more reactants and press the Continue button."
  );
  //not_yet_functional()
}

function Synthesis_Continue() {
  //console.log("2122 Entered Continue process Synthesis_Continue");
  if (p_dict["s_1_dict"]["formula"] != "") {
    substance_1 = p_dict["s_1_dict"]["formula"];
    console.log("2006 substance_1 is", substance_1);
  }
  if (p_dict["s_2_dict"]["formula"] != "") {
    substance_2 = p_dict["s_2_dict"]["formula"];
    console.log("2010 substance_2 is", substance_2);
  }
  if (p_dict["s_3_dict"]["formula"] != "") {
    substance_3 = p_dict["s_3_dict"]["formula"];
    console.log("2014 substance_3 is", substance_3);
  } else if (p_dict["s_3_dict"]["formula"] == "") {
    console.log("2016 There are only two _substances in this process.");
  }
  if (isNumber(s_1_dict["valence"])) {
    console.log("2020 Substance 1 valence is numberic.");
  } else {
    console.log("2022 Substance 1 valence is not numberic.");
  }
}

function input_cation_change(e, s_id, s_dict) {
  if (payment_plan >= 5) {
    openGuidanceModal(
      "This processes is only available in Basic and above subscription levels."
    );
    p_dict[s_dict]["cation"] = "";
    s_id.value = "";
  } else {
    console.log("2195 input_cation_change.", event, s_id, s_dict);
    var inputValue = document.getElementById(e.target.id).value;
    var select = document.getElementById(s_id);
    var opt = document.createElement("option");
    p_dict[s_dict]["cation"] = inputValue;
    console.log("2205 select getElementById(s_id)", p_dict[s_dict]["cation"]);
    E_text += "<br>Changed cation to " + inputValue;
    set_explanation_text(E_text);
  }
}

function input_anion_change(e, s_id, s_dict) {
  if (payment_plan >= 5) {
    openGuidanceModal(
      "This processes is only available in Basic and above subscription levels."
    );
    p_dict[s_dict]["anion"] = "";
    s_id.value = "";
  } else {
    console.log("2195 input_anion_change.", event, s_id, s_dict);
    var inputValue = document.getElementById(e.target.id).value;
    var select = document.getElementById(s_id);
    var opt = document.createElement("option");
    p_dict[s_dict]["anion"] = inputValue;
    console.log("2199 select getElementById(s_id)", p_dict[s_dict]["anion"]);
    E_text += "<br>Changed anion to " + inputValue;
    set_explanation_text(E_text);
  }
}

function input_parse_cation_qty_change(e, s_id, s_dict) {
  console.log(
    "2199 input_parse_cation_qty_change.",
    e,
    s_id,
    s_dict,
    payment_plan
  );
  if (payment_plan >= 5) {
    openGuidanceModal(
      "This processes is only available in Basic and above subscription levels."
    );
  } else {
    // save changes to the dictionary
    var inputValue = document.getElementById(e.target.id).value;
    var select = document.getElementById(s_id);
    var opt = document.createElement("option");
    console.log("2204 select getElementById(s_id)", inputValue);
    if (inputValue.includes(":")) {
      let colon_index = inputValue.indexOf(":");
      let cation_qty = inputValue[0];
      //if (isNumber(cation_qty)){
      p_dict[s_dict]["cation_qty"] = cation_qty;
      console.log("2210 dict saved are ", p_dict[s_dict]["cation_qty"]);
      //}else {
      //    openGuidanceModal('You did not enter a valid number for the quantity.');
      //}
      let cation_charge = inputValue.slice(colon_index + 1, inputValue.length);
      //if (valence_list.includes(cation_charge)) { // .slice(colon_index +1,inputValue.length)
      //if (isNumber(cation_charge)){
      p_dict[s_dict]["cation_charge"] = cation_charge;
      console.log("2217 dict saved are", p_dict[s_dict]["cation_charge"]);
      //}else {
      //    openGuidanceModal('You did not enter a valid number for the charge.');
      //}
      console.log(
        "2207 colon_index ",
        inputValue,
        colon_index,
        cation_qty,
        cation_charge
      );
      //p_dict[s_dict]['cation_charge'] = cation_charge
      E_text += "<br>Changed cation quantity and charge to " + inputValue;
      set_explanation_text(E_text);
    } else {
      openGuidanceModal(
        "You did not enter a valid value. A colon is required to separate quantity and charge values."
      );
    }
  }
}

function input_parse_anion_qty_change(e, s_id, s_dict) {
  console.log("2217 input_parse_anion_qty_change.", e, s_id, s_dict);
  if (payment_plan >= 5) {
    openGuidanceModal(
      "This processes is only available in Basic and above subscription levels."
    );
  }
  // save changes to the dictionary
  else var inputValue = document.getElementById(e.target.id).value;
  var select = document.getElementById(s_id);
  var opt = document.createElement("option");
  console.log("2204 select getElementById(s_id)", inputValue);
  if (inputValue.includes(":")) {
    let colon_index = inputValue.indexOf(":");
    let anion_qty = inputValue[0];
    let anion_charge = inputValue.slice(colon_index + 1, inputValue.length);
    console.log(
      "2227 colon_index ",
      inputValue,
      colon_index,
      anion_qty,
      anion_charge
    );
    p_dict[s_dict]["anion_qty"] = anion_qty;
    p_dict[s_dict]["anion_charge"] = anion_charge;
    console.log(
      "2230 dict saved are",
      p_dict[s_dict]["anion_qty"],
      ": ",
      p_dict[s_dict]["anion_charge"]
    );
    E_text += "<br>Changed anion quantity and charge to" + inputValue;
    set_explanation_text(E_text);
  } else {
    openGuidanceModal(
      "You did not enter a valid value. A colon is required to separate quantity and charge values."
    );
  }
}

function set_delay(seconds = 1) {
  return new Promise((resolve) => setTimeout(resolve, seconds * 1000));
}
function calc_formula_mass() {
  console.log("3230 entered calc_formula_mass");
  parsed_compound_list = [];
  Parse_Compound_to_Elements();
  // For coding and testing use the following parsed_compound_list
  ///parsed_compound_list = [4, 'Al', 3, 'C', 1, 'Ca', 4, 'H', 2, 'P', 8, 'O'];
  let pcl_len = parsed_compound_list.length;
  console.log("3221 parsed_compound_list.length is ", pcl_len);
  let formula_mass = 0;
  console.log("3223 formula_mass is ", formula_mass);
  let coefficient = parsed_compound_list[0];
  let substance_formula = parsed_compound_list[1];
  let substance_mass = 0;
  for (var i = 0; i < parsed_compound_list.length; i = i + 2) {
    coefficient = parsed_compound_list[i];
    console.log("5524 coefficient is ", coefficient);
    substance_formula = parsed_compound_list[i + 1];
    console.log("3231 substance_formula is ", substance_formula);
    //substance_mass = element_dict['mass'];
    // substance_mass = substance_formula['mass'];
    substance_mass = elements[substance_formula]["mass"];
    console.log("3235 substance_mass is ", substance_mass);
    formula_mass += coefficient * substance_mass;
    console.log("3237 formula_mass is ", formula_mass);
    //
    //substance_mass = s_num_dict["mass"] = substance_mass; // e_dict['mass'];
    // el_mass = p_dict[element]['mass']
  }
}

function set_environment_type() {
  // 'Select_environment'
  let environment_Id = document.getElementById("Select_environment").value;
  gen_dict["environment"] = environment_Id;
}
//
function select_major_process1(event) {
  let major_process = document.getElementById("select_major_process").value;
  gen_dict["major_process"] = major_process;
}

function showAlert(type, message) {
  $("#" + type).removeClass("hidden");
  $("#" + type).addClass("show");
  var ele = document.getElementById(type + "-message");
  ele.innerHTML = message;
  setTimeout(() => {
    $("#" + type).removeClass("show");
    $("#" + type).addClass("hidden");
  }, 3000);
  return;
}

function create_Record() {
  console.log("3284 entered create_Record", payment_plan);

  openGuidanceModal(
    "This processes is only available in Basic and above subscription levels."
  );
  if (payment_plan >= 20) {
    let record_Id = document.getElementById("Create_Record_id").value;
    let record = "";
    gen_dict["record_id"] = record_Id;

    record =
      "record_id:" +
      gen_dict["record_id"] +
      ", " +
      "environment:" +
      gen_dict["environment"] +
      ", " +
      "major_process:" +
      gen_dict["major_process"] +
      ", " +
      "minor_process:" +
      gen_dict["minor_process"] +
      ", " +
      "process_yield:" +
      gen_dict["process_yield"] +
      ", " +
      "energy_type:" +
      gen_dict["energy_type"] +
      ", " +
      "energy_amount:" +
      gen_dict["energy_amount"] +
      ", " +
      "catalyst:" +
      gen_dict["catalyst"] +
      ", " +
      "side_effects:" +
      gen_dict["side_effects"] +
      ", " +
      "by_products:" +
      gen_dict["by_products"] +
      ", " +
      "variable_list:" +
      gen_dict["variable_list"] +
      ", " +
      "notes:" +
      gen_dict["notes"];

    gen_dict["substances"] = JSON.stringify(p_dict);
    let explanations = document.getElementById("explanations").value;
    gen_dict["notes"] = explanations;
    dict_list.forEach((dict) => {
      console.log(p_dict[dict]);
      if (p_dict[dict]["type"] != "") {
        record +=
          ", " +
          dict +
          ", " +
          p_dict[dict]["formula"] +
          ", " +
          p_dict[dict]["name"] +
          ", " +
          p_dict[dict]["type"] +
          ", " +
          p_dict[dict]["units"] +
          ", " +
          p_dict[dict]["qty"] +
          ", " +
          p_dict[dict]["temp_display_qty"];
      }
    });
    if (record_Id == "") {
      showAlert("warning", "Please insert the record name!");
      return;
    }
    if (selected_record && selected_record.record_id == record_Id) {
      showAlert(
        "warning",
        "If you want to create a new record from current one, you need to change the record name."
      );
      return;
    }
    $.ajax({
      type: "POST",
      url: "/create_record/",
      data: {
        data: JSON.stringify(gen_dict),
      },
      success: function (response) {
        console.log(response);
        if (response.status === true) {
          showAlert("success", "Record was created successfully");
        } else {
          showAlert("warning", response.message);
        }
      },
      error: function (response) {
        // alert the error if any error occured
        alert("Something went wrong");
      },
    });
  }
}

function get_record(value) {
  openGuidanceModal(
    "This processes is only available in Basic and above subscription levels."
  );
  if (payment_plan >= 20) {
    $.ajax({
      type: "POST",
      url: "/get_record/",
      data: {
        key: value,
      },
      success: function (response) {
        if (response.status === true) {
          if (response.records?.length > 0) {
            records = response.records;
            selected_record = response.records[0];
            p_dict = JSON.parse(response.records[0].substances);
            renderDicts();
          }
        } else {
          $("#warning").removeClass("hidden");
          $("#warning").addClass("show");
          var ele = document.getElementById("warning-message");
          ele.innerHTML = response.message;
          setTimeout(() => {
            $("#warning").removeClass("show");
            $("#warning").addClass("hidden");
          }, 3000);
        }
      },
      error: function (response) {
        // alert the error if any error occured
        alert("Something went wrong");
      },
    });
  }
}

function update_record() {
  openGuidanceModal(
    "This processes is only available in Basic and above subscription levels."
  );
  if (payment_plan >= 20) {
    gen_dict["substances"] = JSON.stringify(p_dict);
    let record_uid = selected_record.id;
    gen_dict["id"] = record_uid;
    let explanations = document.getElementById("explanations").value;
    gen_dict["notes"] = explanations;
    $.ajax({
      type: "POST",
      url: "/update_record/",
      data: {
        data: JSON.stringify(gen_dict),
      },
      success: function (response) {
        if (response.status === true) {
          showAlert("success", "Record was updated successfully");
        } else {
          showAlert("warning", response.message);
        }
      },
      error: function (response) {
        // alert the error if any error occured
        alert("Something went wrong");
      },
    });
  }
}

function update_compound(dict) {
  const postData = dict;
  $.ajax({
    type: "POST",
    url: "/update_compound/",
    data: {
      data: JSON.stringify(postData),
    },
    success: function (response) {
      if (response.status === true) {
        console.log("success", "Record was updated successfully");
      } else {
        console.log("warning", response.message);
      }
    },
    error: function (response) {
      // alert the error if any error occured
      console.log("Something went wrong");
    },
  });
}

function renderDicts() {
  Object.entries(p_dict).map(async (item) => {
    let key = item[0];
    let value = item[1];
    let type_id = "";
    let substance = "";
    let substance_name = "";
    let qty = "";
    let m_qty = "";
    switch (key) {
      case "s_1_dict":
        type_id = "s_1_type";
        s_1_dict = value;
        console.log("====================================");
        console.log("s_1_dict: ");
        console.log(s_1_dict);
        console.log("====================================");
        substance = "substance_1_" + value.type;
        substance_name = "substance_1_name_" + value.type;
        qty = "s_1_qty";
        m_qty = "s_1_m_qty";
        break;
      case "s_2_dict":
        type_id = "s_2_type";
        s_2_dict = value;
        substance = "substance_2_" + value.type;
        substance_name = "substance_2_name_" + value.type;
        qty = "s_2_qty";
        m_qty = "s_2_m_qty";
        break;
      case "s_3_dict":
        type_id = "s_3_type";
        s_3_dict = value;
        substance = "substance_3_" + value.type;
        substance_name = "substance_3_name_" + value.type;
        qty = "s_3_qty";
        m_qty = "s_3_m_qty";
        break;
      case "s_4_dict":
        type_id = "s_4_type";
        s_4_dict = value;
        substance = "substance_4_" + value.type;
        substance_name = "substance_4_name_" + value.type;
        qty = "s_4_qty";
        m_qty = "s_4_m_qty";
        break;
      case "s_5_dict":
        type_id = "s_5_type";
        s_5_dict = value;
        substance = "substance_5_" + value.type;
        substance_name = "substance_5_name_" + value.type;
        qty = "s_5_qty";
        m_qty = "s_5_m_qty";
        break;
      case "s_6_dict":
        type_id = "s_6_type";
        s_6_dict = value;
        substance = "substance_6_" + value.type;
        substance_name = "substance_6_name_" + value.type;
        qty = "s_6_qty";
        m_qty = "s_6_m_qty";
        break;
    }
    if (value.type == "") return;
    let type_select = document.getElementById(type_id);
    type_select.value = value.type;

    fill_substance_formulas(type_id, value.type, key);
    document.getElementById(substance).focus();
    document.getElementById(substance).blur();
    document.getElementById(substance).value = value.formula;
    setSelectedItemName(type_id, substance_name, substance, value.formula);
    await set_delay();
    let qty_ele = document.getElementById(m_qty);
    qty_ele.value = parseInt(value.M_qty);
    input_qty_change(qty_ele, m_qty, key);
  });
  let explanations = document.getElementById("explanations");
  explanations.value = selected_record.notes;
}

async function function_Tests() {
  console.log("5408 entered function_Tests");
  // Set substance 1 type to element and dictionary to s_1_dict
  // *** Not the following
  // set_substance_type("element", s_1_dict)
  set_substance_type("s_1_type", "s_1_dict");
  //await set_delay();
  let type_select = document.getElementById("s_1_type");
  type_select.value = "element";
  //var value = "element" //select.options[select.selectedIndex].value;
  //E_text += value + " .";
  //set_explanation_text(E_text)
  //await set_delay();

  fill_substance_formulas("s_1_type", "element", "s_1_dict");
  // Set the Substance 1 substance to "N"
  //await set_delay();
  set_substance_type("s_1_type", "s_1_dict");
  //await set_delay();
  document.getElementById("substance_1_element").focus();
  document.getElementById("substance_1_element").blur();
  document.getElementById("substance_1_element").value = "Be";
  setSelectedItemName(
    "s_1_type",
    "substance_1_name_element",
    "substance_1_element",
    "Be"
  );
  //let substance_select = document.getElementById('substance_1_element');
  //substance_select.value = "Be";
  console.log("3089 s_1_dict", s_1_dict);
  refresh_display("s_1_dict");
  //await set_delay();
  //*****

  // set_substance_type("element", s_2_dict)
  set_substance_type("s_2_type", "s_2_dict");
  //await set_delay();
  type_select = document.getElementById("s_2_type");
  type_select.value = "element";
  //await set_delay();

  fill_substance_formulas("s_2_type", "element", "s_2_dict");
  // Set the Substance 1 substance to "N"
  set_substance_type("s_2_type", "s_2_dict");
  document.getElementById("substance_2_element").focus();
  document.getElementById("substance_2_element").blur();
  document.getElementById("substance_2_element").value = "N";
  setSelectedItemName(
    "s_2_type",
    "substance_2_name_element",
    "substance_2_element",
    "N"
  );
  console.log("3089 s_2_dict", s_2_dict);
  refresh_display("s_2_dict");
  //await set_delay();

  set_initial_values(s_4_dict);

  set_substance_type("s_4_type", "s_4_dict");
  //await set_delay();
  type_select = document.getElementById("s_4_type");
  type_select.value = "compound";

  fill_substance_formulas("s_4_type", "compound", "s_4_dict");
  // Set the Substance 1 substance to "N"
  //await set_delay();
  set_substance_type("s_4_type", "s_4_dict");
  //await set_delay();
  document.getElementById("substance_4_compound").focus();
  document.getElementById("substance_4_compound").blur();
  document.getElementById("substance_4_compound").value = "Al4C3";
  comF = document.getElementById("substance_4_compound");
  //await set_delay();
  comF.value = "Al4C3";
  setSelectedItemName(
    "s_4_type",
    "substance_4_name_compound",
    "substance_4_compound",
    "Al4C3"
  );
  console.log("3305 s_4_dict", s_4_dict);
  refresh_display("s_4_dict");

  await set_delay();
  //await set_delay();
  console.log("3313 call set_form_for_BE_calcs()");
  set_form_for_BE_calcs();
}

function set_form_for_BE_calcs() {
  console.log("5615 entered set_form_for_BE_calcs");
  set_initial_values(s_1_dict);
  set_substance_type("s_1_type", "s_1_dict");
  type_select = document.getElementById("s_1_type");
  type_select.value = "compound";
  fill_substance_formulas("s_1_type", "compound", "s_1_dict");
  set_substance_type("s_1_type", "s_1_dict");
  document.getElementById("substance_1_compound").focus();
  document.getElementById("substance_1_compound").blur();
  document.getElementById("substance_1_compound").value = "CH4";
  comF = document.getElementById("substance_1_compound");
  comF.value = "CH4";
  setSelectedItemName(
    "s_1_type",
    "substance_1_name_compound",
    "substance_1_compound",
    "CH4"
  );
  console.log("3305 s_1_dict", s_1_dict);
  refresh_display("s_1_dict");

  set_initial_values(s_2_dict);
  set_substance_type("s_2_type", "s_2_dict");
  type_select = document.getElementById("s_2_type");
  type_select.value = "compound";
  fill_substance_formulas("s_2_type", "compound", "s_2_dict");
  set_substance_type("s_2_type", "s_2_dict");
  document.getElementById("substance_2_compound").focus();
  document.getElementById("substance_2_compound").blur();
  document.getElementById("substance_2_compound").value = "CH4";
  comF = document.getElementById("substance_2_compound");
  comF.value = "CH4";
  setSelectedItemName(
    "s_2_type",
    "substance_2_name_compound",
    "substance_2_compound",
    "CH4"
  );
  console.log("3305 s_2_dict", s_2_dict);
  refresh_display("s_2_dict");

  set_initial_values(s_3_dict);
  set_substance_type("s_3_type", "s_3_dict");
  type_select = document.getElementById("s_3_type");
  type_select.value = "compound";
  fill_substance_formulas("s_3_type", "compound", "s_3_dict");
  set_substance_type("s_3_type", "s_3_dict");
  document.getElementById("substance_3_compound").focus();
  document.getElementById("substance_3_compound").blur();
  document.getElementById("substance_3_compound").value = "CH4";
  comF = document.getElementById("substance_3_compound");
  comF.value = "CH4";
  setSelectedItemName(
    "s_3_type",
    "substance_3_name_compound",
    "substance_3_compound",
    "CH4"
  );
  console.log("3305 s_3_dict", s_3_dict);
  refresh_display("s_3_dict");

  set_initial_values(s_4_dict);
  set_substance_type("s_4_type", "s_4_dict");
  type_select = document.getElementById("s_4_type");
  type_select.value = "compound";
  fill_substance_formulas("s_4_type", "compound", "s_4_dict");
  set_substance_type("s_4_type", "s_4_dict");
  document.getElementById("substance_4_compound").focus();
  document.getElementById("substance_4_compound").blur();
  document.getElementById("substance_4_compound").value = "CH4";
  comF = document.getElementById("substance_4_compound");
  comF.value = "CH4";
  setSelectedItemName(
    "s_4_type",
    "substance_4_name_compound",
    "substance_4_compound",
    "CH4"
  );
  console.log("3305 s_4_dict", s_4_dict);
  refresh_display("s_4_dict");

  set_initial_values(s_5_dict);
  set_substance_type("s_5_type", "s_5_dict");
  type_select = document.getElementById("s_5_type");
  type_select.value = "compound";
  fill_substance_formulas("s_5_type", "compound", "s_5_dict");
  set_substance_type("s_5_type", "s_5_dict");
  document.getElementById("substance_5_compound").focus();
  document.getElementById("substance_5_compound").blur();
  document.getElementById("substance_5_compound").value = "CH4";
  comF = document.getElementById("substance_5_compound");
  comF.value = "CH4";
  setSelectedItemName(
    "s_5_type",
    "substance_5_name_compound",
    "substance_5_compound",
    "CH4"
  );
  console.log("3305 s_5_dict", s_5_dict);
  refresh_display("s_5_dict");

  set_initial_values(s_6_dict);
  set_substance_type("s_6_type", "s_6_dict");
  type_select = document.getElementById("s_6_type");
  type_select.value = "compound";
  fill_substance_formulas("s_6_type", "compound", "s_6_dict");
  set_substance_type("s_6_type", "s_6_dict");
  document.getElementById("substance_6_compound").focus();
  document.getElementById("substance_6_compound").blur();
  document.getElementById("substance_6_compound").value = "CH4";
  comF = document.getElementById("substance_6_compound");
  comF.value = "CH4";
  setSelectedItemName(
    "s_6_type",
    "substance_6_name_compound",
    "substance_6_compound",
    "CH4"
  );
  console.log("3305 s_6_dict", s_6_dict);
  refresh_display("s_6_dict");
}

function select_equipment(equipment) {
  //console.log("3938 e and select_equipment is ", equipment);
  var selected_option = document.getElementById(equipment).value;
  gen_dict["equipment"] = selected_option;
  console.log("3949 gen_dict['equipment'] is", gen_dict["equipment"]);
}

function select_energy_type(energy_type) {
  //console.log("3938 e and select_energy_type is ", energy_type);
  var selected_option = document.getElementById(energy_type).value;
  gen_dict["energy_type"] = selected_option;
  console.log("3957 gen_dict['energy_type'] is", gen_dict["energy_type"]);
}

function select_Catalyst(catalyst_type) {
  //console.log("3960 select_Catalyst is ", catalyst_type);
  var selected_option = document.getElementById(catalyst_type).value;
  gen_dict["catalyst"] = selected_option;
  console.log("3964 gen_dict['catalyst'] is", gen_dict["catalyst"]);
}

function select_Side_effects(side_effects) {
  //console.log("3968 e and select_Side_effects is ", side_effects);
  var selected_option = document.getElementById(side_effects).value;
  gen_dict["side_effects"] = selected_option;
  console.log("3971 gen_dict['side_effects'] is", gen_dict["side_effects"]);
}

function select_By_products(by_products) {
  //console.log("3960 e and select_By_products is ", by_products);
  var selected_option = document.getElementById(by_products).value;
  gen_dict["by_products"] = selected_option;
  console.log("3978 gen_dict['by_products'] is", gen_dict["by_products"]);
}

function select_Variables(variables) {
  /* Need to change the dict and function so it adds variable and value as a key value pair
    And create functions to search and extract those values */
  var selected_option = document.getElementById(variables).value;
  gen_dict["variables"] = selected_option;
  console.log("3985 gen_dict['variables'] is", gen_dict["variables"]);
}

function input_energy(e) {
  var inputValue = document.getElementById(e.target.id).value;
  console.log("3990 inputValue is ", inputValue);
  gen_dict["energy_amount"] = inputValue;
  console.log("3992 input_energy is ", inputValue);
}

function input_values(e) {
  var inputValue = document.getElementById(e.target.id).value;
  gen_dict["values"] = inputValue;
  if (inputValue == 0.6177) {
    payment_plan = 50;
    console.log("4082 inputValue is ", payment_plan, inputValue);
  }
  console.log("4084 inputValue is ", inputValue);
}

function forExample() {
  // an example of a for-of loop
  for (const [i, el] of menu.entries()) console.log(`${i + 1}: ${el}`);
}

function not_yet_functional() {
  openGuidanceModal("The selected process in not yet functional.");
}

function set_explanation_text(text) {
  var ele = document.getElementById("explanation");
  ele.innerHTML = text;
}

function set_bottom_explanation_text(text) {
  var ele = document.getElementById("explanations");
  ele.innerHTML = text;
}

// Process guidance modal with draggable & resizable ability
function openGuidanceModal(text = "Instructions") {
  //open modal
  $("#dragable_modal").modal({
    backdrop: false,
    show: true,
    keyboard: true,
  });
  // reset modal if it isn't visible
  if (!$(".modal.in").length) {
    $(".modal-dialog").css({
      top: 20,
      left: 100,
    });
  }

  $(".modal-dialog").draggable({
    cursor: "move",
    handle: ".dragable_touch",
  });

  $(".modal-open").css({
    overflowY: "auto",
    paddingRight: 0,
  });
  var $height = $(window).scrollTop();
  $("html, body").animate({ scrollTop: $height }, "slow");

  var instruction_ele = document.getElementById("multi-step-instructions");
  instruction_ele.innerHTML = text;
}
